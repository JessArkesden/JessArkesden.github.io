<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Jess Arkesden - Identifying potential priority local authorities in England for intergenerational care facilities</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #355070;
      }
</style>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jess Arkesden</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title"><span style="color: white;">Identifying potential priority local authorities in England for intergenerational care facilities</span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Content list</h2>
   
  <ul>
  <li><a href="#disclaimer" id="toc-disclaimer" class="nav-link active" data-scroll-target="#disclaimer">Disclaimer</a></li>
  <li><a href="#accompanying-policy-briefing" id="toc-accompanying-policy-briefing" class="nav-link" data-scroll-target="#accompanying-policy-briefing">Accompanying Policy Briefing</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">1. Data</a>
  <ul class="collapse">
  <li><a href="#import-libraries" id="toc-import-libraries" class="nav-link" data-scroll-target="#import-libraries">1.1. Import libraries</a></li>
  <li><a href="#import-raw-datafiles" id="toc-import-raw-datafiles" class="nav-link" data-scroll-target="#import-raw-datafiles">1.2. Import raw datafiles</a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">2. Data wrangling</a>
  <ul class="collapse">
  <li><a href="#las" id="toc-las" class="nav-link" data-scroll-target="#las">2.1. LAs</a></li>
  <li><a href="#age" id="toc-age" class="nav-link" data-scroll-target="#age">2.2. Age</a></li>
  <li><a href="#care-homes-with-or-without-nursing" id="toc-care-homes-with-or-without-nursing" class="nav-link" data-scroll-target="#care-homes-with-or-without-nursing">2.3. Care Homes (with or without nursing)</a></li>
  <li><a href="#childcare-providers-early-years-services-eys" id="toc-childcare-providers-early-years-services-eys" class="nav-link" data-scroll-target="#childcare-providers-early-years-services-eys">2.4. Childcare Providers (Early Years Services (EYS))</a></li>
  <li><a href="#combined-dataframe" id="toc-combined-dataframe" class="nav-link" data-scroll-target="#combined-dataframe">2.5. Combined dataframe</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">2.6. Feature engineering</a></li>
  </ul></li>
  <li><a href="#visualisation-and-statistics" id="toc-visualisation-and-statistics" class="nav-link" data-scroll-target="#visualisation-and-statistics">3. Visualisation and Statistics</a>
  <ul class="collapse">
  <li><a href="#geographical-context" id="toc-geographical-context" class="nav-link" data-scroll-target="#geographical-context">3.1. Geographical context</a></li>
  <li><a href="#raw-variables" id="toc-raw-variables" class="nav-link" data-scroll-target="#raw-variables">3.2. ‘Raw’ variables</a></li>
  <li><a href="#features-for-analysis" id="toc-features-for-analysis" class="nav-link" data-scroll-target="#features-for-analysis">3.3. Features for analysis</a></li>
  </ul></li>
  <li><a href="#analysis-results" id="toc-analysis-results" class="nav-link" data-scroll-target="#analysis-results">4. Analysis &amp; Results</a>
  <ul class="collapse">
  <li><a href="#establishing-feature-collinearity" id="toc-establishing-feature-collinearity" class="nav-link" data-scroll-target="#establishing-feature-collinearity">4.1. Establishing feature collinearity</a></li>
  <li><a href="#identifying-the-optimal-number-of-k-means-clusters" id="toc-identifying-the-optimal-number-of-k-means-clusters" class="nav-link" data-scroll-target="#identifying-the-optimal-number-of-k-means-clusters">4.2. Identifying the optimal number of K-means clusters</a></li>
  <li><a href="#k-means-clustering-model" id="toc-k-means-clustering-model" class="nav-link" data-scroll-target="#k-means-clustering-model">4.3. K-means clustering model</a></li>
  <li><a href="#visualising-results" id="toc-visualising-results" class="nav-link" data-scroll-target="#visualising-results">4.4. Visualising results</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<p><strong>Go back to the <a href="../../projects/index.html">projects page</a>.</strong></p>
<hr>
<section id="disclaimer" class="level3">
<h3 class="anchored" data-anchor-id="disclaimer">Disclaimer</h3>
<p>This notebook was submitted for assessment within the <em>GEOG5404 Analytics for Urban Policy</em> module as part of the <em>MSc Urban Data Science &amp; Analytics</em> programme at the <em>University of Leeds</em>.</p>
<p><strong>The content of this notebook is intended for educational and general use purposes only.</strong></p>
<p>Any use of the materials should adhere to the guidelines and policies of your educational institution.</p>
<p><strong>The author does not take any responsibility for how the materials in this repository are utilised.</strong></p>
<hr>
</section>
<section id="accompanying-policy-briefing" class="level2">
<h2 class="anchored" data-anchor-id="accompanying-policy-briefing">Accompanying Policy Briefing</h2>
<p>This notebook contains the detailed analysis for this project. An accompanying policy briefing was written to discuss the findings in context.</p>
<p><strong>You can read this policy briefing <a href="Priority_LAs_for_intergenerational_care_facilities_BRIEFING.pdf" target="_blank">here</a></strong>.</p>
<hr>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">1. Data</h2>
<section id="import-libraries" class="level3">
<h3 class="anchored" data-anchor-id="import-libraries">1.1. Import libraries</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data importing / wrangling</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy.geocoders <span class="im">import</span> Nominatim</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy.exc <span class="im">import</span> GeocoderTimedOut</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisations</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> clrs</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> cx</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.metrics <span class="im">as</span> metrics</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-raw-datafiles" class="level3">
<h3 class="anchored" data-anchor-id="import-raw-datafiles">1.2. Import raw datafiles</h3>
<p>Each datafile is imported in this section. The full reference and link to the raw data is provided in the reference list at the end of this Notebook, with the code stating which reference refers to which datafile.</p>
<p><strong>Some datafiles, notably shapefiles, are too large to be included in this repository. The raw files can be accessed using the links provided to download locally.</strong></p>
<section id="counties-and-unitary-authorities" class="level4">
<h4 class="anchored" data-anchor-id="counties-and-unitary-authorities">1.2.1. Counties and Unitary Authorities</h4>
<p>Counties and Unitary Authorities are referred to by the Office for National Statistics (ONS) as “Upper-Tier Local Authorities”. These change periodically, but for consistency across data sources the December 2022 boundaries will be used which align to the 2021 Census as they remained unchanged in this period. According to the ONS (2023a): “There are 152 upper tier local authorities in England made up of 59 unitary authorities, 36 metropolitan districts, 33 London boroughs (including City of London) and 24 counties”.</p>
<p>These will be referred to as local authorities (LAs) for ease within this Notebook.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ONS Counties and Unitary Authority boundaries, Dec 2022, polygons (ONS, 2023b)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LAs <span class="op">=</span> gpd.read_file(<span class="st">'Data/Counties_and_Unitary_Authorities_December_2022_UK_BFC_-4274932253738652752/CTYUA_DEC_2022_UK_BFC.shp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="census-age-by-la" class="level4">
<h4 class="anchored" data-anchor-id="census-age-by-la">1.2.2. Census Age by LA</h4>
<p>Census Age by LA can be obtained via a custom ONS query (ONS, 2023c). This query includes only LAs in England and selects nine age groups to ensure that the under 4 and over 65 age groups for analysis can be created. The output file from the query contains the number of people in each given age group, which can then be transformed to create and isolate the under 4 and over 65 categories (see Section 2.2).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Census 2021, Age by LA (ONS, 2023c)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Age <span class="op">=</span> pd.read_csv(<span class="st">'Data/Census-England-UpperTierLocalAuthorities-Age.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cqc-directory" class="level4">
<h4 class="anchored" data-anchor-id="cqc-directory">1.2.3. CQC Directory</h4>
<p>The Care Quality Commission (CQC) care directory with filters (CQC, 2024) contains information about all active locations registered with CQC, including care home bed numbers, regulated activities, service types and service users. The file is updated monthly, with the file used in this analysis being the March 2024 version of the data. This can be accessed from the archive available on the CQC website (2024) alongside the latest file.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CQC Care directory with filters as at 01 March 2024 (CQC, 2024). Data is on second sheet.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>CQC_directory_with_filters <span class="op">=</span> pd.read_excel(<span class="st">"Data/01_March_2024_HSCA_Active_Locations-v2.xlsx"</span>, sheet_name<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ofsted-childcare-providers" class="level4">
<h4 class="anchored" data-anchor-id="ofsted-childcare-providers">1.2.4. Ofsted Childcare Providers</h4>
<p>Ofsted (Office for Standards in Education, Children’s Services and Skills) are the regulator for children’s care and education services (Ofsted, 2024). The childcare providers and inspections data is updated periodically, with the latest available being August 2023 (Ofsted, 2023). This dataset does not include a geometry but does include postcode. The ONS Postcode directory (ONS, 2024) is imported here and used to add latitude and longitude information to the dataset.</p>
<p>Due to the size of the ONS Postcode directory, this is not included in this repository. Instead, <strong>the updated Ofsted Childcare Provider dataset, including the latitude and longitude information, is exported to a csv and included in the data folder.</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ofsted Childcare Providers data (Ofsted, 2023), list of all providers</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Childcare_Providers <span class="op">=</span> pd.read_excel(<span class="st">'Data/Childcare_provider_level_data_as_of_31_August_2023.xlsx'</span>, sheet_name<span class="op">=</span><span class="dv">3</span>, header<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ONS Postcode Directory (ONS, 2024) - this file is NOT included in the Zip folder due to its size.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Instead, an updated version of the above Ofsted Childcare Providers data with lat/long added from Postcodes</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>Postcodes <span class="op">=</span> pd.read_csv(<span class="st">'Data/ONSPD_FEB_2024_UK/Data/ONSPD_FEB_2024_UK.csv'</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Trim to only required columns for ease of use</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>Postcodes_trim <span class="op">=</span> Postcodes[[<span class="st">'pcds'</span>,<span class="st">'lat'</span>,<span class="st">'long'</span>]].copy()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge dataframes on Postcodes and add lat and long information to Childcare_Providers dataframe</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>Childcare_Providers <span class="op">=</span> Childcare_Providers.merge(Postcodes_trim, left_on<span class="op">=</span><span class="st">'Postcode'</span>, right_on<span class="op">=</span><span class="st">'pcds'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the DataFrame to CSV</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>Childcare_Providers.to_csv(<span class="st">'Data/Childcare_provider_level_data_as_of_31_August_2023_including_latlong.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">2. Data wrangling</h2>
<section id="las" class="level3">
<h3 class="anchored" data-anchor-id="las">2.1. LAs</h3>
<p>Only LAs in England are needed. The CTYUA22CD column is a unique code for each LA, with those in England starting with the letter “E”, Northern Ireland “N”, Scotland “S” and Wales “W”. This code can therefore be used to filter the data to just England (those starting with “E”), leaving the 152 LAs in England as per the ONS (2023a) figure.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unnecessary columns from LA data to keep only the required columns in a new dataframe</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>LAs_trim <span class="op">=</span> LAs.loc[:, [<span class="st">'CTYUA22CD'</span>, <span class="st">'CTYUA22NM'</span>, <span class="st">'geometry'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduce to just LAs in England by filtering on codes that start with 'E'</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>LAs_Eng <span class="op">=</span> LAs_trim[LAs_trim[<span class="st">'CTYUA22CD'</span>].<span class="bu">str</span>.startswith(<span class="st">'E'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the length of the dataframe, which should be 152 which is the full LA list for England</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(LAs_Eng))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(LAs_Eng) <span class="op">==</span> <span class="dv">152</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>152 True</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual check of dataframe</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>LAs_Eng.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
CTYUA22CD
</th>
<th>
CTYUA22NM
</th>
<th>
geometry
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E06000001
</td>
<td>
Hartlepool
</td>
<td>
MULTIPOLYGON (((450154.599 525938.201, 450140….
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E06000002
</td>
<td>
Middlesbrough
</td>
<td>
MULTIPOLYGON (((446854.700 517192.700, 446854….
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E06000003
</td>
<td>
Redcar and Cleveland
</td>
<td>
MULTIPOLYGON (((451747.397 520561.100, 451792….
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E06000004
</td>
<td>
Stockton-on-Tees
</td>
<td>
MULTIPOLYGON (((447177.704 517811.797, 447176….
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E06000005
</td>
<td>
Darlington
</td>
<td>
POLYGON ((423496.602 524724.299, 423497.204 52…
</td>
</tr>
</tbody>
</table>
</section>
<section id="age" class="level3">
<h3 class="anchored" data-anchor-id="age">2.2. Age</h3>
<p>Age data needs to be pivoted to create columns of the datapoints by LA and then aggregate these to the required age group levels. The percentage of the total population is then calculated to indicate where target populations are highest and therefore service provision may be in demand.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns in Age dataframe to align to other data sources</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Age <span class="op">=</span> Age.rename(columns<span class="op">=</span>{<span class="st">'Upper tier local authorities Code'</span>: <span class="st">'CTYUA22CD'</span>, <span class="st">'Upper tier local authorities'</span>: <span class="st">'CTYUA22NM'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Double check the number of unique CTYUA22CDs is the same as the length of the LAs_Eng dataframe</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Age[<span class="st">'CTYUA22CD'</span>].nunique() <span class="op">==</span> <span class="bu">len</span>(LAs_Eng)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>True</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function that reformats the Census Age data into a usable dataframe for analysis</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Age_data_setup(dataframe):</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop columns that are not required</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    dropped <span class="op">=</span> dataframe.drop(dataframe.columns[[<span class="dv">1</span>,<span class="dv">2</span>]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pivot the dataframe on column[0], making the options from [1] the new column headers and the data that from [2]</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    pivot <span class="op">=</span> dropped.pivot_table(index<span class="op">=</span>dropped.columns[<span class="dv">0</span>],</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                                columns<span class="op">=</span>dropped.columns[<span class="dv">1</span>],</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                                values<span class="op">=</span>dropped.columns[<span class="dv">2</span>]).reset_index()</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    pivot.columns.name <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a Total column from new data columns</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    pivot[<span class="st">'Total'</span>] <span class="op">=</span> pivot.iloc[:, <span class="dv">1</span>:<span class="dv">9</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each 'Aged' column (excluding 'Total')</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> pivot.columns[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a new column with percentage values</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        new_col_name <span class="op">=</span> col <span class="op">+</span> <span class="st">' PC'</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        pivot[new_col_name] <span class="op">=</span> pivot[col] <span class="op">/</span> pivot[<span class="st">'Total'</span>]</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select only the required Age groups for analysis</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    grouped <span class="op">=</span> pivot[[<span class="st">'CTYUA22CD'</span>, <span class="st">'Aged 4 years and under'</span>, <span class="st">'Aged 65 to 74 years'</span>, <span class="st">'Aged 75 years and over'</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Aged 4 years and under PC'</span>, <span class="st">'Aged 65 to 74 years PC'</span>, <span class="st">'Aged 75 years and over PC'</span>]].copy()</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create new 'Aged 65 years and over' column by summing the two older Age columns using .loc</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    grouped.loc[:, <span class="st">'Aged 65 years and over'</span>] <span class="op">=</span> grouped[<span class="st">'Aged 65 to 74 years'</span>] <span class="op">+</span> grouped[<span class="st">'Aged 75 years and over'</span>]</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    grouped.loc[:, <span class="st">'Aged 65 years and over PC'</span>] <span class="op">=</span> grouped[<span class="st">'Aged 65 to 74 years PC'</span>] <span class="op">+</span> grouped[<span class="st">'Aged 75 years and over PC'</span>]</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop the Age columns no longer required</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>]</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    Age_final <span class="op">=</span> grouped.drop(grouped.columns[cols], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Age_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use function to create Age_final dataframe</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Age_final <span class="op">=</span> Age_data_setup(Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Double check length is still correct and no LAs or data has been lost</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(Age_final) <span class="op">==</span> <span class="bu">len</span>(LAs_Eng)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>True</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual check of dataframe</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Age_final.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
CTYUA22CD
</th>
<th>
Aged 4 years and under
</th>
<th>
Aged 4 years and under PC
</th>
<th>
Aged 65 years and over
</th>
<th>
Aged 65 years and over PC
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E06000001
</td>
<td>
4982.0
</td>
<td>
0.059003
</td>
<td>
18233.0
</td>
<td>
0.215936
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E06000002
</td>
<td>
8928.0
</td>
<td>
0.066919
</td>
<td>
24178.0
</td>
<td>
0.181223
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E06000003
</td>
<td>
6814.0
</td>
<td>
0.055873
</td>
<td>
31747.0
</td>
<td>
0.260315
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E06000004
</td>
<td>
10733.0
</td>
<td>
0.059477
</td>
<td>
37184.0
</td>
<td>
0.206056
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E06000005
</td>
<td>
5496.0
</td>
<td>
0.056254
</td>
<td>
22040.0
</td>
<td>
0.225591
</td>
</tr>
</tbody>
</table>
</section>
<section id="care-homes-with-or-without-nursing" class="level3">
<h3 class="anchored" data-anchor-id="care-homes-with-or-without-nursing">2.3. Care Homes (with or without nursing)</h3>
<p>The CQC directory needs to be filtered to isolate only locations required for this analysis. This includes active care homes (with or without nursing) that provide services for older people and are registered as social care organisations. Other locations are not considered. Some of the care homes are missing latitude and longitude data, which is created using the postcode that is listed. It is acknowledged that this methodology will not provide the exact location, but is sufficient for this analysis as information is aggregated to LA level. To aggregate the data, the care home geodataframe is spatially matched to the LA geodataframe before calculating care home counts and total beds by each LA.</p>
<section id="clean-care-homes-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="clean-care-homes-dataframe">2.3.1. Clean care homes dataframe</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter CQC Directory to only locations that meet given criteria for analysis</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>CQC_directory_filtered <span class="op">=</span> CQC_directory_with_filters[(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    CQC_directory_with_filters[<span class="st">'Dormant (Y/N)'</span>] <span class="op">==</span> <span class="st">'N'</span>) <span class="op">&amp;</span>                       <span class="co"># Remove any dormant locations</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    (CQC_directory_with_filters[<span class="st">'Care home?'</span>] <span class="op">==</span> <span class="st">'Y'</span>) <span class="op">&amp;</span>                         <span class="co"># Keep only Care Homes</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    (CQC_directory_with_filters[<span class="st">'Service user band - Older People'</span>] <span class="op">==</span> <span class="st">'Y'</span>) <span class="op">&amp;</span>   <span class="co"># Keep only Users include "Older People"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    (CQC_directory_with_filters[<span class="st">'Location Type/Sector'</span>] <span class="op">==</span> <span class="st">'Social Care Org'</span>)]  <span class="co"># Keep only Social Care Organisations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only columns required for analysis</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>CQC_CareHomes <span class="op">=</span> CQC_directory_filtered[[</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Location ID'</span>, <span class="st">'Care homes beds'</span>, <span class="st">'Location Latitude'</span>, <span class="st">'Location Longitude'</span>]].copy().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fix-missing-latitude-and-longitude" class="level4">
<h4 class="anchored" data-anchor-id="fix-missing-latitude-and-longitude">2.3.2. Fix missing latitude and longitude</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check all rows have a Lat/Long</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>missing_latlong <span class="op">=</span> CQC_CareHomes[CQC_CareHomes[[<span class="st">'Location Latitude'</span>, <span class="st">'Location Longitude'</span>]].isnull().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(missing_latlong)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>22</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bring through postcode for these rows</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>missing_latlong <span class="op">=</span> pd.merge(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    missing_latlong, CQC_directory_filtered[[<span class="st">'Location ID'</span>,<span class="st">'Location Postal Code'</span>]], on<span class="op">=</span><span class="st">'Location ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to geocode postcode to get latitude and longitude</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> geocode_postcode(postcode):</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        geolocator <span class="op">=</span> Nominatim(user_agent<span class="op">=</span><span class="st">"my_geocoder"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        location <span class="op">=</span> geolocator.geocode(postcode)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> location:</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> location.latitude, location.longitude</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> GeocoderTimedOut:</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the geocode function to get latitude and longitude</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>missing_latlong[[</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Location Latitude'</span>, <span class="st">'Location Longitude'</span>]] <span class="op">=</span> missing_latlong[</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Location Postal Code'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: pd.Series(geocode_postcode(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if any rows are still missing a Lat/Long</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>missing_latlong[missing_latlong[[<span class="st">'Location Latitude'</span>, <span class="st">'Location Longitude'</span>]].isnull().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Location ID
</th>
<th>
Care homes beds
</th>
<th>
Location Latitude
</th>
<th>
Location Longitude
</th>
<th>
Location Postal Code
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
15
</th>
<td>
1-15659436285
</td>
<td>
66.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NG24 3YT
</td>
</tr>
<tr>
<th>
20
</th>
<td>
1-18790374800
</td>
<td>
3.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
BL11 5PE
</td>
</tr>
</tbody>
</table>
<p>As there are so few postcodes for which the latitude and longitude could not be found, these will be ignored and dropped in the subsequent analysis.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop Postcode column ready for merging</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>missing_latlong.drop(<span class="st">'Location Postal Code'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the CQC_CareHomes dataframe with the additional lat/long data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>CQC_CareHomes <span class="op">=</span> CQC_CareHomes.set_index(<span class="st">'Location ID'</span>).combine_first(missing_latlong.set_index(<span class="st">'Location ID'</span>)).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the Latitude and Longitude columns into Points</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>geometry <span class="op">=</span> [Point(xy) <span class="cf">for</span> xy <span class="kw">in</span> <span class="bu">zip</span>(CQC_CareHomes[<span class="st">'Location Longitude'</span>], CQC_CareHomes[<span class="st">'Location Latitude'</span>])]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert CQC_CareHomes to a GeoDataFrame</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>CQC_CareHomes <span class="op">=</span> gpd.GeoDataFrame(CQC_CareHomes, geometry<span class="op">=</span>geometry).set_crs(<span class="st">'epsg:4326'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="spatially-match-to-la-geodataframe" class="level4">
<h4 class="anchored" data-anchor-id="spatially-match-to-la-geodataframe">2.3.3. Spatially match to LA geodataframe</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change CQC_CareHomes crs to match LA data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>CQC_CareHomes <span class="op">=</span> CQC_CareHomes.to_crs(<span class="dv">27700</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatially match CQC Care Homes to LA boundaries</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>CareHomes_LAs <span class="op">=</span> gpd.sjoin(CQC_CareHomes, LAs_Eng, predicate<span class="op">=</span><span class="st">'within'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that there are only the missing locations as expected</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>missing <span class="op">=</span> pd.merge(CQC_CareHomes, CareHomes_LAs, how<span class="op">=</span><span class="st">'outer'</span>, suffixes<span class="op">=</span>(<span class="st">''</span>,<span class="st">'_y'</span>), indicator<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>rows_in_df1_not_in_df2 <span class="op">=</span> missing[missing[<span class="st">'_merge'</span>]<span class="op">==</span><span class="st">'left_only'</span>][CQC_CareHomes.columns]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>rows_in_df1_not_in_df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Location ID
</th>
<th>
Care homes beds
</th>
<th>
Location Latitude
</th>
<th>
Location Longitude
</th>
<th>
geometry
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
6108
</th>
<td>
1-15659436285
</td>
<td>
66.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
<tr>
<th>
6708
</th>
<td>
1-18790374800
</td>
<td>
3.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by 'CTYUA22CD' and aggregate</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>CareHomes_LAs_agg <span class="op">=</span> CareHomes_LAs.groupby(<span class="st">'CTYUA22CD'</span>).agg({</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Location ID'</span>: <span class="st">'count'</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Care homes beds'</span>: <span class="st">'sum'</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns for clarity</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>CareHomes_LAs_agg.columns <span class="op">=</span> [<span class="st">'CTYUA22CD'</span>, <span class="st">'Count of CareHome Locations'</span>, <span class="st">'Sum of CareHome beds'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check length of CareHomes_LAs_agg contains all 152 LAs</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(CareHomes_LAs_agg))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(CareHomes_LAs_agg) <span class="op">==</span> <span class="bu">len</span>(LAs_Eng))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>151 False</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check missing LAs</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>missing_LAs <span class="op">=</span> pd.merge(LAs_Eng, CareHomes_LAs_agg, how<span class="op">=</span><span class="st">'outer'</span>, suffixes<span class="op">=</span>(<span class="st">''</span>,<span class="st">'_y'</span>), indicator<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>rows_missing <span class="op">=</span> missing_LAs[missing_LAs[<span class="st">'_merge'</span>]<span class="op">==</span><span class="st">'left_only'</span>][LAs_Eng.columns]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>rows_missing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
CTYUA22CD
</th>
<th>
CTYUA22NM
</th>
<th>
geometry
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
95
</th>
<td>
E09000001
</td>
<td>
City of London
</td>
<td>
MULTIPOLYGON (((531664.450 180555.150, 531664….
</td>
</tr>
</tbody>
</table>
<p>It is unsurprising that City of London does not have any care home locations meeting the requirements to be included in this analysis. The City of London operates very differently to other LAs, with a small population and mostly serving as a business centre. This LA will be excluded from the analysis, which is handled in section 2.5 as part of the creation of the final dataframe for analysis.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual check of final dataframe</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>CareHomes_LAs_agg.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
CTYUA22CD
</th>
<th>
Count of CareHome Locations
</th>
<th>
Sum of CareHome beds
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E06000001
</td>
<td>
20
</td>
<td>
884.0
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E06000002
</td>
<td>
30
</td>
<td>
1498.0
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E06000003
</td>
<td>
30
</td>
<td>
1111.0
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E06000004
</td>
<td>
41
</td>
<td>
1830.0
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E06000005
</td>
<td>
23
</td>
<td>
1069.0
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="childcare-providers-early-years-services-eys" class="level3">
<h3 class="anchored" data-anchor-id="childcare-providers-early-years-services-eys">2.4. Childcare Providers (Early Years Services (EYS))</h3>
<p>The Ofsted childcare providers data also needs to be filtered to isolate only locations required for this analysis. This includes only businesses that are on non-domestic premises (i.e.&nbsp;excludes childminders caring for children in their home), and only those that are registered to provide early years services. Early years services (EYS) are those for pre-school aged children, which are the focus of this analysis. Some of the EYS locations are missing latitude and longitude data, as well as postcode, due to data privacy issues. As there are so few affected by this issue, the locations will simply be excluded from the analysis. Again, the data will be aggregated to LA level. To aggregate the data, the EYS geodataframe is spatially matched to the LA geodataframe before calculating EYS location counts and total places by each LA.</p>
<section id="clean-childcare-providers-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="clean-childcare-providers-dataframe">2.4.1. Clean childcare providers dataframe</h4>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Ofsted data to only locations that meet given criteria for analysis</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices <span class="op">=</span> Childcare_Providers[(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    Childcare_Providers[<span class="st">'Provider type'</span>] <span class="op">==</span> <span class="st">'Childcare on non-domestic premises'</span>) <span class="op">&amp;</span>    <span class="co"># Keep only business locations</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    (Childcare_Providers[<span class="st">'Provider Early Years Register Flag'</span>] <span class="op">==</span> <span class="st">'Y'</span>)]      <span class="co"># Keep only locations registered for Early Years</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only columns required for analysis</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices_Trim <span class="op">=</span> EarlyYearsServices[[</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Provider URN'</span>, <span class="st">'Provider name'</span>, <span class="st">'Postcode'</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Places including estimates'</span>, <span class="st">'pcds'</span>, <span class="st">'lat'</span>, <span class="st">'long'</span>]].copy().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="geocode-the-eys-data" class="level4">
<h4 class="anchored" data-anchor-id="geocode-the-eys-data">2.4.2. Geocode the EYS data</h4>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of the dataframe for geocoding</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices_Locations <span class="op">=</span> EarlyYearsServices_Trim.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for any missing lat/long information</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices_Locations[EarlyYearsServices_Locations[[<span class="st">'lat'</span>, <span class="st">'long'</span>]].isnull().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Provider URN
</th>
<th>
Provider name
</th>
<th>
Postcode
</th>
<th>
Places including estimates
</th>
<th>
pcds
</th>
<th>
lat
</th>
<th>
long
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
1104
</th>
<td>
EY496734
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
43.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
3523
</th>
<td>
EY372207
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
33.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
5674
</th>
<td>
EY292960
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
20.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
5918
</th>
<td>
229140
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
20.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
6195
</th>
<td>
EY251447
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
8.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
8581
</th>
<td>
EY400304
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
40.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
8635
</th>
<td>
EY243486
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
12.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
15395
</th>
<td>
EY366430
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
4.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(EarlyYearsServices_Locations[EarlyYearsServices_Locations[[<span class="st">'lat'</span>, <span class="st">'long'</span>]].isnull().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>8</p>
<p>As there are only 8 locations with missing lat and long, these will be ignored. The issue is that their information is being redacted by Ofsted, likely due to privacy/GDPR issues.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the Latitude and Longitude columns into Points</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>geometry <span class="op">=</span> [Point(xy) <span class="cf">for</span> xy <span class="kw">in</span> <span class="bu">zip</span>(EarlyYearsServices_Locations[<span class="st">'long'</span>], EarlyYearsServices_Locations[<span class="st">'lat'</span>])]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert EarlyYearsServices_Locations to a GeoDataFrame</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices_Locations <span class="op">=</span> gpd.GeoDataFrame(EarlyYearsServices_Locations, geometry<span class="op">=</span>geometry).set_crs(<span class="st">'epsg:4326'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="spatially-match-to-la-geodataframe-1" class="level4">
<h4 class="anchored" data-anchor-id="spatially-match-to-la-geodataframe-1">2.4.3. Spatially match to LA geodataframe</h4>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change EarlyYearsServices_Locations crs to match other data</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices_Locations <span class="op">=</span> EarlyYearsServices_Locations.to_crs(<span class="dv">27700</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatially match EarlyYearsServices_Locations to LA boundaries</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices_LAs <span class="op">=</span> gpd.sjoin(EarlyYearsServices_Locations, LAs_Eng, predicate<span class="op">=</span><span class="st">'within'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that there are only the 8 missing locations as expected</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>missing_locations <span class="op">=</span> pd.merge(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    EarlyYearsServices_Locations, EarlyYearsServices_LAs, how<span class="op">=</span><span class="st">'outer'</span>, suffixes<span class="op">=</span>(<span class="st">''</span>,<span class="st">'_y'</span>), indicator<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>rows_in_df1_not_in_df2 <span class="op">=</span> missing_locations[missing_locations[<span class="st">'_merge'</span>]<span class="op">==</span><span class="st">'left_only'</span>][EarlyYearsServices_Locations.columns]</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>rows_in_df1_not_in_df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Provider URN
</th>
<th>
Provider name
</th>
<th>
Postcode
</th>
<th>
Places including estimates
</th>
<th>
pcds
</th>
<th>
lat
</th>
<th>
long
</th>
<th>
geometry
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2173
</th>
<td>
229140
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
20.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
<tr>
<th>
10782
</th>
<td>
EY243486
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
12.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
<tr>
<th>
10881
</th>
<td>
EY251447
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
8.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
<tr>
<th>
11801
</th>
<td>
EY292960
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
20.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
<tr>
<th>
13478
</th>
<td>
EY366430
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
4.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
<tr>
<th>
13665
</th>
<td>
EY372207
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
33.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
<tr>
<th>
14407
</th>
<td>
EY400304
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
40.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
<tr>
<th>
19331
</th>
<td>
EY496734
</td>
<td>
REDACTED
</td>
<td>
REDACTED
</td>
<td>
43.0
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
POINT EMPTY
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by 'CTYUA22CD' and aggregate</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices_LAs_agg <span class="op">=</span> EarlyYearsServices_LAs.groupby(<span class="st">'CTYUA22CD'</span>).agg({</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Provider URN'</span>: <span class="st">'count'</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Places including estimates'</span>: <span class="st">'sum'</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns for clarity</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices_LAs_agg.columns <span class="op">=</span> [<span class="st">'CTYUA22CD'</span>, <span class="st">'Count of EarlyYears Services'</span>, <span class="st">'Sum of EarlyYears Places'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for any missing LAs</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>missing_LAs <span class="op">=</span> pd.merge(LAs_Eng, EarlyYearsServices_LAs_agg, how<span class="op">=</span><span class="st">'outer'</span>, suffixes<span class="op">=</span>(<span class="st">''</span>,<span class="st">'_y'</span>), indicator<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>rows_missing <span class="op">=</span> missing_LAs[missing_LAs[<span class="st">'_merge'</span>]<span class="op">==</span><span class="st">'left_only'</span>][LAs_Eng.columns]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>rows_missing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
CTYUA22CD
</th>
<th>
CTYUA22NM
</th>
<th>
geometry
</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual check of final dataframe</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>EarlyYearsServices_LAs_agg.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
CTYUA22CD
</th>
<th>
Count of EarlyYears Services
</th>
<th>
Sum of EarlyYears Places
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E06000001
</td>
<td>
16
</td>
<td>
940.43
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E06000002
</td>
<td>
35
</td>
<td>
1975.00
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E06000003
</td>
<td>
29
</td>
<td>
1395.00
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E06000004
</td>
<td>
52
</td>
<td>
2922.00
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E06000005
</td>
<td>
31
</td>
<td>
1619.00
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="combined-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="combined-dataframe">2.5. Combined dataframe</h3>
<p>The wrangled dataframes must now be combined into a single dataframe for analysis. The issue with the City of London must also be addressed at this stage by removing it from the final dataframe for analysis.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the wrangled dataframes together on CTYUA22CD</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>analysis_df <span class="op">=</span> LAs_Eng.merge(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    Age_final, on<span class="op">=</span><span class="st">'CTYUA22CD'</span>, how<span class="op">=</span><span class="st">'outer'</span>).merge(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    CareHomes_LAs_agg, on<span class="op">=</span><span class="st">'CTYUA22CD'</span>, how<span class="op">=</span><span class="st">'outer'</span>).merge(</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    EarlyYearsServices_LAs_agg, on<span class="op">=</span><span class="st">'CTYUA22CD'</span>, how<span class="op">=</span><span class="st">'outer'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There was one LA (City of London) which did not have any care homes, and has a very low number of early years services as well as population in both focus age groups. The City of London operates very differntly to other county and unitary authorities and has a very small population, primarily operating as a financial district. From this point forwards, for the purposes of this analysis, City of London will be excluded to avoid any biases and incorrect interpretation of service provision in this area.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual check of City of London</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>analysis_df[analysis_df[<span class="st">'CTYUA22CD'</span>] <span class="op">==</span> <span class="st">'E09000001'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
CTYUA22CD
</th>
<th>
CTYUA22NM
</th>
<th>
geometry
</th>
<th>
Aged 4 years and under
</th>
<th>
Aged 4 years and under PC
</th>
<th>
Aged 65 years and over
</th>
<th>
Aged 65 years and over PC
</th>
<th>
Count of CareHome Locations
</th>
<th>
Sum of CareHome beds
</th>
<th>
Count of EarlyYears Services
</th>
<th>
Sum of EarlyYears Places
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
95
</th>
<td>
E09000001
</td>
<td>
City of London
</td>
<td>
MULTIPOLYGON (((531664.450 180555.150, 531664….
</td>
<td>
213.0
</td>
<td>
0.026329
</td>
<td>
1209.0
</td>
<td>
0.149444
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
8
</td>
<td>
474.0
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete the City of London row</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>analysis_df <span class="op">=</span> analysis_df[analysis_df[<span class="st">'CTYUA22CD'</span>] <span class="op">!=</span> <span class="st">'E09000001'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check length of analysis_df is now 151</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(analysis_df))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(analysis_df) <span class="op">==</span> <span class="dv">151</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>151 True</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual check of final dataframe</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>analysis_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
CTYUA22CD
</th>
<th>
CTYUA22NM
</th>
<th>
geometry
</th>
<th>
Aged 4 years and under
</th>
<th>
Aged 4 years and under PC
</th>
<th>
Aged 65 years and over
</th>
<th>
Aged 65 years and over PC
</th>
<th>
Count of CareHome Locations
</th>
<th>
Sum of CareHome beds
</th>
<th>
Count of EarlyYears Services
</th>
<th>
Sum of EarlyYears Places
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E06000001
</td>
<td>
Hartlepool
</td>
<td>
MULTIPOLYGON (((450154.599 525938.201, 450140….
</td>
<td>
4982.0
</td>
<td>
0.059003
</td>
<td>
18233.0
</td>
<td>
0.215936
</td>
<td>
20.0
</td>
<td>
884.0
</td>
<td>
16
</td>
<td>
940.43
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E06000002
</td>
<td>
Middlesbrough
</td>
<td>
MULTIPOLYGON (((446854.700 517192.700, 446854….
</td>
<td>
8928.0
</td>
<td>
0.066919
</td>
<td>
24178.0
</td>
<td>
0.181223
</td>
<td>
30.0
</td>
<td>
1498.0
</td>
<td>
35
</td>
<td>
1975.00
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E06000003
</td>
<td>
Redcar and Cleveland
</td>
<td>
MULTIPOLYGON (((451747.397 520561.100, 451792….
</td>
<td>
6814.0
</td>
<td>
0.055873
</td>
<td>
31747.0
</td>
<td>
0.260315
</td>
<td>
30.0
</td>
<td>
1111.0
</td>
<td>
29
</td>
<td>
1395.00
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E06000004
</td>
<td>
Stockton-on-Tees
</td>
<td>
MULTIPOLYGON (((447177.704 517811.797, 447176….
</td>
<td>
10733.0
</td>
<td>
0.059477
</td>
<td>
37184.0
</td>
<td>
0.206056
</td>
<td>
41.0
</td>
<td>
1830.0
</td>
<td>
52
</td>
<td>
2922.00
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E06000005
</td>
<td>
Darlington
</td>
<td>
POLYGON ((423496.602 524724.299, 423497.204 52…
</td>
<td>
5496.0
</td>
<td>
0.056254
</td>
<td>
22040.0
</td>
<td>
0.225591
</td>
<td>
23.0
</td>
<td>
1069.0
</td>
<td>
31
</td>
<td>
1619.00
</td>
</tr>
</tbody>
</table>
</section>
<section id="feature-engineering" class="level3">
<h3 class="anchored" data-anchor-id="feature-engineering">2.6. Feature engineering</h3>
<p>The final step in the wrangling process is to engineer the additional features which will be used in the analysis. This includes measures that illustrate provision in each LA. To do this, the ratio of people to each relevant service (including locations and beds/places) is used. This gives a view of, for example, how many children there are per each EYS place in a given LA. Compared across LAs, this then gives a view of provision and whether more services are needed.</p>
<p>As a K-means clustering model will be created, and in order to compare features in the analysis, all features must be standardised to ensure comparability. This is achieved by calculating Z-scores. Calculating Z-scores gives a mean of 0 and standard deviation of 1 for all features, highlighting where datapoints deviate from the mean and by how much. The features have normal distributions (with some tails due to outliers) as shown in Figure 4.1.2. later in this notebook, making Z-scores a suitable standardisation method.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a copy of the analysis_df</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> analysis_df.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To keep the code tidier, rename the columns to shorthand abbreviations</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary for renaming columns</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>rename_dict <span class="op">=</span> {</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CTYUA22CD'</span>: <span class="st">'CTYUA22CD'</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CTYUA22NM'</span>: <span class="st">'CTYUA22NM'</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'geometry'</span>: <span class="st">'geometry'</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Aged 4 years and under'</span>: <span class="st">'U4'</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Aged 4 years and under PC'</span>: <span class="st">'%U4'</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Aged 65 years and over'</span>: <span class="st">'O65'</span>,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Aged 65 years and over PC'</span>: <span class="st">'%O65'</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Count of CareHome Locations'</span>: <span class="st">'CH Locs'</span>,</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sum of CareHome beds'</span>: <span class="st">'CH Beds'</span>,</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Count of EarlyYears Services'</span>: <span class="st">'EYS Locs'</span>,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sum of EarlyYears Places'</span>: <span class="st">'EYS Places'</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns using the dictionary</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> final_df.rename(columns<span class="op">=</span>rename_dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="calculate-ratios" class="level4">
<h4 class="anchored" data-anchor-id="calculate-ratios">2.6.1. Calculate ratios</h4>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ratio of U4 to EYS Locs</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'U4:EYS Locs'</span>] <span class="op">=</span> final_df[<span class="st">'U4'</span>] <span class="op">/</span> final_df[<span class="st">'EYS Locs'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ratio of U4 to EYS Places</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'U4:EYS Places'</span>] <span class="op">=</span> final_df[<span class="st">'U4'</span>] <span class="op">/</span> final_df[<span class="st">'EYS Places'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ratio of O65 to CH Locs</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'O65:CH Locs'</span>] <span class="op">=</span> final_df[<span class="st">'O65'</span>] <span class="op">/</span> final_df[<span class="st">'CH Locs'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ratio of O65 to CH Beds</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'O65:CH Beds'</span>] <span class="op">=</span> final_df[<span class="st">'O65'</span>] <span class="op">/</span> final_df[<span class="st">'CH Beds'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="calculate-z-scores" class="level4">
<h4 class="anchored" data-anchor-id="calculate-z-scores">2.6.2. Calculate Z-Scores</h4>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-score for U4</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'U4z'</span>] <span class="op">=</span> stats.zscore(final_df[<span class="st">'U4'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-score for O65</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'O65z'</span>] <span class="op">=</span> stats.zscore(final_df[<span class="st">'O65'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-score for %U4</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'%U4z'</span>] <span class="op">=</span> stats.zscore(final_df[<span class="st">'%U4'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-score for %O65</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'%O65z'</span>] <span class="op">=</span> stats.zscore(final_df[<span class="st">'%O65'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-score for U4:EYS Locs</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'U4:EYS Locsz'</span>] <span class="op">=</span> stats.zscore(final_df[<span class="st">'U4:EYS Locs'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-score for U4:EYS Places</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'U4:EYS Placesz'</span>] <span class="op">=</span> stats.zscore(final_df[<span class="st">'U4:EYS Places'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-score for O65:CH Locs</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'O65:CH Locsz'</span>] <span class="op">=</span> stats.zscore(final_df[<span class="st">'O65:CH Locs'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate z-score for O65:CH Beds</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'O65:CH Bedsz'</span>] <span class="op">=</span> stats.zscore(final_df[<span class="st">'O65:CH Beds'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual check of final dataframe</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>final_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
CTYUA22CD
</th>
<th>
CTYUA22NM
</th>
<th>
geometry
</th>
<th>
U4
</th>
<th>
%U4
</th>
<th>
O65
</th>
<th>
%O65
</th>
<th>
CH Locs
</th>
<th>
CH Beds
</th>
<th>
EYS Locs
</th>
<th>
…
</th>
<th>
O65:CH Locs
</th>
<th>
O65:CH Beds
</th>
<th>
U4z
</th>
<th>
O65z
</th>
<th>
%U4z
</th>
<th>
%O65z
</th>
<th>
U4:EYS Locsz
</th>
<th>
U4:EYS Placesz
</th>
<th>
O65:CH Locsz
</th>
<th>
O65:CH Bedsz
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E06000001
</td>
<td>
Hartlepool
</td>
<td>
MULTIPOLYGON (((450154.599 525938.201, 450140….
</td>
<td>
4982.0
</td>
<td>
0.059003
</td>
<td>
18233.0
</td>
<td>
0.215936
</td>
<td>
20.0
</td>
<td>
884.0
</td>
<td>
16
</td>
<td>
…
</td>
<td>
911.650000
</td>
<td>
20.625566
</td>
<td>
-1.027892
</td>
<td>
-0.819890
</td>
<td>
-0.136987
</td>
<td>
0.370894
</td>
<td>
3.117648
</td>
<td>
2.429352
</td>
<td>
-0.418458
</td>
<td>
-0.688230
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E06000002
</td>
<td>
Middlesbrough
</td>
<td>
MULTIPOLYGON (((446854.700 517192.700, 446854….
</td>
<td>
8928.0
</td>
<td>
0.066919
</td>
<td>
24178.0
</td>
<td>
0.181223
</td>
<td>
30.0
</td>
<td>
1498.0
</td>
<td>
35
</td>
<td>
…
</td>
<td>
805.933333
</td>
<td>
16.140187
</td>
<td>
-0.764405
</td>
<td>
-0.723640
</td>
<td>
0.999636
</td>
<td>
-0.221698
</td>
<td>
2.000264
</td>
<td>
1.570449
</td>
<td>
-0.621618
</td>
<td>
-1.069629
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E06000003
</td>
<td>
Redcar and Cleveland
</td>
<td>
MULTIPOLYGON (((451747.397 520561.100, 451792….
</td>
<td>
6814.0
</td>
<td>
0.055873
</td>
<td>
31747.0
</td>
<td>
0.260315
</td>
<td>
30.0
</td>
<td>
1111.0
</td>
<td>
29
</td>
<td>
…
</td>
<td>
1058.233333
</td>
<td>
28.575158
</td>
<td>
-0.905563
</td>
<td>
-0.601098
</td>
<td>
-0.586407
</td>
<td>
1.128486
</td>
<td>
1.600863
</td>
<td>
1.972871
</td>
<td>
-0.136764
</td>
<td>
-0.012264
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E06000004
</td>
<td>
Stockton-on-Tees
</td>
<td>
MULTIPOLYGON (((447177.704 517811.797, 447176….
</td>
<td>
10733.0
</td>
<td>
0.059477
</td>
<td>
37184.0
</td>
<td>
0.206056
</td>
<td>
41.0
</td>
<td>
1830.0
</td>
<td>
52
</td>
<td>
…
</td>
<td>
906.926829
</td>
<td>
20.319126
</td>
<td>
-0.643879
</td>
<td>
-0.513073
</td>
<td>
-0.068850
</td>
<td>
0.202227
</td>
<td>
1.033892
</td>
<td>
0.633879
</td>
<td>
-0.427535
</td>
<td>
-0.714288
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E06000005
</td>
<td>
Darlington
</td>
<td>
POLYGON ((423496.602 524724.299, 423497.204 52…
</td>
<td>
5496.0
</td>
<td>
0.056254
</td>
<td>
22040.0
</td>
<td>
0.225591
</td>
<td>
23.0
</td>
<td>
1069.0
</td>
<td>
31
</td>
<td>
…
</td>
<td>
958.260870
</td>
<td>
20.617399
</td>
<td>
-0.993571
</td>
<td>
-0.758254
</td>
<td>
-0.531585
</td>
<td>
0.535709
</td>
<td>
0.455967
</td>
<td>
0.326072
</td>
<td>
-0.328885
</td>
<td>
-0.688925
</td>
</tr>
</tbody>
</table>
<p>
5 rows × 23 columns
</p>
</section>
</section>
</section>
<section id="visualisation-and-statistics" class="level2">
<h2 class="anchored" data-anchor-id="visualisation-and-statistics">3. Visualisation and Statistics</h2>
<p>Firstly, some of the variables will be edited to improve the subsequent visualisations. This includes rounding numbers to a smaller amount of decimal places, converting percentages to a readable format, and renaming variables so they are clear.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of final_df so data and column names can be made visual-appropriate</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>choropleth <span class="op">=</span> final_df.copy()</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert percentages to readable format</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>choropleth[[<span class="st">'%U4'</span>, <span class="st">'%O65'</span>]] <span class="op">=</span> (</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    choropleth[[<span class="st">'%U4'</span>, <span class="st">'%O65'</span>]])<span class="op">*</span><span class="dv">100</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Round the other variables to appropriate dp for ease of reading</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>choropleth[[<span class="st">'U4:EYS Locs'</span>, <span class="st">'U4:EYS Places'</span>, <span class="st">'O65:CH Locs'</span>, <span class="st">'O65:CH Beds'</span>]] <span class="op">=</span> (</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    choropleth[[<span class="st">'U4:EYS Locs'</span>, <span class="st">'U4:EYS Places'</span>, <span class="st">'O65:CH Locs'</span>, <span class="st">'O65:CH Beds'</span>]]).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>choropleth[[<span class="st">'%U4z'</span>, <span class="st">'%O65z'</span>, <span class="st">'U4:EYS Locsz'</span>, <span class="st">'U4:EYS Placesz'</span>, <span class="st">'O65:CH Locsz'</span>, <span class="st">'O65:CH Bedsz'</span>]] <span class="op">=</span> (</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    choropleth[[<span class="st">'%U4z'</span>, <span class="st">'%O65z'</span>, <span class="st">'U4:EYS Locsz'</span>, <span class="st">'U4:EYS Placesz'</span>, <span class="st">'O65:CH Locsz'</span>, <span class="st">'O65:CH Bedsz'</span>]]).<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary of current variable column names with long-form for use on map</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>columns_dict <span class="op">=</span> {<span class="st">"CTYUA22CD"</span>: <span class="st">"LA Code"</span>,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"CTYUA22NM"</span>: <span class="st">"LA Name"</span>,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"U4"</span>: <span class="st">"Population Aged Under 4"</span>,</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"O65"</span>: <span class="st">"Population Aged Over 65"</span>,</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">"%U4"</span>: <span class="st">"% Population Aged Under 4"</span>,</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">"%O65"</span>: <span class="st">"% Population Aged Over 65"</span>,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"CH Locs"</span>: <span class="st">"Care Home Locations"</span>,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">"CH Beds"</span>: <span class="st">"Care Home Beds"</span>,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">"EYS Locs"</span>: <span class="st">"EYS Locations"</span>,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">"EYS Places"</span>: <span class="st">"EYS Places"</span>,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">"U4:EYS Locs"</span>: <span class="st">"Ratio of Under 4 Population to EYS Locations"</span>,</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>                <span class="st">"U4:EYS Places"</span>: <span class="st">"Ratio of Under 4 Population to EYS Places"</span>,</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">"O65:CH Locs"</span>: <span class="st">"Ratio of Over 65 Population to Care Home Locations"</span>,</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">"O65:CH Beds"</span>: <span class="st">"Ratio of Over 65 Population to Care Home Beds"</span>,</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">"U4z"</span>: <span class="st">"Population Aged Under 4 as Z-Score"</span>,</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">"O65z"</span>: <span class="st">"Population Aged Over 65 as Z-Score"</span>,</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">"%U4z"</span>: <span class="st">"% Population Aged Under 4 as Z-Score"</span>,</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">"%O65z"</span>: <span class="st">"% Population Aged Over 65 as Z-Score"</span>,</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>                <span class="st">"U4:EYS Locsz"</span>: <span class="st">"Ratio of Under 4 Population to EYS Locations as Z-Score"</span>,</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>                <span class="st">"U4:EYS Placesz"</span>: <span class="st">"Ratio of Under 4 Population to EYS Places as Z-Score"</span>,</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>                <span class="st">"O65:CH Locsz"</span>: <span class="st">"Ratio of Over 65 Population to Care Home Locations as Z-Score"</span>,</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>                <span class="st">"O65:CH Bedsz"</span>: <span class="st">"Ratio of Over 65 Population to Care Home Beds as Z-Score"</span>}</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns to the long-form version</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>renamed_columns <span class="op">=</span> choropleth.rename(columns<span class="op">=</span>columns_dict, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set display format to 2 decimal places for ease of reading</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.float_format'</span>, <span class="kw">lambda</span> x: <span class="st">'</span><span class="sc">%.2f</span><span class="st">'</span> <span class="op">%</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="geographical-context" class="level3">
<h3 class="anchored" data-anchor-id="geographical-context">3.1. Geographical context</h3>
<p>To begin, a geographical context map is created for use in the accompanying policy briefing. This context map shows the LA boundaries that have been used as the geography for this analysis.</p>
<section id="figure-3.1.1.-context-map-showing-la-boundaries-in-england" class="level5">
<h5 class="anchored" data-anchor-id="figure-3.1.1.-context-map-showing-la-boundaries-in-england"><strong>Figure 3.1.1. Context Map showing LA boundaries in England</strong></h5>
<p>Data Source: ONS, 2023b</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the boundaries, make slightly transparent to see context beneath</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>final_df.plot(ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add OpenStreetMap basemap and make slightly paler. Use crs from dataframe</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, source<span class="op">=</span>cx.providers.OpenStreetMap.Mapnik, alpha<span class="op">=</span><span class="fl">0.7</span>, crs<span class="op">=</span>final_df.crs.to_string())</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set title</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Map of Local Authority Boundaries, England'</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add source below the chart</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.001</span>, <span class="op">-</span><span class="fl">0.02</span>, <span class="st">'Source: ONS, 2023b'</span>, transform<span class="op">=</span>ax.transAxes, fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn off the axes</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as .png for use in Policy Brief</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('Exports - Images/context_map.png')</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/context_map.png" class="img-fluid"></p>
</section>
</section>
<section id="raw-variables" class="level3">
<h3 class="anchored" data-anchor-id="raw-variables">3.2. ‘Raw’ variables</h3>
<p>Figure 3.2.1. presents choropleths of the ‘raw’ variables that are not included in the analysis, but give an idea of the spatial patterns in the data. There are higher proportions of under 4s in more urban LAs, particularly those that include major cities and towns or are within Greater London. Contrastingly, the proportion of the population aged 65 or over is highest around coastal areas that are typically more rural.</p>
<p>The spatial distribution of the total number of EYS and care home locations is overall similar across LAs. The highest numbers are again in the more urban LAs, particularly those around major cities and towns. However, the city-centre LAs such as Derby, Leicester and Nottingham have relatively fewer locations across both EYS and care homes. This likely reflects the more commercial nature of these LAs. Interestingly when comparing the spatial pattern between locations and proportions of each relevant population, there is no clearly visible relationship.</p>
<p>The results for EYS places and care home beds is largely similar to the total number of locations for each, with the noticable exception of EYS locations and places in Devon, where there appears to be fewer places compared to the number of locations as indicated by the lighter shade of green. This puts the number of places around the average for the dataset compared to the above average number of locations.</p>
<section id="figure-3.2.1.-choropleth-of-raw-variables-by-la" class="level5">
<h5 class="anchored" data-anchor-id="figure-3.2.1.-choropleth-of-raw-variables-by-la"><strong>Figure 3.2.1. Choropleth of “raw” variables by LA</strong></h5>
<p>Data Source: CQC, 2024; Ofsted, 2023; ONS, 2023c</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 2x3 grid of subplots for the maps of the "raw" variables</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">20</span>))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each variable on a different subplot</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co">### 0,0</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">0</span>],                                                         <span class="co"># Identify subplot</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'% Population Aged Under 4'</span>,                                    <span class="co"># Select variable to plot</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'OrRd'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,                        <span class="co"># Amend map visuals</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})  <span class="co"># Amend legend</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">"% Population Aged Under 4"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)                          <span class="co"># Add title</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_axis_off()                                                              <span class="co"># Remove axis</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="co">### 0,1</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">1</span>],</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'% Population Aged Over 65'</span>,</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'OrRd'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">"% Population Aged Over 65"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a><span class="co">### 1,0</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">0</span>],</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'EYS Locations'</span>,</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'BuPu'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">"Count of EYS Locations"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_axis_off()</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a><span class="co">### 1,1</span></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>],</span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'Care Home Locations'</span>,</span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'BuPu'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">"Count of Care Home Locations"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a><span class="co">### 2,0</span></span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">2</span>,<span class="dv">0</span>],</span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'EYS Places'</span>,</span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'YlGn'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">"Count of EYS Places"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb67-48"><a href="#cb67-48" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">0</span>].set_axis_off()</span>
<span id="cb67-49"><a href="#cb67-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-50"><a href="#cb67-50" aria-hidden="true" tabindex="-1"></a><span class="co">### 2,1</span></span>
<span id="cb67-51"><a href="#cb67-51" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">2</span>,<span class="dv">1</span>],</span>
<span id="cb67-52"><a href="#cb67-52" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'Care Home Beds'</span>,</span>
<span id="cb67-53"><a href="#cb67-53" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'YlGn'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb67-54"><a href="#cb67-54" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb67-55"><a href="#cb67-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-56"><a href="#cb67-56" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">1</span>].set_title(<span class="st">"Count of Care Home Beds"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb67-57"><a href="#cb67-57" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb67-58"><a href="#cb67-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-59"><a href="#cb67-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-60"><a href="#cb67-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-61"><a href="#cb67-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title to each row of subplots</span></span>
<span id="cb67-62"><a href="#cb67-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, title <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"Population"</span>, <span class="st">"Locations"</span>, <span class="st">"Places/Beds"</span>]):</span>
<span id="cb67-63"><a href="#cb67-63" aria-hidden="true" tabindex="-1"></a>    axes[i, <span class="dv">0</span>].annotate(title, (<span class="dv">0</span>, <span class="fl">0.5</span>), xytext<span class="op">=</span>(<span class="op">-</span>axes[i, <span class="dv">0</span>].yaxis.labelpad <span class="op">-</span><span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb67-64"><a href="#cb67-64" aria-hidden="true" tabindex="-1"></a>                        xycoords<span class="op">=</span>axes[i, <span class="dv">0</span>].yaxis.label, textcoords<span class="op">=</span><span class="st">'offset points'</span>,</span>
<span id="cb67-65"><a href="#cb67-65" aria-hidden="true" tabindex="-1"></a>                        fontsize<span class="op">=</span><span class="dv">16</span>, ha<span class="op">=</span><span class="st">'right'</span>, va<span class="op">=</span><span class="st">'center'</span>, rotation<span class="op">=</span><span class="dv">90</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb67-66"><a href="#cb67-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-67"><a href="#cb67-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-68"><a href="#cb67-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title to each column of subplots</span></span>
<span id="cb67-69"><a href="#cb67-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j, title <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"Children"</span>, <span class="st">"Older People"</span>]):</span>
<span id="cb67-70"><a href="#cb67-70" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, j].annotate(title, (<span class="fl">0.5</span>, <span class="dv">1</span>), xytext<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">40</span>),</span>
<span id="cb67-71"><a href="#cb67-71" aria-hidden="true" tabindex="-1"></a>                        xycoords<span class="op">=</span><span class="st">'axes fraction'</span>, textcoords<span class="op">=</span><span class="st">'offset points'</span>,</span>
<span id="cb67-72"><a href="#cb67-72" aria-hidden="true" tabindex="-1"></a>                        fontsize<span class="op">=</span><span class="dv">16</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'baseline'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb67-73"><a href="#cb67-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-74"><a href="#cb67-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-75"><a href="#cb67-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Add an overall title for the whole axes</span></span>
<span id="cb67-76"><a href="#cb67-76" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Choropleths of 'Raw' Variables"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb67-77"><a href="#cb67-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-78"><a href="#cb67-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb67-79"><a href="#cb67-79" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>], h_pad<span class="op">=</span><span class="fl">4.0</span>, w_pad<span class="op">=</span><span class="fl">4.0</span>)</span>
<span id="cb67-80"><a href="#cb67-80" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/choropleth_raw_variables.png" class="img-fluid"></p>
</section>
</section>
<section id="features-for-analysis" class="level3">
<h3 class="anchored" data-anchor-id="features-for-analysis">3.3. Features for analysis</h3>
<p>The statistics and visualisations in this section include the features that will be used in the analysis. These are sometimes used in both ‘raw’ and standardised (Z-score) formats depending on the statistic or visualisation.</p>
<p>Figure 3.3.1. shows some simple descriptive statistics of the ‘raw’ version of the features. This highlights that the range of values are on vastly different scales, emphasising the importance of standardising the data. The range is smallest for the percentage of people aged under 4, with the 25th, 50th and 75th percentiles showing that the majority of the data lies around 6%.</p>
<p>There is also clearly a difference in the number of children to EYS locations and places compared to the number of older people to care home locations and beds. This is likely influenced by the fact most children attend an EYS, particularly in the year before starting school. By contrast, not all older people will want or need to live in a care home and so the number of people aged 65 and over to each care home location and bed is much higher. This is a limitation within this analysis and is discussed in more depth in the accompanying policy briefing.</p>
<p>Lastly, care homes are also generally larger than EYS locations, which could be influencing the higher number of older people to care home locations compared to children to EYS locations.</p>
<section id="figure-3.3.1.-descriptive-statistics-of-raw-features" class="level5">
<h5 class="anchored" data-anchor-id="figure-3.3.1.-descriptive-statistics-of-raw-features"><strong>Figure 3.3.1. Descriptive statistics of ‘raw’ features</strong></h5>
<p>Data Source: CQC, 2024; Ofsted, 2023; ONS, 2023c; Author’s calculations</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics for "raw" version of features</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>final_df[[<span class="st">'%U4'</span>, <span class="st">'%O65'</span>, <span class="st">'U4:EYS Locs'</span>, <span class="st">'U4:EYS Places'</span>, <span class="st">'O65:CH Locs'</span>, <span class="st">'O65:CH Beds'</span>]].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
%U4
</th>
<th>
%O65
</th>
<th>
U4:EYS Locs
</th>
<th>
U4:EYS Places
</th>
<th>
O65:CH Locs
</th>
<th>
O65:CH Beds
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
0.06
</td>
<td>
0.19
</td>
<td>
154.32
</td>
<td>
3.10
</td>
<td>
1129.40
</td>
<td>
28.72
</td>
</tr>
<tr>
<th>
std
</th>
<td>
0.01
</td>
<td>
0.06
</td>
<td>
50.54
</td>
<td>
0.91
</td>
<td>
522.09
</td>
<td>
11.80
</td>
</tr>
<tr>
<th>
min
</th>
<td>
0.04
</td>
<td>
0.06
</td>
<td>
76.57
</td>
<td>
1.49
</td>
<td>
512.12
</td>
<td>
16.14
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
0.06
</td>
<td>
0.15
</td>
<td>
119.53
</td>
<td>
2.47
</td>
<td>
874.22
</td>
<td>
22.67
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
0.06
</td>
<td>
0.19
</td>
<td>
140.57
</td>
<td>
2.86
</td>
<td>
1026.10
</td>
<td>
25.65
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
0.06
</td>
<td>
0.23
</td>
<td>
182.29
</td>
<td>
3.59
</td>
<td>
1188.83
</td>
<td>
30.17
</td>
</tr>
<tr>
<th>
max
</th>
<td>
0.08
</td>
<td>
0.35
</td>
<td>
324.88
</td>
<td>
6.53
</td>
<td>
4101.00
</td>
<td>
105.70
</td>
</tr>
</tbody>
</table>
<p>Figure 3.3.2. illustrates the relationship between each population group and the relevant service location and beds/places ratios. This gives an early indication of how many LAs are potentially under- or over-served by different services, shown by the distance from the regression line.</p>
<p>For the “% Population Aged Under 4” charts, those above the line are potentially under-served and may benefit from additional provision being introduced. This is where the proportion of the population in the target age group is high but the number of EYS locations and places is low.</p>
<p>For the “% Population Aged Over 65” charts, the relationship is negative, meaning LAs with a higher percentage of older people have lower ratios of people to care home locations and beds. However, the charts show there is a cluster of outliers with very high ratios to the bottom right of the chart. These are all in central London, an issue that will be investigated further in section 4.</p>
</section>
<section id="figure-3.3.2.-scatterplots-of-percentage-of-the-population-by-age-group-compared-to-service-locations-and-bedsplaces-ratios-by-la" class="level5">
<h5 class="anchored" data-anchor-id="figure-3.3.2.-scatterplots-of-percentage-of-the-population-by-age-group-compared-to-service-locations-and-bedsplaces-ratios-by-la"><strong>Figure 3.3.2. Scatterplots of percentage of the population by age group compared to service locations and beds/places ratios, by LA</strong></h5>
<p>Data Source: CQC, 2024; Ofsted, 2023; ONS, 2023c; Author’s calculations</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a figure with 2 rows and 2 columns for subplots</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title, x-axis subtitle, and y-axis labels</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'% Population by age group compared to service locations and beds/places ratios'</span>, </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>          x<span class="op">=-</span><span class="fl">0.15</span>, y<span class="op">=</span><span class="fl">2.25</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Services'</span>, y<span class="op">=</span><span class="fl">0.05</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'% Population aged under 4'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'% Population aged over 65'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="co">### U4, EYS Locs scatter</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].scatter(x<span class="op">=</span>final_df[<span class="st">'U4:EYS Locs'</span>], y<span class="op">=</span>final_df[<span class="st">'%U4'</span>], s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#09435a'</span>) <span class="co"># add data and set colour</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'U4:EYS Locations'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># add axis label and set font</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the regression line</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>slope0, intercept0 <span class="op">=</span> np.polyfit(final_df[<span class="st">'U4:EYS Locs'</span>], final_df[<span class="st">'%U4'</span>], <span class="dv">1</span>)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>regression_line0 <span class="op">=</span> np.polyval([slope0, intercept0], final_df[<span class="st">'U4:EYS Locs'</span>])</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to the chart</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].plot(final_df[<span class="st">'U4:EYS Locs'</span>], regression_line0, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="co">### U4, EYS Places scatter</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].scatter(x<span class="op">=</span>final_df[<span class="st">'U4:EYS Places'</span>], y<span class="op">=</span>final_df[<span class="st">'%U4'</span>], s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#4e7d8e'</span>) <span class="co"># add data and set colour</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'U4:EYS Places'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># add axis label and set font</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the regression line</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>slope1, intercept1 <span class="op">=</span> np.polyfit(final_df[<span class="st">'U4:EYS Places'</span>], final_df[<span class="st">'%U4'</span>], <span class="dv">1</span>)</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>regression_line1 <span class="op">=</span> np.polyval([slope1, intercept1], final_df[<span class="st">'U4:EYS Places'</span>])</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to the chart</span></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].plot(final_df[<span class="st">'U4:EYS Places'</span>], regression_line1, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a><span class="co">### O65, CH Locs scatter</span></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].scatter(x<span class="op">=</span>final_df[<span class="st">'O65:CH Locs'</span>], y<span class="op">=</span>final_df[<span class="st">'%O65'</span>], s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#9cc2b8'</span>) <span class="co"># add data and set colour</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'O65:Care Home Locations'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># add axis label and set font</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the regression line</span></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>slope2, intercept2 <span class="op">=</span> np.polyfit(final_df[<span class="st">'O65:CH Locs'</span>], final_df[<span class="st">'%O65'</span>], <span class="dv">1</span>)</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>regression_line2 <span class="op">=</span> np.polyval([slope2, intercept2], final_df[<span class="st">'O65:CH Locs'</span>])</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to the chart</span></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].plot(final_df[<span class="st">'O65:CH Locs'</span>], regression_line2, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a><span class="co">### O65, CH Beds scatter</span></span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].scatter(x<span class="op">=</span>final_df[<span class="st">'O65:CH Beds'</span>], y<span class="op">=</span>final_df[<span class="st">'%O65'</span>], s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#90958f'</span>) <span class="co"># add data and set colour</span></span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'O65:Care Home Beds'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># add axis label and set font</span></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the regression line</span></span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>slope3, intercept3 <span class="op">=</span> np.polyfit(final_df[<span class="st">'O65:CH Beds'</span>], final_df[<span class="st">'%O65'</span>], <span class="dv">1</span>)</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>regression_line3 <span class="op">=</span> np.polyval([slope3, intercept3], final_df[<span class="st">'O65:CH Beds'</span>])</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to the chart</span></span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].plot(final_df[<span class="st">'O65:CH Beds'</span>], regression_line3, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a footnote with the data source and specify location on visual</span></span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="op">-</span><span class="fl">0.15</span>, <span class="op">-</span><span class="fl">0.3</span>,</span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Data Source: CQC, 2024; Ofsted, 2023; ONS, 2023c; Author's calculations"</span>,</span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"center"</span>, transform<span class="op">=</span>plt.gca().transAxes,</span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>         fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/scatterplots.png" class="img-fluid"></p>
<p>Figure 3.3.3. presents choropleths again, but this time using the features that will be used in the analysis. The population features are the same as before (figure 3.2.1.), but the provision is now shown as ratios.</p>
<p>The spatial distribution of the ratio of locations to beds/places presents a very different view compared to the raw counts in figure 3.2.1. LAs including large towns and cities have the highest ratio of children to EYS locations and places, with Wakefield, Doncaster and Rotherham being noticeably high ratios across both measures. Derby, Nottingham and Leicester also show high ratios as city-centre LAs.</p>
<p>By contrast, these areas all have a lower ratio of older people to care home locations and beds, as shown by the paler colour on the choropleth. This is partly influenced by the noticeable skewing of the data towards London, with all of the highest ratios for locations and beds being within London. This is an issue investigated further in section 4.</p>
</section>
<section id="figure-3.3.3.-choropleths-of-raw-features-for-analysis-by-la" class="level5">
<h5 class="anchored" data-anchor-id="figure-3.3.3.-choropleths-of-raw-features-for-analysis-by-la"><strong>Figure 3.3.3. Choropleths of ‘raw’ features for analysis, by LA</strong></h5>
<p>Data Source: CQC, 2024; Ofsted, 2023; ONS, 2023c; Author’s calculations</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 2x3 grid of subplots for the maps of the features</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">20</span>))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each feature on a different subplot</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">### 0,0</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">0</span>],                                                         <span class="co"># Identify subplot</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'% Population Aged Under 4'</span>,                                    <span class="co"># Select variable to plot</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'OrRd'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,                        <span class="co"># Amend map visuals</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})  <span class="co"># Amend legend</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">"% Population Aged Under 4"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)                          <span class="co"># Add title</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_axis_off()                                                              <span class="co"># Remove axis</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co">### 0,1</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">1</span>],</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'% Population Aged Over 65'</span>,</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'OrRd'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">"% Population Aged Over 65"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co">### 1,0</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">0</span>],</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'Ratio of Under 4 Population to EYS Locations'</span>,</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'BuPu'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">"Ratio of Under 4 Population to EYS Locations"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_axis_off()</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="co">### 1,1</span></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>],</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'Ratio of Over 65 Population to Care Home Locations'</span>,</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'BuPu'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">"Ratio of Over 65 Population to Care Home Locations"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a><span class="co">### 2,0</span></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">2</span>,<span class="dv">0</span>],</span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'Ratio of Under 4 Population to EYS Places'</span>,</span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'YlGn'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">0</span>].set_title(<span class="st">"Ratio of Under 4 Population to EYS Places"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">0</span>].set_axis_off()</span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a><span class="co">### 2,1</span></span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a>choropleth.plot(ax<span class="op">=</span>axes[<span class="dv">2</span>,<span class="dv">1</span>],</span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'Ratio of Over 65 Population to Care Home Beds'</span>,</span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">'YlGn'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>, scheme<span class="op">=</span><span class="st">'natural_breaks'</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">1</span>].set_title(<span class="st">"Ratio of Over 65 Population to Care Home Beds"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>,<span class="dv">1</span>].set_axis_off()</span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title to each row of subplots</span></span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, title <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"Population"</span>, <span class="st">"Locations"</span>, <span class="st">"Places/Beds"</span>]):</span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a>    axes[i, <span class="dv">0</span>].annotate(title, (<span class="dv">0</span>, <span class="fl">0.5</span>), xytext<span class="op">=</span>(<span class="op">-</span>axes[i, <span class="dv">0</span>].yaxis.labelpad <span class="op">-</span><span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a>                        xycoords<span class="op">=</span>axes[i, <span class="dv">0</span>].yaxis.label, textcoords<span class="op">=</span><span class="st">'offset points'</span>,</span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a>                        fontsize<span class="op">=</span><span class="dv">16</span>, ha<span class="op">=</span><span class="st">'right'</span>, va<span class="op">=</span><span class="st">'center'</span>, rotation<span class="op">=</span><span class="dv">90</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title to each column of subplots</span></span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j, title <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"Children"</span>, <span class="st">"Older People"</span>]):</span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>, j].annotate(title, (<span class="fl">0.5</span>, <span class="dv">1</span>), xytext<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">40</span>),</span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true" tabindex="-1"></a>                        xycoords<span class="op">=</span><span class="st">'axes fraction'</span>, textcoords<span class="op">=</span><span class="st">'offset points'</span>,</span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true" tabindex="-1"></a>                        fontsize<span class="op">=</span><span class="dv">16</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'baseline'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb70-73"><a href="#cb70-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-74"><a href="#cb70-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-75"><a href="#cb70-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Add an overall title for the whole axes</span></span>
<span id="cb70-76"><a href="#cb70-76" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">"Choropleths of 'Raw' Features for Analysis"</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb70-77"><a href="#cb70-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-78"><a href="#cb70-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb70-79"><a href="#cb70-79" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>], h_pad<span class="op">=</span><span class="fl">4.0</span>, w_pad<span class="op">=</span><span class="fl">4.0</span>)</span>
<span id="cb70-80"><a href="#cb70-80" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/choropleth_raw_features.png" class="img-fluid"></p>
<p>Moving on, figure 3.3.4. shows the same descriptive statistics as before but using the standardised (Z-score) version of the features. Here the range is much more comparable across the features, with some outliers on the top end as shown by the higher maximum compared to the minimum Z-score. This is illustrated more clearly in figure 3.3.5.</p>
</section>
<section id="figure-3.3.4.-descriptive-statistics-of-z-score-features" class="level5">
<h5 class="anchored" data-anchor-id="figure-3.3.4.-descriptive-statistics-of-z-score-features"><strong>Figure 3.3.4. Descriptive statistics of Z-score features</strong></h5>
<p>Data Source: CQC, 2024; Ofsted, 2023; ONS, 2023c; Author’s calculations</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics for Z-Score version of features</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>final_df[[<span class="st">'%U4z'</span>, <span class="st">'%O65z'</span>, <span class="st">'U4:EYS Locsz'</span>, <span class="st">'U4:EYS Placesz'</span>, <span class="st">'O65:CH Locsz'</span>, <span class="st">'O65:CH Bedsz'</span>]].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
%U4z
</th>
<th>
%O65z
</th>
<th>
U4:EYS Locsz
</th>
<th>
U4:EYS Placesz
</th>
<th>
O65:CH Locsz
</th>
<th>
O65:CH Bedsz
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
-0.00
</td>
<td>
-0.00
</td>
<td>
0.00
</td>
<td>
-0.00
</td>
<td>
0.00
</td>
<td>
0.00
</td>
</tr>
<tr>
<th>
std
</th>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
</tr>
<tr>
<th>
min
</th>
<td>
-2.29
</td>
<td>
-2.33
</td>
<td>
-1.54
</td>
<td>
-1.78
</td>
<td>
-1.19
</td>
<td>
-1.07
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
-0.63
</td>
<td>
-0.69
</td>
<td>
-0.69
</td>
<td>
-0.70
</td>
<td>
-0.49
</td>
<td>
-0.51
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
-0.02
</td>
<td>
-0.02
</td>
<td>
-0.27
</td>
<td>
-0.26
</td>
<td>
-0.20
</td>
<td>
-0.26
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
0.68
</td>
<td>
0.61
</td>
<td>
0.56
</td>
<td>
0.55
</td>
<td>
0.11
</td>
<td>
0.12
</td>
</tr>
<tr>
<th>
max
</th>
<td>
3.15
</td>
<td>
2.59
</td>
<td>
3.39
</td>
<td>
3.80
</td>
<td>
5.71
</td>
<td>
6.55
</td>
</tr>
</tbody>
</table>
<p>Figure 3.3.5. is a boxplot of the Z-scores of the features. There are extreme outliers on the top end of each feature, as illustrated by the circles lying beyond the upper extreme (horizontal line, or end of the whisker). The ‘%U4z’ and ‘%O65z’ features have the largest range between the upper and lower extremes, as well as the largest range between the upper and lower quartiles, highlighting the greatest spread in the data. However, these variables have the fewest extreme outliers and these outliers are also relatively close to the upper extreme compared to the other features.</p>
<p>By contrast, the ‘O65:CH Locsz’ and ‘O65:CH Bedsz’ features have the smallest range between the upper and lower extremes, as well as the smallest range between the upper and lower quartile. However, these features have the most extreme outliers both in terms of quantity and distance from the upper extreme. This confirms the findings in figure 3.3.2. that was causing the negative gradient regression line.</p>
</section>
<section id="figure-3.3.5.-boxplot-of-z-score-features-by-la" class="level5">
<h5 class="anchored" data-anchor-id="figure-3.3.5.-boxplot-of-z-score-features-by-la"><strong>Figure 3.3.5. Boxplot of Z-Score features, by LA</strong></h5>
<p>Data Source: CQC, 2024; Ofsted, 2023; ONS, 2023c; Author’s calculations</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot of Z-score features</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>final_df[[<span class="st">'%U4z'</span>, <span class="st">'%O65z'</span>, <span class="st">'U4:EYS Locsz'</span>, <span class="st">'U4:EYS Placesz'</span>, <span class="st">'O65:CH Locsz'</span>, <span class="st">'O65:CH Bedsz'</span>]])</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Boxplot of Z-Score Features, by LA'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Z-Score'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Feature'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/zscore_boxplot.png" class="img-fluid"></p>
</section>
</section>
</section>
<section id="analysis-results" class="level2">
<h2 class="anchored" data-anchor-id="analysis-results">4. Analysis &amp; Results</h2>
<section id="establishing-feature-collinearity" class="level3">
<h3 class="anchored" data-anchor-id="establishing-feature-collinearity">4.1. Establishing feature collinearity</h3>
<p>Before building the K-means clustering model, the relationship between the features must be further understood. To begin, the features are isolated into a new dataframe, with the CTYUA22CD converted into the index. This dataframe will be used for the subsequent analysis in this section. The Z-score version of the features are used as they are standardised and therefore comparable.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Isolate the features to include in the K-means modelling</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>kmeanData <span class="op">=</span> final_df.set_index(<span class="st">'CTYUA22CD'</span>)[[</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'%U4z'</span>, <span class="st">'%O65z'</span>, <span class="st">'U4:EYS Locsz'</span>, <span class="st">'U4:EYS Placesz'</span>, <span class="st">'O65:CH Locsz'</span>, <span class="st">'O65:CH Bedsz'</span>]].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, a correlation matrix (figure 4.1.1.) is created to check for collinearity and illustrate the relationship between the features going into more depth than the visualisations in Section 3. Strong collinearity (positive or negative) is not necessarily an issue when building a clustering model, but it is important to understand the features and their relationships in more depth before commencing the more advanced analysis.</p>
<p>Figure 4.1.1. shows collinearity between the location and beds/places ratios for the respective age groups. This is to be expected as generally more locations means more places/beds. There is some collinearity between the proportion of the population aged under 4 and the EYS ratio features, whilst the opposite is true for the over 65 population and care home ratios, as was found in Section 3.</p>
<section id="figure-4.1.1.-correlation-matrix-heatmap-of-z-score-features" class="level5">
<h5 class="anchored" data-anchor-id="figure-4.1.1.-correlation-matrix-heatmap-of-z-score-features"><strong>Figure 4.1.1. Correlation matrix heatmap of Z-Score features</strong></h5>
<p>Data Source: CQC, 2024; Ofsted, 2023; ONS, 2023c; Author’s calculations</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate correlation matrix of features</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> kmeanData.corr()</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a mask for the diagonal cells</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.triu(np.ones_like(correlation_matrix, dtype<span class="op">=</span><span class="bu">bool</span>))</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a heatmap</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, annot<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>            fmt<span class="op">=</span><span class="st">".2f"</span>, mask<span class="op">=</span>mask, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.75</span>}, linewidth<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Correlation Matrix Heatmap of Z-Score Features'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate axis labels</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>plt.yticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as .png for use in Policy Brief</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('Exports - Images/correlation_matrix_heatmap.png')</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/correlation_matrix_heatmap.png" class="img-fluid"></p>
<p>Another way of viewing this is as a scatter matrix (figure 4.1.2.) which gives a clearer view of the spread across the datapoints, as well as the distribution of data for each feature (shown on the diagonal). As mentioned in section 2.6., the features are normally distributed with some tails due to outliers, but showing that Z-scores as a standardisation approach is acceptable to use.</p>
</section>
<section id="figure-4.1.2.-scatter-matrix-of-z-score-features" class="level5">
<h5 class="anchored" data-anchor-id="figure-4.1.2.-scatter-matrix-of-z-score-features"><strong>Figure 4.1.2. Scatter matrix of Z-Score features</strong></h5>
<p>Data Source: CQC, 2024; Ofsted, 2023; ONS, 2023c; Author’s calculations</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> pd.plotting.scatter_matrix(kmeanData, alpha<span class="op">=</span><span class="fl">0.5</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>), diagonal<span class="op">=</span><span class="st">'kde'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/zscore_scattermatrix.png" class="img-fluid"></p>
</section>
</section>
<section id="identifying-the-optimal-number-of-k-means-clusters" class="level3">
<h3 class="anchored" data-anchor-id="identifying-the-optimal-number-of-k-means-clusters">4.2. Identifying the optimal number of K-means clusters</h3>
<p>There are a number of ways to determine the optimal number of K-means clusters; however, here the elbow method is used. This tests a range of K values (1 to 10) to identify where the distortions drop significantly between clusters, thus creating an “elbow” in the chart (figure 4.2.1.). The yellow line on figure 4.2.1. highlights that for this data, the optimal number of K clusters is 4.</p>
<p>It should be noted that 3 clusters were also tested during this analysis given the visible drop in the chart here also, but this model performed worse overall compared to the 4 cluster version.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>distortions <span class="op">=</span> [] <span class="co"># Empty list for distortion data</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">10</span>) <span class="co"># K value range for cluster tests</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> K:</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    kmeanModel <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, n_init<span class="op">=</span><span class="dv">10</span>) <span class="co"># Build K-Means clustering model</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    kmeanModel.fit(kmeanData) <span class="co"># Fit model to the data</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    distortions.append(kmeanModel.inertia_) <span class="co"># Add results to distortions list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="figure-4.2.1.-elbow-chart-showing-optimal-k-number-of-clusters" class="level5">
<h5 class="anchored" data-anchor-id="figure-4.2.1.-elbow-chart-showing-optimal-k-number-of-clusters"><strong>Figure 4.2.1. Elbow chart showing optimal k (number of clusters)</strong></h5>
<p>Data Source: Author’s calculations</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Elbow chart</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">8</span>))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>plt.plot(K, distortions, ls<span class="op">=</span><span class="st">'-'</span>, lw<span class="op">=</span><span class="dv">2</span>, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'k - Number of Clusters'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Distortion'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'The Elbow Method showing the optimal k (Number of Clusters)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">4</span>, color<span class="op">=</span><span class="st">'Orange'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)  <span class="co"># Adding a vertical dotted line at x=4</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as .png for use in Policy Brief</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('Exports - Images/elbow_chart.png')</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/elbow_chart.png" class="img-fluid"></p>
</section>
</section>
<section id="k-means-clustering-model" class="level3">
<h3 class="anchored" data-anchor-id="k-means-clustering-model">4.3. K-means clustering model</h3>
<p>A K-means clustering model can now be run using the parameters outlined in the previous section. The model will calculate 4 clusters, and several pieces of information from the model will be stored for further testing and visualisation.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine number of clusters for the model and number of times the model is run from different centroid seeds</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model above to the data</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>kmeans.fit(kmeanData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get cluster labels and distances from cluster centers</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>kmeans_labels <span class="op">=</span> kmeans.labels_</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>kmeans_centres <span class="op">=</span> kmeans.cluster_centers_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances from each data point to its assigned cluster center</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>distances <span class="op">=</span> np.linalg.norm(kmeanData <span class="op">-</span> kmeans_centres[kmeans_labels], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster labels and distances to the kmean dataframe</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>kmeanData[<span class="st">'Cluster'</span>] <span class="op">=</span> kmeans_labels</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>kmeanData[<span class="st">'Distance'</span>] <span class="op">=</span> distances</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A check of the number iterations that were performed before the model stabilised shows that this model performed well with a low number of iterations, which is preferable over more iterations.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the number of iterations</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>kmeans.n_iter_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>6</p>
<p>The silhouette score, or silhouette coefficient, indicates the performance of the model in terms of overlapping clusters or misassignment of clusters. The closer the score is to 1, the better the model, whilst 0 indicates overlapping clusters, and negative values imply that incorrect clusters have been assigned (scikit-learn, 2024). The silhouette score for this model is acceptable, but highlights the model is not perfect.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>metrics.silhouette_score(X<span class="op">=</span>kmeanData, labels<span class="op">=</span>kmeans_labels) <span class="co">#specify the data and the labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>0.38730634175097434</p>
<p>It is also important to check the distribution of LAs in each cluster. It is unlikely that each cluster will contain the same number of LAs, but a K-means clustering model with the majority of LAs in one cluster would likely need reviewing. This model has a small number of LAs in one cluster, but as discussed in the policy briefing this is a sensible and justifiable result in these circumstances.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the occurrences of each cluster label</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="op">=</span> kmeanData[<span class="st">'Cluster'</span>].value_counts().reset_index()</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns to 'Cluster' and 'Count'</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>cluster_counts.columns <span class="op">=</span> [<span class="st">'Cluster'</span>, <span class="st">'Count'</span>]</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the DataFrame by cluster label</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>cluster_counts.sort_values(by<span class="op">=</span><span class="st">'Cluster'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>cluster_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Cluster
</th>
<th>
Count
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0
</td>
<td>
57
</td>
</tr>
<tr>
<th>
2
</th>
<td>
1
</td>
<td>
33
</td>
</tr>
<tr>
<th>
1
</th>
<td>
2
</td>
<td>
51
</td>
</tr>
<tr>
<th>
3
</th>
<td>
3
</td>
<td>
10
</td>
</tr>
</tbody>
</table>
<p>It is also important to understand the statistics behind the model, and ensure that the model is robust. ANOVA tables show the significance of each feature, as well as its F-statistic. All of the features are statistically significant as shown in figure 4.3.1., and the range in F-statistic is relatively small compared to when the K-means model was re-run with different cluster numbers. However, the age features have a lower F-statistic than the other features such that these are contributing less to the model overall.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of the kmeanData df including features and cluster labels</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>df_for_ANOVA <span class="op">=</span> kmeanData.copy()</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dictionary mapping original column names to ASCII compliant names</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>ascii_column_names <span class="op">=</span> {</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'%U4z'</span>: <span class="st">'PC_U4z'</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'%O65z'</span>: <span class="st">'PC_O65z'</span>,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'U4:EYS Locsz'</span>: <span class="st">'U4_EYS_Locsz'</span>,</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'U4:EYS Placesz'</span>: <span class="st">'U4_EYS_Placesz'</span>,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'O65:CH Locsz'</span>: <span class="st">'O65_CH_Locsz'</span>,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'O65:CH Bedsz'</span>: <span class="st">'O65_CH_Bedsz'</span>,</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Cluster'</span>: <span class="st">'Cluster'</span>,</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Distance'</span>: <span class="st">'Distance'</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>df_for_ANOVA <span class="op">=</span> df_for_ANOVA.rename(columns<span class="op">=</span>ascii_column_names)</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform ANOVA for each feature</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>anova_results <span class="op">=</span> []</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> df_for_ANOVA.columns[:<span class="op">-</span><span class="dv">2</span>]:  <span class="co"># Exclude 'Cluster' and 'Distance' columns</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>    formula <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss"> ~ C(Cluster)"</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> ols(formula, data<span class="op">=</span>df_for_ANOVA).fit()</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>    anova_table <span class="op">=</span> sm.stats.anova_lm(model, typ<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>    anova_results.append((column, anova_table))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="figure-4.3.1.-anova-tables-for-features-in-the-k-means-cluster-model" class="level5">
<h5 class="anchored" data-anchor-id="figure-4.3.1.-anova-tables-for-features-in-the-k-means-cluster-model"><strong>Figure 4.3.1. ANOVA tables for features in the K-means cluster model</strong></h5>
<p>Data Source: Author’s calculations</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print ANOVA tables in a formatted way</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column, table <span class="kw">in</span> anova_results:</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"ANOVA Table for '</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">':"</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tabulate(table, headers<span class="op">=</span><span class="st">'keys'</span>, tablefmt<span class="op">=</span><span class="st">'pretty'</span>))</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>ANOVA Table for 'PC_U4z':
+------------+-------------------+-------+-------------------+------------------------+
|            |      sum_sq       |  df   |         F         |         PR(&gt;F)         |
+------------+-------------------+-------+-------------------+------------------------+
| C(Cluster) | 73.97417079222865 |  3.0  | 47.05868675612382 | 2.2326909650674807e-21 |
|  Residual  | 77.02582920777132 | 147.0 |        nan        |          nan           |
+------------+-------------------+-------+-------------------+------------------------+

ANOVA Table for 'PC_O65z':
+------------+-------------------+-------+-------------------+------------------------+
|            |      sum_sq       |  df   |         F         |         PR(&gt;F)         |
+------------+-------------------+-------+-------------------+------------------------+
| C(Cluster) | 87.32843117619302 |  3.0  | 67.20571216761822 | 2.0239329302714326e-27 |
|  Residual  | 63.67156882380687 | 147.0 |        nan        |          nan           |
+------------+-------------------+-------+-------------------+------------------------+

ANOVA Table for 'U4_EYS_Locsz':
+------------+-------------------+-------+-------------------+-----------------------+
|            |      sum_sq       |  df   |         F         |        PR(&gt;F)         |
+------------+-------------------+-------+-------------------+-----------------------+
| C(Cluster) | 98.70417115561074 |  3.0  | 92.48355927231522 | 1.120837363066649e-33 |
|  Residual  | 52.29582884438926 | 147.0 |        nan        |          nan          |
+------------+-------------------+-------+-------------------+-----------------------+

ANOVA Table for 'U4_EYS_Placesz':
+------------+-------------------+-------+-------------------+-----------------------+
|            |      sum_sq       |  df   |         F         |        PR(&gt;F)         |
+------------+-------------------+-------+-------------------+-----------------------+
| C(Cluster) | 90.76027183013207 |  3.0  | 73.82591945195729 | 3.513831946635027e-29 |
|  Residual  | 60.23972816986792 | 147.0 |        nan        |          nan          |
+------------+-------------------+-------+-------------------+-----------------------+

ANOVA Table for 'O65_CH_Locsz':
+------------+--------------------+-------+--------------------+------------------------+
|            |       sum_sq       |  df   |         F          |         PR(&gt;F)         |
+------------+--------------------+-------+--------------------+------------------------+
| C(Cluster) | 108.92284279457296 |  3.0  | 126.84362850077896 | 1.3508317738081858e-40 |
|  Residual  | 42.07715720542714  | 147.0 |        nan         |          nan           |
+------------+--------------------+-------+--------------------+------------------------+

ANOVA Table for 'O65_CH_Bedsz':
+------------+-------------------+-------+-------------------+------------------------+
|            |      sum_sq       |  df   |         F         |         PR(&gt;F)         |
+------------+-------------------+-------+-------------------+------------------------+
| C(Cluster) | 90.53224276482536 |  3.0  | 73.36273244306693 | 4.6328666850279454e-29 |
|  Residual  | 60.46775723517465 | 147.0 |        nan        |          nan           |
+------------+-------------------+-------+-------------------+------------------------+</code></pre>
<p>The boxplot below (figure 4.3.2.) shows the distribution of each LA from the cluster centre to which it has been assigned, and helps to identify any outliers. There are a few extreme outliers at the top end for each cluster, but the majority of the data falls within the upper and lower quartiles.</p>
<p>Cluster 0 has the most outliers but these are fairly close to the upper extreme. This cluster has a relatively low mean and the smallest range between the upper and lower quartiles. This shows that most LAs in this cluster are near to the centre despite the outliers on the top end.</p>
<p>Cluster 1 only has one outliers, but has the largest range between the upper and lower extremes and quartiles, suggesting some variance in the results. However, the mean is still fairly low, highlighting that LAs in this cluster mostly have values closer to the cluster centre.</p>
<p>Cluster 2, has the lowest mean and fairly small range between the upper and lower quartiles. There are two outliers on the top end, but overall this cluster performs well.</p>
<p>Cluster 3 has the highest mean and one extreme outlier on the top end, but does have a relatively small range between the quartiles. As highlighted above, this cluster has the fewest LAs within it and as shown in the visualisations in section 4.4. all the LAs in this cluster are in London. This issue is discussed in depth in the policy briefing.</p>
</section>
<section id="figure-4.3.2.-boxplot-of-distance-from-cluster-centres" class="level5">
<h5 class="anchored" data-anchor-id="figure-4.3.2.-boxplot-of-distance-from-cluster-centres"><strong>Figure 4.3.2. Boxplot of distance from cluster centres</strong></h5>
<p>Data Source: Author’s calculations</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#ed6a5a'</span>,<span class="st">'#f4f1bb'</span>,<span class="st">'#9bc1bc'</span>, <span class="st">'#81a4cd'</span>]</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot boxplot</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>kmeanData, x<span class="op">=</span><span class="st">"Cluster"</span>, y<span class="op">=</span><span class="st">"Distance"</span>, hue<span class="op">=</span><span class="st">"Cluster"</span>, legend<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span>palette, linewidth<span class="op">=</span><span class="fl">1.25</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distance from Cluster Centre'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Distance'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as .png for use in Policy Brief</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('Exports - Images/distance_from_cluster_centres.png')</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/distance_from_cluster_centres.png" class="img-fluid"></p>
<p>To present the final cluster centres, the results must be transformed into a useable dataframe.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable names</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="op">=</span> [<span class="st">'%U4z'</span>, <span class="st">'%O65z'</span>, <span class="st">'U4:EYS Locsz'</span>, <span class="st">'U4:EYS Placesz'</span>, <span class="st">'O65:CH Locsz'</span>, <span class="st">'O65:CH Bedsz'</span>]</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the cluster centres array to match variable names</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>cluster_centres_reshaped <span class="op">=</span> kmeans_centres.T</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to store the data</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> []</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through each cluster and variable, and append the data</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, cluster_centre <span class="kw">in</span> <span class="bu">enumerate</span>(cluster_centres_reshaped):</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j, centre <span class="kw">in</span> <span class="bu">enumerate</span>(cluster_centre):</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>        data.append([j, variable_names[i], centre])</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Cluster centres dataframe</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>df_cluster_centres <span class="op">=</span> pd.DataFrame(data, columns<span class="op">=</span>[<span class="st">'Cluster Number'</span>, <span class="st">'Feature Name'</span>, <span class="st">'Centre'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These clusters centres can then be used to present, by feature, each cluster which makes it easier to identify what each cluster represents. Figure 4.3.3. illstrates these results, with the below discussion developing pen portraits for each cluster. These pen portraits are used and discussed further in the policy briefing.</p>
<p>Cluster 0 has an above average proportion of the population aged under 4, but all other features are around the average. This implies there is a large target under 4 population in these LAs but provision is currently in line with the average. This cluster is “Young areas with adequate provision”.</p>
<p>Cluster 1 has an above average proportion of the population aged under 4 as well as EYS ratios for both locations and places. This implies there are a large number of children in these areas compared to the average across all LAs, and that current provision is poor with more children to each EYS location and place. This cluster is “EYS opportunity”.</p>
<p>Cluster 2 has an above average proportion of the population aged over 65, whilst having a below average proportion of children. The ratio features are all slightly below average. These are areas with provision in line with the average despite the older population. This cluster is “Older areas with adequate provision”.</p>
<p>Cluster 3 shows significantly above average ratios for older people to care home locations and beds. This implies provision is significantly lacking in these areas. Meanwhile the proportion of the population over 65 is actually very below average, but the population that does live in these areas is lacking services. This cluster is “Care home opportunity”.</p>
</section>
<section id="figure-4.3.3.-k-means-cluster-model-centres-by-feature" class="level5">
<h5 class="anchored" data-anchor-id="figure-4.3.3.-k-means-cluster-model-centres-by-feature"><strong>Figure 4.3.3. K-means cluster model centres by feature</strong></h5>
<p>Data Source: Author’s calculations</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#003049'</span>,<span class="st">'#6b2c39'</span>,<span class="st">'#d62828'</span>,<span class="st">'#f77f00'</span>,<span class="st">'#fcbf49'</span>,<span class="st">'#eae2b7'</span>]</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the bar chart</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seaborn style</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add data and format</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>df_cluster_centres, x<span class="op">=</span><span class="st">'Cluster Number'</span>, y<span class="op">=</span><span class="st">'Centre'</span>, hue<span class="op">=</span><span class="st">'Feature Name'</span>, palette<span class="op">=</span>palette)</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'K-means Cluster Model Centres by Feature'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cluster Number'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Z-Score Value of Cluster Centre'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Feature Name'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add black line behind the x-axis and show grid for ease of reading</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as .png for use in Policy Brief</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('Exports - Images/cluster_centres_by_feature.png')</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/cluster_centres_by_feature.png" class="img-fluid"></p>
</section>
</section>
<section id="visualising-results" class="level3">
<h3 class="anchored" data-anchor-id="visualising-results">4.4. Visualising results</h3>
<p>The resulting clusters can be visualised on a map to highlight any spatial patterns that have been found in the data. Figure 4.4.1. shows that cluster 3 (“Care home opportunity”), the smallest cluster as discussed above, contains only LAs in London.</p>
<p>Across the other clusters, there is more geographic variation. However, cluster 2 (“Older areas with adequate provision”) covers more geographically large LAs, which primarily include large amounts of rural land such as North Yorkshire, Derbyshire and Devon. In contrast, Cluster 1 (“EYS opportunity”) includes a number of mostly urban LAs, such as Derby and Leicester, as well as areas known for their large young populations, like Bradford (CBMDC, 2024).</p>
<p>Cluster 0 (“Young areas with adequate provision”) is perhaps the most geographically varied covering rural-urban mix LAs such as Essex, Bedfordshire and Leeds, as well as mostly urban LAs such as those around outer London and City of Bristol.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset index to get CTYUA22CD as a column for merging</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>kmeanData.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add K-means clustering results to final_df for visualising</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> pd.merge(final_df, kmeanData[[<span class="st">'CTYUA22CD'</span>, <span class="st">'Cluster'</span>, <span class="st">'Distance'</span>]], on<span class="op">=</span><span class="st">'CTYUA22CD'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="figure-4.4.1.-map-of-k-means-cluster-model-results" class="level5">
<h5 class="anchored" data-anchor-id="figure-4.4.1.-map-of-k-means-cluster-model-results"><strong>Figure 4.4.1. Map of K-means cluster model results</strong></h5>
<p>Data Source: Author’s calculations</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot clusters</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> clrs.ListedColormap([<span class="st">'#ed6a5a'</span>,<span class="st">'#f4f1bb'</span>,<span class="st">'#9bc1bc'</span>, <span class="st">'#81a4cd'</span>])</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>final_df.plot(ax<span class="op">=</span>axes,</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>              column<span class="op">=</span><span class="st">'Cluster'</span>,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>              categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>              cmap<span class="op">=</span>cmap,</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>              linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>              legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'frameon'</span>:<span class="va">False</span>})</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>axes.set_title(<span class="st">"Map of K-means cluster model results"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>axes.set_axis_off()</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as .png for use in Policy Brief</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('Exports - Images/map_cluster_results.png')</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/map_cluster_results.png" class="img-fluid"></p>
<p>To provide further clarity on cluster 3, figure 4.4.2. shows a focused map of the LAs included in this cluster. This is discussed further in the policy briefing.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>Cluster_London <span class="op">=</span> final_df[final_df[<span class="st">'Cluster'</span>] <span class="op">==</span> <span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="figure-4.4.2.-map-of-cluster-containing-london-las-only" class="level5">
<h5 class="anchored" data-anchor-id="figure-4.4.2.-map-of-cluster-containing-london-las-only"><strong>Figure 4.4.2. Map of cluster containing London LAs only</strong></h5>
<p>Data Source: Author’s calculations</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>Cluster_London.plot(ax <span class="op">=</span> ax, edgecolor <span class="op">=</span> <span class="st">'black'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'#81a4cd'</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, crs <span class="op">=</span> Cluster_London.crs, source<span class="op">=</span>cx.providers.CartoDB.Positron)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each polygon and add label</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> Cluster_London.iterrows():</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    centroid_x, centroid_y <span class="op">=</span> row.geometry.centroid.x, row.geometry.centroid.y</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    bbox_props <span class="op">=</span> <span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">"round,pad=0.3"</span>, fc<span class="op">=</span><span class="st">"#F7F7F7"</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    ax.annotate(text<span class="op">=</span>row[<span class="st">'CTYUA22NM'</span>], xy<span class="op">=</span>(centroid_x, centroid_y), xycoords<span class="op">=</span><span class="st">'data'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'black'</span>, bbox<span class="op">=</span>bbox_props)</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Map of cluster containing London LAs only"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as .png for use in Policy Brief</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('Exports - Images/map_London_cluster.png')</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="Outputs/map_London_cluster.png" class="img-fluid"></p>
<p>Simple descriptives confirm the difference between the London cluster and the dataset as a whole as being driven by low numbers of care homes in these LAs.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>Cluster_London.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
U4
</th>
<th>
%U4
</th>
<th>
O65
</th>
<th>
%O65
</th>
<th>
CH Locs
</th>
<th>
CH Beds
</th>
<th>
EYS Locs
</th>
<th>
EYS Places
</th>
<th>
U4:EYS Locs
</th>
<th>
U4:EYS Places
</th>
<th>
…
</th>
<th>
U4z
</th>
<th>
O65z
</th>
<th>
%U4z
</th>
<th>
%O65z
</th>
<th>
U4:EYS Locsz
</th>
<th>
U4:EYS Placesz
</th>
<th>
O65:CH Locsz
</th>
<th>
O65:CH Bedsz
</th>
<th>
Cluster
</th>
<th>
Distance
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
…
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
<td>
10.00
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
13378.50
</td>
<td>
0.06
</td>
<td>
24177.30
</td>
<td>
0.11
</td>
<td>
9.40
</td>
<td>
421.20
</td>
<td>
105.00
</td>
<td>
5105.52
</td>
<td>
125.89
</td>
<td>
2.61
</td>
<td>
…
</td>
<td>
-0.47
</td>
<td>
-0.72
</td>
<td>
-0.71
</td>
<td>
-1.50
</td>
<td>
-0.56
</td>
<td>
-0.54
</td>
<td>
3.14
</td>
<td>
2.85
</td>
<td>
3.00
</td>
<td>
2.43
</td>
</tr>
<tr>
<th>
std
</th>
<td>
4521.43
</td>
<td>
0.01
</td>
<td>
4929.80
</td>
<td>
0.03
</td>
<td>
3.37
</td>
<td>
140.85
</td>
<td>
23.53
</td>
<td>
1411.07
</td>
<td>
30.59
</td>
<td>
0.56
</td>
<td>
…
</td>
<td>
0.30
</td>
<td>
0.08
</td>
<td>
1.13
</td>
<td>
0.48
</td>
<td>
0.61
</td>
<td>
0.62
</td>
<td>
1.40
</td>
<td>
1.80
</td>
<td>
0.00
</td>
<td>
0.93
</td>
</tr>
<tr>
<th>
min
</th>
<td>
6171.00
</td>
<td>
0.04
</td>
<td>
17472.00
</td>
<td>
0.06
</td>
<td>
5.00
</td>
<td>
194.00
</td>
<td>
70.00
</td>
<td>
2852.00
</td>
<td>
88.16
</td>
<td>
2.10
</td>
<td>
…
</td>
<td>
-0.95
</td>
<td>
-0.83
</td>
<td>
-2.29
</td>
<td>
-2.33
</td>
<td>
-1.31
</td>
<td>
-1.11
</td>
<td>
1.10
</td>
<td>
1.31
</td>
<td>
3.00
</td>
<td>
1.15
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
9314.25
</td>
<td>
0.05
</td>
<td>
20528.75
</td>
<td>
0.09
</td>
<td>
7.25
</td>
<td>
338.25
</td>
<td>
90.25
</td>
<td>
4308.82
</td>
<td>
104.26
</td>
<td>
2.18
</td>
<td>
…
</td>
<td>
-0.74
</td>
<td>
-0.78
</td>
<td>
-1.43
</td>
<td>
-1.83
</td>
<td>
-0.99
</td>
<td>
-1.01
</td>
<td>
2.33
</td>
<td>
1.66
</td>
<td>
3.00
</td>
<td>
2.02
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
15098.50
</td>
<td>
0.05
</td>
<td>
24803.50
</td>
<td>
0.11
</td>
<td>
9.50
</td>
<td>
382.00
</td>
<td>
105.50
</td>
<td>
5105.50
</td>
<td>
121.61
</td>
<td>
2.32
</td>
<td>
…
</td>
<td>
-0.35
</td>
<td>
-0.71
</td>
<td>
-0.93
</td>
<td>
-1.45
</td>
<td>
-0.65
</td>
<td>
-0.86
</td>
<td>
2.72
</td>
<td>
2.01
</td>
<td>
3.00
</td>
<td>
2.31
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
16305.25
</td>
<td>
0.06
</td>
<td>
26865.50
</td>
<td>
0.12
</td>
<td>
11.00
</td>
<td>
513.50
</td>
<td>
118.00
</td>
<td>
5749.18
</td>
<td>
137.31
</td>
<td>
2.95
</td>
<td>
…
</td>
<td>
-0.27
</td>
<td>
-0.68
</td>
<td>
0.29
</td>
<td>
-1.19
</td>
<td>
-0.34
</td>
<td>
-0.17
</td>
<td>
3.65
</td>
<td>
3.54
</td>
<td>
3.00
</td>
<td>
2.61
</td>
</tr>
<tr>
<th>
max
</th>
<td>
19090.00
</td>
<td>
0.07
</td>
<td>
33949.00
</td>
<td>
0.15
</td>
<td>
16.00
</td>
<td>
625.00
</td>
<td>
147.00
</td>
<td>
7279.43
</td>
<td>
185.34
</td>
<td>
3.65
</td>
<td>
…
</td>
<td>
-0.09
</td>
<td>
-0.57
</td>
<td>
0.95
</td>
<td>
-0.69
</td>
<td>
0.62
</td>
<td>
0.61
</td>
<td>
5.71
</td>
<td>
6.55
</td>
<td>
3.00
</td>
<td>
4.72
</td>
</tr>
</tbody>
</table>
<p>
8 rows × 22 columns
</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>final_df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
U4
</th>
<th>
%U4
</th>
<th>
O65
</th>
<th>
%O65
</th>
<th>
CH Locs
</th>
<th>
CH Beds
</th>
<th>
EYS Locs
</th>
<th>
EYS Places
</th>
<th>
U4:EYS Locs
</th>
<th>
U4:EYS Places
</th>
<th>
…
</th>
<th>
U4z
</th>
<th>
O65z
</th>
<th>
%U4z
</th>
<th>
%O65z
</th>
<th>
U4:EYS Locsz
</th>
<th>
U4:EYS Placesz
</th>
<th>
O65:CH Locsz
</th>
<th>
O65:CH Bedsz
</th>
<th>
Cluster
</th>
<th>
Distance
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
…
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
<td>
151.00
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
20375.75
</td>
<td>
0.06
</td>
<td>
68874.81
</td>
<td>
0.19
</td>
<td>
71.11
</td>
<td>
2756.13
</td>
<td>
149.15
</td>
<td>
7229.03
</td>
<td>
154.32
</td>
<td>
3.10
</td>
<td>
…
</td>
<td>
-0.00
</td>
<td>
-0.00
</td>
<td>
-0.00
</td>
<td>
-0.00
</td>
<td>
0.00
</td>
<td>
-0.00
</td>
<td>
0.00
</td>
<td>
0.00
</td>
<td>
1.09
</td>
<td>
1.38
</td>
</tr>
<tr>
<th>
std
</th>
<td>
15025.87
</td>
<td>
0.01
</td>
<td>
61972.17
</td>
<td>
0.06
</td>
<td>
69.11
</td>
<td>
2676.12
</td>
<td>
134.77
</td>
<td>
6260.93
</td>
<td>
50.54
</td>
<td>
0.91
</td>
<td>
…
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
1.00
</td>
<td>
0.99
</td>
<td>
0.67
</td>
</tr>
<tr>
<th>
min
</th>
<td>
96.00
</td>
<td>
0.04
</td>
<td>
580.00
</td>
<td>
0.06
</td>
<td>
1.00
</td>
<td>
14.00
</td>
<td>
1.00
</td>
<td>
32.00
</td>
<td>
76.57
</td>
<td>
1.49
</td>
<td>
…
</td>
<td>
-1.35
</td>
<td>
-1.11
</td>
<td>
-2.29
</td>
<td>
-2.33
</td>
<td>
-1.54
</td>
<td>
-1.78
</td>
<td>
-1.19
</td>
<td>
-1.07
</td>
<td>
0.00
</td>
<td>
0.25
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
11161.00
</td>
<td>
0.06
</td>
<td>
31390.00
</td>
<td>
0.15
</td>
<td>
29.00
</td>
<td>
1141.00
</td>
<td>
75.00
</td>
<td>
3847.50
</td>
<td>
119.53
</td>
<td>
2.47
</td>
<td>
…
</td>
<td>
-0.62
</td>
<td>
-0.61
</td>
<td>
-0.63
</td>
<td>
-0.69
</td>
<td>
-0.69
</td>
<td>
-0.70
</td>
<td>
-0.49
</td>
<td>
-0.51
</td>
<td>
0.00
</td>
<td>
0.96
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
16316.00
</td>
<td>
0.06
</td>
<td>
43282.00
</td>
<td>
0.19
</td>
<td>
51.00
</td>
<td>
1735.00
</td>
<td>
107.00
</td>
<td>
5397.43
</td>
<td>
140.57
</td>
<td>
2.86
</td>
<td>
…
</td>
<td>
-0.27
</td>
<td>
-0.41
</td>
<td>
-0.02
</td>
<td>
-0.02
</td>
<td>
-0.27
</td>
<td>
-0.26
</td>
<td>
-0.20
</td>
<td>
-0.26
</td>
<td>
1.00
</td>
<td>
1.20
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
23909.50
</td>
<td>
0.06
</td>
<td>
79181.50
</td>
<td>
0.23
</td>
<td>
80.00
</td>
<td>
3225.00
</td>
<td>
166.00
</td>
<td>
8205.22
</td>
<td>
182.29
</td>
<td>
3.59
</td>
<td>
…
</td>
<td>
0.24
</td>
<td>
0.17
</td>
<td>
0.68
</td>
<td>
0.61
</td>
<td>
0.56
</td>
<td>
0.55
</td>
<td>
0.11
</td>
<td>
0.12
</td>
<td>
2.00
</td>
<td>
1.65
</td>
</tr>
<tr>
<th>
max
</th>
<td>
87286.00
</td>
<td>
0.08
</td>
<td>
319328.00
</td>
<td>
0.35
</td>
<td>
340.00
</td>
<td>
13268.00
</td>
<td>
763.00
</td>
<td>
34881.58
</td>
<td>
324.88
</td>
<td>
6.53
</td>
<td>
…
</td>
<td>
4.47
</td>
<td>
4.05
</td>
<td>
3.15
</td>
<td>
2.59
</td>
<td>
3.39
</td>
<td>
3.80
</td>
<td>
5.71
</td>
<td>
6.55
</td>
<td>
3.00
</td>
<td>
4.72
</td>
</tr>
</tbody>
</table>
<p>
8 rows × 22 columns
</p>
<p>Full discussion of the results outlined in this notebook is conducted in the accompanying policy brief.</p>
</section>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Care Quality Commission (CQC). 2024. Care directory with filters (01 March 2024). <em>Care Quality Commission</em>. [Online]. [Accessed 29 April 2024]. Available from: https://www.cqc.org.uk/about-us/transparency/using-cqc-data</p>
<p>City of Bradford Metropolitan District Council (CBMDC). 2024. <em>1.1 Demographics of Bradford District - 2024.</em> [Online]. [Accessed 29 April 2024]. Available from: https://jsna.bradford.gov.uk/The%20population%20of%20Bradford%20District.asp</p>
<p>Office for National Statistics (ONS). 2023a. <em>Area type definitions Census 2021.</em> [Online]. [Accessed 29 April 2024]. Available from: https://www.ons.gov.uk/census/census2021dictionary/areatypedefinitions</p>
<p>Office for National Statistics (ONS). 2023b. Counties and Unitary Authorities (December 2022) Boundaries UK BFC. <em>Open Geography Portal.</em> [Online]. [Accessed 29 April 2024]. Available from: https://geoportal.statistics.gov.uk/datasets/e204895bba5646a486da29b5ed382db1_0/explore</p>
<p>Office for National Statistics (ONS). 2023c. Age of all usual residents, by Upper Tier Local Authority in England. <em>Office for National Statistics.</em> [Online]. [Accessed 29 April 2024]. Available from: https://www.ons.gov.uk/datasets/create/filter-outputs/b42f8cd2-78e3-4c54-8d71-de05f72930eb#get-data</p>
<p>Office for National Statistics (ONS). 2024. ONS Postcode Directory (February 2024). <em>Open Geography Portal.</em> [Online]. [Accessed 29 April 2024]. Available from: https://geoportal.statistics.gov.uk/datasets/e14b1475ecf74b58804cf667b6740706/about</p>
<p>Ofsted. 2023. Childcare providers and inspections as at 31 August 2023. <em>Ofsted.</em> [Online]. [Accessed 29 April 2024]. Available from: https://www.gov.uk/government/statistics/childcare-providers-and-inspections-as-at-31-august-2023</p>
<p>Ofsted. 2024. <em>What we do</em>. [Online]. [Accessed 29 April 2024]. Available from: https://www.gov.uk/government/organisations/ofsted</p>
<p>scikit-learn. 2024. <em>sklearn.metrics.silhouette_score</em>. [Online]. [Accessed 29 April 2024]. Available from: https://scikit-learn.org/stable/modules/generated/sklearn.metrics.silhouette_score.html#sklearn.metrics.silhouette_score</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>