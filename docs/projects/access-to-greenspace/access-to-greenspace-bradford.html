<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Jess Arkesden - A spatial analysis of access to greenspace and deprivation in Bradford</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #355070;
      }
</style>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jess Arkesden</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title"><span style="color: white;">A spatial analysis of access to greenspace and deprivation in Bradford</span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Content list</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">2. Background</a>
  <ul class="collapse">
  <li><a href="#why-is-greenspace-important" id="toc-why-is-greenspace-important" class="nav-link" data-scroll-target="#why-is-greenspace-important">2.1. Why is greenspace important?</a></li>
  <li><a href="#why-bradford" id="toc-why-bradford" class="nav-link" data-scroll-target="#why-bradford">2.2. Why Bradford?</a></li>
  <li><a href="#review-of-current-literature" id="toc-review-of-current-literature" class="nav-link" data-scroll-target="#review-of-current-literature">2.3. Review of current literature</a></li>
  </ul></li>
  <li><a href="#research-question" id="toc-research-question" class="nav-link" data-scroll-target="#research-question">3. Research question</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">4. Data</a>
  <ul class="collapse">
  <li><a href="#import-libraries" id="toc-import-libraries" class="nav-link" data-scroll-target="#import-libraries">4.1. Import libraries</a></li>
  <li><a href="#import-each-datafile" id="toc-import-each-datafile" class="nav-link" data-scroll-target="#import-each-datafile">4.2. Import each datafile</a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">5. Data wrangling</a>
  <ul class="collapse">
  <li><a href="#oas" id="toc-oas" class="nav-link" data-scroll-target="#oas">5.1. OAs</a></li>
  <li><a href="#greenspace-1" id="toc-greenspace-1" class="nav-link" data-scroll-target="#greenspace-1">5.2. Greenspace</a></li>
  <li><a href="#dependent-variable" id="toc-dependent-variable" class="nav-link" data-scroll-target="#dependent-variable">5.3. Dependent variable</a></li>
  <li><a href="#independent-variables-1" id="toc-independent-variables-1" class="nav-link" data-scroll-target="#independent-variables-1">5.4. Independent variables</a></li>
  <li><a href="#final-dataframe-for-regression-analysis" id="toc-final-dataframe-for-regression-analysis" class="nav-link" data-scroll-target="#final-dataframe-for-regression-analysis">5.5. Final dataframe for regression analysis</a></li>
  </ul></li>
  <li><a href="#visualisation-and-statistics" id="toc-visualisation-and-statistics" class="nav-link" data-scroll-target="#visualisation-and-statistics">6. Visualisation and Statistics</a>
  <ul class="collapse">
  <li><a href="#oas-1" id="toc-oas-1" class="nav-link" data-scroll-target="#oas-1">6.1. OAs</a></li>
  <li><a href="#greenspace-2" id="toc-greenspace-2" class="nav-link" data-scroll-target="#greenspace-2">6.2. Greenspace</a></li>
  <li><a href="#deprivation" id="toc-deprivation" class="nav-link" data-scroll-target="#deprivation">6.3. Deprivation</a></li>
  <li><a href="#distance-to-nearest-greenspace" id="toc-distance-to-nearest-greenspace" class="nav-link" data-scroll-target="#distance-to-nearest-greenspace">6.4. Distance to nearest greenspace</a></li>
  <li><a href="#dependent-and-independent-variables" id="toc-dependent-and-independent-variables" class="nav-link" data-scroll-target="#dependent-and-independent-variables">6.5. Dependent and independent variables</a></li>
  </ul></li>
  <li><a href="#analysis-and-results" id="toc-analysis-and-results" class="nav-link" data-scroll-target="#analysis-and-results">7. Analysis and results</a>
  <ul class="collapse">
  <li><a href="#ols-regression" id="toc-ols-regression" class="nav-link" data-scroll-target="#ols-regression">7.1. OLS Regression</a></li>
  <li><a href="#morans-i" id="toc-morans-i" class="nav-link" data-scroll-target="#morans-i">7.2. Moran’s I</a></li>
  <li><a href="#lisa-clusters" id="toc-lisa-clusters" class="nav-link" data-scroll-target="#lisa-clusters">7.3. LISA Clusters</a></li>
  <li><a href="#gwr-model" id="toc-gwr-model" class="nav-link" data-scroll-target="#gwr-model">7.4. GWR model</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">8. Discussion</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">9. Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#appendix-1---wrangled-dataframes" id="toc-appendix-1---wrangled-dataframes" class="nav-link" data-scroll-target="#appendix-1---wrangled-dataframes">Appendix 1 - Wrangled dataframes</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<p><strong>Return to the <a href="../../projects/access-to-greenspace/index.html">summary page</a> or go back to the <a href="../../projects/index.html">projects page</a>.</strong></p>
<hr>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">1. Introduction</h2>
<p>Greenspace is an important part of urban life, with benefits for humans and the environment. Analysing Bradford local authority district (LAD), this study builds on the growing literature addressing the challenge of greenspace accessibility by focusing on each deprivation dimension. Results show that considering deprivation and the relationship with greenspace in this greater level of detail is important for future policy and development.</p>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">2. Background</h2>
<section id="why-is-greenspace-important" class="level3">
<h3 class="anchored" data-anchor-id="why-is-greenspace-important">2.1. Why is greenspace important?</h3>
<p>Natural England (2023) estimates benefits of £6.6 billion in health, climate, and environmental gains from greenspace. However, a third of people do not have access to quality greenspace within a 15-minute walk of their home (Natural England, 2023). Public policy highlights commitments to improve this, with the Green Infrastructure Framework seeking to determine where greenspace is needed (Natural England, 2023).</p>
</section>
<section id="why-bradford" class="level3">
<h3 class="anchored" data-anchor-id="why-bradford">2.2. Why Bradford?</h3>
<p>Bradford is the fifth largest district in England (CBMDC, 2021) and has a young population, ranking 4th for children aged 14 or less (21.4%) (CBMDC, 2022). Bradford is diverse – a third of people identify as Muslim, nearly 20% were born outside the UK, and 39% are Black, Asian, Mixed, or “Other” non-White ethnicities (ONS, 2023h). Over a fifth of the population have poor health, and a fifth are disabled (ONS, 2023h).</p>
<p>Greenspace assets include extensive moorland and woodland as well as 36 council recognised parks (CBMDC, 2019). There are sports grounds and facilities, but not all are freely accessible. Limited utilisation data exists, but estimates suggest it is below national and regional averages, with surveys finding those most likely to utilise urban greenspace were ethnic minorities, households without a car, and people with children (CBMDC, 2019).</p>
<p>The council recognise the need to embed greenspace within long-term strategies. Key ambitions include ensuring greenspaces are safe and inclusive, improving health outcomes by prioritising investment for those most in need (CBMDC, 2021).</p>
</section>
<section id="review-of-current-literature" class="level3">
<h3 class="anchored" data-anchor-id="review-of-current-literature">2.3. Review of current literature</h3>
<p>An increasing body of literature acknowledges the connection between greenspace access and overall health (Jia et al, 2021; Lachowycz and Jones, 2011; McCormick, 2017) and social benefits, including community cohesion (Barbosa et al, 2007). Methodologies vary, but most find deprived communities have the best access whilst utilisation levels are unclear, but perception of quality can limit use (Barbosa et al, 2007; Jones et al, 2009; Kessel et al, 2009; Roe et al, 2016). This quality issue is worse in deprived areas (Gidlow and Ellis, 2011; Mears et al, 2019).</p>
<p>Several Bradford-specific studies exist. Mueller et al (2018) analysed health impacts and determined greenspace promotes an active lifestyle, and helps mitigate pollution, noise, and heat effects. McEachan et al (2018) demonstrated the positive impact greenspace had on children, but this impact differed by ethnicity, and perceived quality of greenspace was more important than quantity. Perception has also been linked to biodiversity and facilities (Wood et al, 2018).</p>
</section>
</section>
<section id="research-question" class="level2">
<h2 class="anchored" data-anchor-id="research-question">3. Research question</h2>
<p>No literature reviewed analyses the dimensions of deprivation. This study aims to investigate whether there is a statistically significant relationship between greenspace access and each dimension of the 2021 UK Census deprivation measure. The null hypothesis is that there is not a statistically significant relationship present.</p>
<p>The remainder of this notebook will be structured as follows: Section 4 explains the datasets used; Section 5 outlines data wrangling processes preparing for analysis; Section 6 presents visual analyses and statistical descriptors of the data; Section 7 includes analysis and results of the OLS regression, Moran’s I and LISA cluster evaluation, and subsequent GWR model; Section 8 discusses findings, how this could influence policy, and further opportunities to improve this study; Section 9 draws conclusions from the findings.</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">4. Data</h2>
<section id="import-libraries" class="level3">
<h3 class="anchored" data-anchor-id="import-libraries">4.1. Import libraries</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set number of threads to recommended 7 to avoid errors in code during visualisation phase</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"OMP_NUM_THREADS"</span>] <span class="op">=</span> <span class="st">'7'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation libraries</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.lines <span class="im">import</span> Line2D</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression libraries</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm <span class="co"># add statsmodels</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.sandbox.regression.predstd <span class="im">import</span> wls_prediction_std <span class="co"># for predictions</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial analysis libraries</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pysal.lib <span class="im">import</span> weights</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pysal.lib <span class="im">import</span> io</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pysal.explore <span class="im">import</span> esda</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pysal.viz <span class="im">import</span> splot</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> splot.esda <span class="im">import</span> moran_scatterplot, lisa_cluster, plot_local_autocorrelation</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mgwr.gwr <span class="im">import</span> GWR, MGWR</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mgwr.sel_bw <span class="im">import</span> Sel_BW</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Other required libraries</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> probplot</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-each-datafile" class="level3">
<h3 class="anchored" data-anchor-id="import-each-datafile">4.2. Import each datafile</h3>
<p><strong>Links to datafiles are located in the appendix to this notebook and can be downloaded and saved locally using the links provided.</strong></p>
<section id="output-areas-oas" class="level4">
<h4 class="anchored" data-anchor-id="output-areas-oas">4.2.1. Output Areas (OAs)</h4>
<p>OAs are the lowest census geography level, containing 40 to 250 households (ONS, 2021), enabling more accurate nearest greenspace measurements, and capturing localised differences in deprivation. Polygons and population weighted centroids (PWCs) are available from the ONS (2023a, 2023b). PWCs are used to measure distance to greenspace as it captures the nearest greenspace for most households. Polygons are aggregated to Bradford LAD level using the ONS (2023c) lookup. This is necessary to reduce the OA PWCs and greenspace to those within Bradford LAD.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OA polygons (BFC: Full resolution - clipped to the coastline (Mean High Water mark)) (ONS, 2023a)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>OA_polygons <span class="op">=</span> gpd.read_file(<span class="st">'Data/Output_Areas_2021_EW_BFC_V8/OA_2021_EW_BFC_V8.shp'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># OA Population-weighted centroids (ONS, 2023b)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>OA_PWC <span class="op">=</span> gpd.read_file(<span class="st">'Data/Output_Areas_2021_PWC_V3/PopCentroids_EW_2021_V3.shp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OA to LSOA to MSOA to LAD lookup (ONS, 2023c)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>OA_lookup <span class="op">=</span> pd.read_csv(<span class="st">'Data/Output_Area_Lookup_in_England_and_Wales_v3.csv'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">### Error can be ignored - it is because of Welsh spellings in a certain column.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">### This is not relevant to, nor will it affect, this study as these columns/rows will not be used.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="greenspace" class="level4">
<h4 class="anchored" data-anchor-id="greenspace">4.2.2. Greenspace</h4>
<p>Greenspace data (OS, 2023) include site (polygon) and access (point) data. However, not all sites have access data, hence only sites are used to ensure all eligible greenspace is captured. Distance from the PWC to nearest greenspace will be calculated using these polygons. Data includes parks, gardens, sports facilities, and religious grounds, but does not include forests, woodland, moorland or canal and river paths (OS, 2023).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Greenspace site polygons (OS, 2023)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>GB_greenspace_site <span class="op">=</span> gpd.read_file(<span class="st">'Data/OS Open Greenspace (ESRI Shape File) GB/data/GB_GreenspaceSite.shp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="independent-variables" class="level4">
<h4 class="anchored" data-anchor-id="independent-variables">4.2.3. Independent variables</h4>
<p>Each deprivation dimension (education, employment, health and disability, and housing) can be obtained via custom ONS queries (ONS, 2023d; ONS, 2023e; ONS, 2023f; ONS, 2023g). These queries include only Bradford LAD OAs. Each file contains the number of households that are deprived or not deprived, from which percentage of households deprived in each dimension is calculated (Section 5.4.) creating the independent variables for regression modelling.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data for Bradford OAs only, from 2021 Census</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Household deprivation in the education dimension (ONS, 2023d)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>HHD_dep_education_raw <span class="op">=</span> pd.read_csv(<span class="st">'Data/2021 Census Data/Household deprived in the education dimension.csv'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Household deprivation in the employment dimension (ONS, 2023e)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>HHD_dep_employment_raw <span class="op">=</span> pd.read_csv(<span class="st">'Data/2021 Census Data/Household deprived in the employment dimension.csv'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Household deprivation in the health and disability dimension (ONS, 2023f)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>HHD_dep_health_raw <span class="op">=</span> pd.read_csv(<span class="st">'Data/2021 Census Data/Household deprived in the health and disability dimension.csv'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Household deprivation in the housing dimension (ONS, 2023g)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>HHD_dep_housing_raw <span class="op">=</span> pd.read_csv(<span class="st">'Data/2021 Census Data/Household deprived in the housing dimension.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">5. Data wrangling</h2>
<section id="oas" class="level3">
<h3 class="anchored" data-anchor-id="oas">5.1. OAs</h3>
<p>Only Bradford LAD OAs are needed. The OA lookup and geometry dataframes can be merged, retaining only Bradford as identified by the LAD22NM column. There are 1,575 OAs within Bradford LAD.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unnecessary columns from OA lookup, keeping only required columns in new dataframe</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>OA_lookup_trim <span class="op">=</span> OA_lookup[[<span class="st">'OA21CD'</span>,<span class="st">'LAD22CD'</span>,<span class="st">'LAD22NM'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter OA lookup to just Bradford</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Bradford_OA_lookup <span class="op">=</span> OA_lookup_trim[OA_lookup_trim[<span class="st">'LAD22NM'</span>] <span class="op">==</span> <span class="st">'Bradford'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check how many OAs are left - this number is an important reference point for further data wrangling tasks</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(Bradford_OA_lookup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>1575</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge Bradford_OA_lookup with OA polygons to reduce the geodataframe containing the polygons to only Bradford OAs</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Bradford_OA_polygons <span class="op">=</span> OA_polygons.merge(Bradford_OA_lookup, how<span class="op">=</span><span class="st">'right'</span>, on<span class="op">=</span><span class="st">'OA21CD'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check number of OAs is same as in the reduced Bradford OA lookup dataframe</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(Bradford_OA_polygons))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(Bradford_OA_polygons) <span class="op">==</span> <span class="bu">len</span>(Bradford_OA_lookup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>1575</p>
<p>True</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge Bradford_OA_lookup with OA PWCs to reduce the geodataframe containing the PWCs to only Bradford OAs</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Bradford_OA_PWC <span class="op">=</span> OA_PWC.merge(Bradford_OA_lookup, how<span class="op">=</span><span class="st">'right'</span>, on<span class="op">=</span><span class="st">'OA21CD'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check number of OAs is same as in the reduced Bradford OA lookup dataframe</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(Bradford_OA_PWC))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(Bradford_OA_PWC) <span class="op">==</span> <span class="bu">len</span>(Bradford_OA_lookup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>1575</p>
<p>True</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unrequired columns</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Bradford_OA_polygons_tidy <span class="op">=</span> Bradford_OA_polygons.drop([</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LSOA21CD'</span>,<span class="st">'LSOA21NM'</span>,<span class="st">'LSOA21NMW'</span>,<span class="st">'BNG_E'</span>,<span class="st">'BNG_N'</span>,<span class="st">'LAT'</span>,<span class="st">'LONG'</span>,<span class="st">'GlobalID'</span>,<span class="st">'LAD22CD'</span>,<span class="st">'LAD22NM'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>Bradford_OA_PWC_tidy <span class="op">=</span> Bradford_OA_PWC.drop([<span class="st">'GlobalID'</span>,<span class="st">'LAD22CD'</span>,<span class="st">'LAD22NM'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename geometry columns and set geometry</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>Bradford_OA_polygons <span class="op">=</span> Bradford_OA_polygons_tidy.set_geometry(<span class="st">'geometry'</span>).rename_geometry(<span class="st">'Polygon'</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>Bradford_OA_PWC <span class="op">=</span> Bradford_OA_PWC_tidy.set_geometry(<span class="st">'geometry'</span>).rename_geometry(<span class="st">'PWC'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="greenspace-1" class="level3">
<h3 class="anchored" data-anchor-id="greenspace-1">5.2. Greenspace</h3>
<p>Only greenspace within Bradford LAD is required. A Bradford LAD polygon is created to spatially match the greenspace, retaining only sites within Bradford LAD.</p>
<section id="clean-greenspace-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="clean-greenspace-dataframe">5.2.1. Clean greenspace dataframe</h4>
<p>Some types of greenspaces are arguably not for recreation (e.g.&nbsp;cemetery) and some are not always free to the public (e.g.&nbsp;golf course). To ensure this analysis includes only freely accessible greenspace for recreational use, types are reduced to ‘play space’, ‘playing field’ and ‘public park or garden’.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unnecessary columns, keeping only required columns in new dataframe</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>GB_greenspace_site_trim <span class="op">=</span> GB_greenspace_site[[<span class="st">'id'</span>,<span class="st">'function'</span>,<span class="st">'geometry'</span>]]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename remaining columns for clarity</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>GB_greenspace_site_trim <span class="op">=</span> GB_greenspace_site_trim.rename(columns<span class="op">=</span>{<span class="st">"id"</span>: <span class="st">"Greenspace_ID"</span>, <span class="st">"function"</span>: <span class="st">"Type"</span>})</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>GB_greenspace_site_trim <span class="op">=</span> GB_greenspace_site_trim.set_geometry(<span class="st">'geometry'</span>).rename_geometry(<span class="st">'Polygon'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check what types are included in the data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>GB_greenspace_site_trim.Type.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Type</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Play Space</td>
<td style="text-align: center;">42972</td>
</tr>
<tr class="even">
<td style="text-align: center;">Religious Grounds</td>
<td style="text-align: center;">22229</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Playing Field</td>
<td style="text-align: center;">21377</td>
</tr>
<tr class="even">
<td style="text-align: center;">Other Sports Facility</td>
<td style="text-align: center;">15073</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Allotments Or Community Growing Spaces</td>
<td style="text-align: center;">13002</td>
</tr>
<tr class="even">
<td style="text-align: center;">Public Park Or Garden</td>
<td style="text-align: center;">11982</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Cemetery</td>
<td style="text-align: center;">7559</td>
</tr>
<tr class="even">
<td style="text-align: center;">Tennis Court</td>
<td style="text-align: center;">6632</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Bowling Green</td>
<td style="text-align: center;">6589</td>
</tr>
<tr class="even">
<td style="text-align: center;">Golf Course</td>
<td style="text-align: center;">3000</td>
</tr>
</tbody>
</table>
<p>Name: count, dtype: int64</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only 'Play Space', 'Playing Field', and 'Public Park Or Garden'</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>GB_greenspace_site_filtered <span class="op">=</span> GB_greenspace_site_trim.loc[GB_greenspace_site_trim[<span class="st">'Type'</span>].</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                                                          isin([<span class="st">'Play Space'</span>,<span class="st">'Playing Field'</span>,<span class="st">'Public Park Or Garden'</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="greenspace-within-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="greenspace-within-bradford-lad">5.2.2. Greenspace within Bradford LAD</h4>
<p>Aggregating OA polygons to a single polygon and spatially matching to the greenspace dataframe isolates greenspace within Bradford LAD. This will be used to calculate the dependent variable for the regression analysis.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of the Bradford_OA_polygons dataframe which will become the Bradford polygon dataframe</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Bradford <span class="op">=</span> Bradford_OA_polygons</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a 'Bradford' dummy column to aggregate on</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>Bradford[<span class="st">'City'</span>] <span class="op">=</span> <span class="st">'Bradford'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a single polygon aggregated to the city level using 'dissolve'</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Bradford_polygon <span class="op">=</span> Bradford.dissolve(by<span class="op">=</span><span class="st">'City'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop OA21CD column as this is no longer relevant</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Bradford_polygon <span class="op">=</span> Bradford_polygon.drop([<span class="st">'OA21CD'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial join for any greenspace that intersects the Bradford polygon</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Bradford_greenspace_site <span class="op">=</span> gpd.sjoin(GB_greenspace_site_filtered, Bradford_polygon, how<span class="op">=</span><span class="st">'inner'</span>, predicate<span class="op">=</span><span class="st">'intersects'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop index_right column as this is no longer relevant</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>Bradford_greenspace_site <span class="op">=</span> Bradford_greenspace_site.drop([<span class="st">'index_right'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check length of dataframe to determine how many greenspaces are included</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(Bradford_greenspace_site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>436</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that the unique number of Greenspace_IDs is in fact the length of the dataframe</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Bradford_greenspace_site[<span class="st">'Greenspace_ID'</span>].nunique())</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(Bradford_greenspace_site) <span class="op">==</span> Bradford_greenspace_site[<span class="st">'Greenspace_ID'</span>].nunique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>436</p>
<p>True</p>
</section>
</section>
<section id="dependent-variable" class="level3">
<h3 class="anchored" data-anchor-id="dependent-variable">5.3. Dependent variable</h3>
<p>The dependent variable is the distance between the OA PWC and nearest greenspace polygon calculated using the Euclidian distance and given in metres.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the nearest greenspace to each OA population-weighted centroid</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>nearest_greenspace <span class="op">=</span> gpd.sjoin_nearest(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    Bradford_OA_PWC, Bradford_greenspace_site, how<span class="op">=</span><span class="st">'left'</span>, distance_col<span class="op">=</span><span class="st">'Distance'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the unrequired columns</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>nearest_greenspace <span class="op">=</span> nearest_greenspace.drop([<span class="st">'PWC'</span>,<span class="st">'index_right'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check length of dataframe is equal to the length of the OA dataframe - i.e. one greenspace per OA has been identified</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(nearest_greenspace))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(nearest_greenspace) <span class="op">==</span> <span class="bu">len</span>(Bradford_OA_lookup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>1599</p>
<p>False</p>
<p>The information above shows there are some duplicated rows. This is confirmed by checking the number of unique OA21CDs which should be 1,575.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check number of OA21CDs</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nearest_greenspace[<span class="st">'OA21CD'</span>].nunique())</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nearest_greenspace[<span class="st">'OA21CD'</span>].nunique() <span class="op">==</span> <span class="bu">len</span>(Bradford_OA_lookup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>1575</p>
<p>True</p>
<p>Duplicates are caused by the same greenspace being allocated different ‘Types’ with unique IDs. These duplicates are removed, keeping the first record irrespective of ‘Type’ as no analysis is to be conducted on this.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Isolate duplicated rows and check cause</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirmed as duplicated sites with different Greenspace_IDs due to different greenspace Type being recorded</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>duplicated_rows <span class="op">=</span> nearest_greenspace[nearest_greenspace.duplicated(subset<span class="op">=</span><span class="st">'OA21CD'</span>, keep<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>duplicated_rows.head(<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
OA21CD
</th>
<th>
Greenspace_ID
</th>
<th>
Type
</th>
<th>
Distance
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
11
</th>
<td>
E00053364
</td>
<td>
0295ED18-F337-5C37-E063-AAEFA00A445E
</td>
<td>
Play Space
</td>
<td>
514.057891
</td>
</tr>
<tr>
<th>
11
</th>
<td>
E00053364
</td>
<td>
0295ED18-F2F3-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
514.057891
</td>
</tr>
<tr>
<th>
42
</th>
<td>
E00053392
</td>
<td>
0295ED18-F337-5C37-E063-AAEFA00A445E
</td>
<td>
Play Space
</td>
<td>
364.166159
</td>
</tr>
<tr>
<th>
42
</th>
<td>
E00053392
</td>
<td>
0295ED18-F2F3-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
364.166159
</td>
</tr>
<tr>
<th>
43
</th>
<td>
E00053393
</td>
<td>
0295ED18-F337-5C37-E063-AAEFA00A445E
</td>
<td>
Play Space
</td>
<td>
571.723915
</td>
</tr>
<tr>
<th>
43
</th>
<td>
E00053393
</td>
<td>
0295ED18-F2F3-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
571.723915
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop duplicated rows and keep first row for duplicated instances</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>unique_nearest_greenspace <span class="op">=</span> nearest_greenspace.drop_duplicates(subset<span class="op">=</span><span class="st">'OA21CD'</span>, keep<span class="op">=</span><span class="st">'first'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check length of dataframe is now as expected</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(unique_nearest_greenspace))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(unique_nearest_greenspace) <span class="op">==</span> <span class="bu">len</span>(Bradford_OA_lookup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>1575</p>
<p>True</p>
<p>The ‘Bradford_greenspace_site’ dataframe created in 5.2. must also be updated to ensure a consistent view of greenspace.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique list of Greenspace_IDs</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>unique_Greenspace_IDs <span class="op">=</span> unique_nearest_greenspace[[<span class="st">'Greenspace_ID'</span>]].drop_duplicates()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join onto Bradford_greenspace_site to reduce this dataframe to just those kept in the unique_nearest_greenspace dataframe</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Bradford_greenspace_site_unique <span class="op">=</span> Bradford_greenspace_site.merge(unique_Greenspace_IDs, how<span class="op">=</span><span class="st">'right'</span>, on<span class="op">=</span><span class="st">'Greenspace_ID'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="independent-variables-1" class="level3">
<h3 class="anchored" data-anchor-id="independent-variables-1">5.4. Independent variables</h3>
<p>Deprivation data needs to be pivoted to create columns of the datapoints by OA and converting these into percentages. This is achieved using a function to repeat the process for each dimension. Resulting dataframes are merged into a final dataframe containing all four independent variables.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Independent_Variables_Setup(dataframe, dataframe_name):     <span class="co"># dataframe as object, dataframe_name as string</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create all required strings for naming dataframes throughout wrangling process</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    core_name <span class="op">=</span> dataframe_name.rstrip(<span class="st">'_raw'</span>) <span class="co"># Remove "_raw" from end of dataframe to get core name</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    dropped <span class="op">=</span> core_name <span class="op">+</span> <span class="st">'_dropped'</span>          <span class="co"># Add "_dropped" to end of core name</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    pivot <span class="op">=</span> core_name <span class="op">+</span> <span class="st">'_pivot'</span>              <span class="co"># Add "_pivot" to end of core name</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    percentage <span class="op">=</span> core_name <span class="op">+</span> <span class="st">'_PC'</span>            <span class="co"># Add "_PC" to end of core name</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop columns that are not required</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="dv">1</span>,<span class="dv">3</span>]     <span class="co"># List of column indexes of the columns to drop</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    dropped <span class="op">=</span> dataframe.drop(dataframe.columns[cols], axis<span class="op">=</span><span class="dv">1</span>)     <span class="co"># Create new dataframe with columns dropped</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pivot the table on column[0], making the options from column[1] the new column headers and the data that from column[2]</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    pivot <span class="op">=</span> dropped.pivot_table(index<span class="op">=</span>dropped.columns[<span class="dv">0</span>],</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>                                  columns<span class="op">=</span>dropped.columns[<span class="dv">1</span>],</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>                                  values<span class="op">=</span>dropped.columns[<span class="dv">2</span>]).reset_index()</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    pivot.columns.name <span class="op">=</span> <span class="va">None</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a Total column from 3 new data columns[1,2,3]</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    pivot[<span class="st">'Total'</span>] <span class="op">=</span> pivot.iloc[:, <span class="dv">1</span>:<span class="dv">4</span>].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate % HHDs Deprived by dividing column[3] "Deprived" by the Total calculated above</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    pivot[percentage] <span class="op">=</span> (pivot.iloc[:,<span class="dv">3</span>]<span class="op">/</span>pivot[<span class="st">'Total'</span>])</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create final dataframe keeping only the OA21CD and % HHDs deprived in the given dimension</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    final_cols <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">5</span>]</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    core_name <span class="op">=</span> pivot.iloc[:, final_cols]</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> core_name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Household deprivation in the education dimension</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>HHD_dep_education <span class="op">=</span> Independent_Variables_Setup(HHD_dep_education_raw, <span class="st">'HHD_dep_education_raw'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Household deprivation in the employment dimension</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>HHD_dep_employment <span class="op">=</span> Independent_Variables_Setup(HHD_dep_employment_raw, <span class="st">'HHD_dep_employment_raw'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Household deprivation in the health and disability dimension</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>HHD_dep_health <span class="op">=</span> Independent_Variables_Setup(HHD_dep_health_raw, <span class="st">'HHD_dep_health_raw'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Household deprivation in the housing dimension</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>HHD_dep_housing <span class="op">=</span> Independent_Variables_Setup(HHD_dep_housing_raw, <span class="st">'HHD_dep_housing_raw'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check all 4 dataframes are the same length and that length is as expected</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(HHD_dep_education) <span class="op">==</span> <span class="bu">len</span>(HHD_dep_employment) <span class="op">==</span> <span class="bu">len</span>(HHD_dep_health) <span class="op">==</span> <span class="bu">len</span>(HHD_dep_housing) <span class="op">==</span> <span class="bu">len</span>(Bradford_OA_lookup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>True</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge education and employment</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>Ind_vars <span class="op">=</span> HHD_dep_education.merge(HHD_dep_employment, how<span class="op">=</span><span class="st">'inner'</span>, on<span class="op">=</span><span class="st">'Output Areas Code'</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add health</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>Ind_vars <span class="op">=</span> Ind_vars.merge(HHD_dep_health, how<span class="op">=</span><span class="st">'inner'</span>, on<span class="op">=</span><span class="st">'Output Areas Code'</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add housing</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>Ind_vars <span class="op">=</span> Ind_vars.merge(HHD_dep_housing, how<span class="op">=</span><span class="st">'inner'</span>, on<span class="op">=</span><span class="st">'Output Areas Code'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Final length check</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(Ind_vars))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(Ind_vars) <span class="op">==</span> <span class="bu">len</span>(Bradford_OA_lookup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>1575</p>
<p>True</p>
</section>
<section id="final-dataframe-for-regression-analysis" class="level3">
<h3 class="anchored" data-anchor-id="final-dataframe-for-regression-analysis">5.5. Final dataframe for regression analysis</h3>
<p>A dataframe containing the dependent and independent variables, OA code and polygons is required for the regression models and spatial analysis.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the unique_nearest_greenspace and Ind_vars dataframes to get a final dataframe for subsequent analysis</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> unique_nearest_greenspace.merge(Ind_vars, how<span class="op">=</span><span class="st">'inner'</span>, left_on<span class="op">=</span><span class="st">'OA21CD'</span>, right_on<span class="op">=</span><span class="st">'Output Areas Code'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> final_df.merge(Bradford_OA_polygons, how<span class="op">=</span><span class="st">'inner'</span>, on<span class="op">=</span><span class="st">'OA21CD'</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop unrequired columns</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> final_df.drop([<span class="st">'Output Areas Code'</span>, <span class="st">'Greenspace_ID'</span>, <span class="st">'Type'</span>, <span class="st">'City'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set geometry</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> final_df.set_geometry(<span class="st">'Polygon'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Visual checks of each dataframe can be found in Appendix 1.</p>
</section>
</section>
<section id="visualisation-and-statistics" class="level2">
<h2 class="anchored" data-anchor-id="visualisation-and-statistics">6. Visualisation and Statistics</h2>
<section id="oas-1" class="level3">
<h3 class="anchored" data-anchor-id="oas-1">6.1. OAs</h3>
<p>Figure 6.1.1. shows OA boundaries and PWCs within Bradford LAD. PWCs locations can vary from near the edge to the centre of OAs.</p>
<section id="figure-6.1.1.-map-of-oa-polygons-and-population-weighted-centroids-within-the-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.1.1.-map-of-oa-polygons-and-population-weighted-centroids-within-the-bradford-lad">Figure 6.1.1. Map of OA polygons and population-weighted centroids within the Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023a; ONS, 2023b</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot polygons</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>Bradford_OA_polygons.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'Grey'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.25</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot points</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>Bradford_OA_PWC.plot(ax<span class="op">=</span>ax, markersize<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'#134f5c'</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize plot</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add basemap</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span>Bradford_OA_polygons.crs.to_string(), source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_81_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
</section>
<section id="greenspace-2" class="level3">
<h3 class="anchored" data-anchor-id="greenspace-2">6.2. Greenspace</h3>
<p>Figure 6.2.1. shows greenspace by type. However, as detailed in Section 5.3., duplicates were removed by keeping first instances of duplicated cases hence counts in figure 6.2.2. are skewed. In most instances, ‘playing field’ was retained, and so counts are higher for this type. This does not impact subsequent analysis as type does not feature in the regression modelling.</p>
<section id="figure-6.2.1.-map-of-greenspace-within-the-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.2.1.-map-of-greenspace-within-the-bradford-lad">Figure 6.2.1. Map of greenspace within the Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: OS, 2023</code></pre>
</div>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot polygons</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Bradford_polygon</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>Bradford_polygon.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'Grey'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.25</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Bradford_greenspace_site_unique</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>Bradford_greenspace_site_unique.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'Type'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                                     legend<span class="op">=</span><span class="va">True</span>, markersize<span class="op">=</span><span class="dv">50</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add basemap</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span>Bradford_polygon.crs.to_string(), source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize plot</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_85_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="figure-6.2.2.-count-of-greenspace-by-type-within-the-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.2.2.-count-of-greenspace-by-type-within-the-bradford-lad">Figure 6.2.2. Count of greenspace by type within the Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: OS, 2023; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>greenspace_types <span class="op">=</span> Bradford_greenspace_site_unique[<span class="st">'Type'</span>].unique().tolist()     <span class="co"># Get list of greenspace types</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>greenspace_counts <span class="op">=</span> <span class="bu">list</span>(Bradford_greenspace_site_unique[<span class="st">'Type'</span>].value_counts()) <span class="co"># Get list of greenspace type counts</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>colours <span class="op">=</span> [<span class="st">'#21918c'</span>, <span class="st">'#440154'</span>, <span class="st">'#fde725'</span>]     <span class="co"># Set colours from the map for visual consistency</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a pie chart</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>wedges, labels <span class="op">=</span> ax.pie(greenspace_counts, labels<span class="op">=</span>greenspace_types,     <span class="co"># counts as data, types as labels</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                        autopct<span class="op">=</span><span class="va">None</span>, startangle<span class="op">=</span><span class="dv">90</span>,                    <span class="co"># turn off data labels, set start angle to 90degrees</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>                        wedgeprops<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="fl">0.5</span>), colors<span class="op">=</span>colours)     <span class="co"># set size of donut hole, set colour scheme</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels within each pie piece</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label, value <span class="kw">in</span> <span class="bu">zip</span>(labels, greenspace_counts):</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    label.<span class="bu">set</span>(size<span class="op">=</span><span class="dv">10</span>, text<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>label<span class="sc">.</span>get_text()<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">'</span>)     <span class="co"># Set the labels to be "Type: Count"</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Equal aspect ratio to make sure the chart is drawn as a circle</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'equal'</span>)  </span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Count of greenspace by type within the Bradford LAD'</span>,</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>          fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontfamily<span class="op">=</span><span class="st">'sans-serif'</span>) <span class="co"># Change title to specified font settings</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a footnote with the data source and specify location on visual</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.15</span>, <span class="st">"Data Source: OS, 2023; Author's calculations"</span>,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"center"</span>, transform<span class="op">=</span>plt.gca().transAxes,</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>         fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the pie chart</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_87_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
</section>
<section id="deprivation" class="level3">
<h3 class="anchored" data-anchor-id="deprivation">6.3. Deprivation</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_deprivation_choropleth(variable, final_df):</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a copy of final_df so data and column names can be made visual-appropriate</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    OA_choropleth <span class="op">=</span> final_df.copy()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Multiply data by 100 to create percentage in readable format for the choropleth</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    OA_choropleth[[<span class="st">'HHD_dep_education_PC'</span>, <span class="st">'HHD_dep_employment_PC'</span>, </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'HHD_dep_health_PC'</span>, <span class="st">'HHD_dep_housing_PC'</span>]] <span class="op">=</span> (</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        OA_choropleth[[<span class="st">'HHD_dep_education_PC'</span>, <span class="st">'HHD_dep_employment_PC'</span>, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'HHD_dep_health_PC'</span>, <span class="st">'HHD_dep_housing_PC'</span>]] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dictionary of current independent variable column names with long-form for use on map</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    columns_dict <span class="op">=</span> {<span class="st">"HHD_dep_education_PC"</span>: <span class="st">"Households deprived in the education dimension (%)"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"HHD_dep_employment_PC"</span>: <span class="st">"Households deprived in the employment dimension (%)"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"HHD_dep_health_PC"</span>: <span class="st">"Households deprived in the health dimension (%)"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"HHD_dep_housing_PC"</span>: <span class="st">"Households deprived in the housing dimension (%)"</span>}</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename the columns to the long-form version</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    OA_choropleth.rename(columns<span class="op">=</span>columns_dict, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Write long-form column name to a new variable to use in the choropleth code</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    variable_longform <span class="op">=</span> columns_dict[variable]</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot choropleth</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    OA_choropleth.plot(column<span class="op">=</span>variable_longform, </span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>                       ax<span class="op">=</span>ax, </span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>                       scheme<span class="op">=</span><span class="st">'EqualInterval'</span>, </span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>                       k<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>                       cmap<span class="op">=</span><span class="st">'YlGnBu'</span>, </span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>                       legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add basemap</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>    ctx.add_basemap(ax, crs<span class="op">=</span>OA_choropleth.crs.to_string(), source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize plot</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add title to legend</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>    legend_title <span class="op">=</span> variable_longform</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>    ax.get_legend().set_title(legend_title)</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show plot</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Figure 6.3.1. shows areas of high education deprivation in the southeast and west. Lowest levels are in rural, affluent areas in the southwest and north.</p>
<section id="figure-6.3.1.-percentage-of-households-deprived-in-the-education-dimension-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.3.1.-percentage-of-households-deprived-in-the-education-dimension-by-oa-in-bradford-lad">Figure 6.3.1. Percentage of households deprived in the education dimension by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023d; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with the desired variable and the dataframe</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>create_deprivation_choropleth(<span class="st">'HHD_dep_education_PC'</span>, final_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_92_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Figure 6.3.2. shows similar spatial employment deprivation patterns to education. The range of employment deprivation is smaller though, from 0% to 54.7%.</p>
</section>
<section id="figure-6.3.2.-percentage-of-households-deprived-in-the-employment-dimension-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.3.2.-percentage-of-households-deprived-in-the-employment-dimension-by-oa-in-bradford-lad">Figure 6.3.2. Percentage of households deprived in the employment dimension by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023e; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with the desired variable and the dataframe</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>create_deprivation_choropleth(<span class="st">'HHD_dep_employment_PC'</span>, final_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_95_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Figure 6.3.3. shows health deprivation levels are higher and widely spread. As health deprivation includes poor health and disability, levels may be higher due to factors including elderly populations, as well as affluence-associated poor health.</p>
</section>
<section id="figure-6.3.3.-percentage-of-households-deprived-in-the-health-dimension-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.3.3.-percentage-of-households-deprived-in-the-health-dimension-by-oa-in-bradford-lad">Figure 6.3.3. Percentage of households deprived in the health dimension by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023f; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with the desired variable and the dataframe</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>create_deprivation_choropleth(<span class="st">'HHD_dep_health_PC'</span>, final_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_98_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Contrastingly, figure 6.3.4. shows housing deprivation is largely isolated to Bradford city and around Keighley. Most OAs have less than 10% housing deprivation.</p>
</section>
<section id="figure-6.3.4.-percentage-of-households-deprived-in-the-housing-dimension-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.3.4.-percentage-of-households-deprived-in-the-housing-dimension-by-oa-in-bradford-lad">Figure 6.3.4. Percentage of households deprived in the housing dimension by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023g; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with the desired variable and the dataframe</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>create_deprivation_choropleth(<span class="st">'HHD_dep_housing_PC'</span>, final_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_101_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Figure 6.3.5. and 6.3.6. provide key summary statistics. Education deprivation has the largest range, from 2.2% in the least deprived OA to 67.8% in the most deprived. Only education and health dimensions exceed 0% in all OAs. For health, the lowest level of deprivation is 8.8% highlighting how even the most affluent areas are impacted by this.</p>
<p>Education, health, and housing have outliers at the higher end, recording maximum values around 65-68%. However, average deprivation levels vary across each dimension, with housing having the lowest average (11.0%) and health the highest (35.4%). There is no consistent distribution or spatial pattern to deprivation across all four dimensions.</p>
</section>
<section id="figure-6.3.5.-boxplots-of-the-percentage-of-households-deprived-in-the-given-dimension-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.3.5.-boxplots-of-the-percentage-of-households-deprived-in-the-given-dimension-by-oa-in-bradford-lad">Figure 6.3.5. Boxplots of the percentage of households deprived in the given dimension by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023d; ONS, 2023e; ONS, 2023f; ONS, 2023g; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of the Ind_vars dataframe for the purposes of this boxplot</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>Ind_vars_boxplot <span class="op">=</span> Ind_vars</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiply data by 100 to create percentage in readable format</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>Ind_vars_boxplot[[<span class="st">'HHD_dep_education_PC'</span>, <span class="st">'HHD_dep_employment_PC'</span>, </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'HHD_dep_health_PC'</span>, <span class="st">'HHD_dep_housing_PC'</span>]] <span class="op">=</span> (</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    Ind_vars_boxplot[[<span class="st">'HHD_dep_education_PC'</span>, <span class="st">'HHD_dep_employment_PC'</span>, </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'HHD_dep_health_PC'</span>, <span class="st">'HHD_dep_housing_PC'</span>]] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns for the chart to be clearer</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>Ind_vars_boxplot <span class="op">=</span> Ind_vars_boxplot.rename(columns<span class="op">=</span>{</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HHD_dep_education_PC"</span>: <span class="st">"Education"</span>,</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HHD_dep_employment_PC"</span>: <span class="st">"Employment"</span>,</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HHD_dep_health_PC"</span>: <span class="st">"Health"</span>,</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HHD_dep_housing_PC"</span>: <span class="st">"Housing"</span>})</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup figure and boxplot</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>wandering_forest_palette <span class="op">=</span> [<span class="st">'#09435a'</span>, <span class="st">'#4e7d8e'</span>, <span class="st">'#9cc2b8'</span>, <span class="st">'#90958f'</span>]   <span class="co"># Create colour palette</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>sns.set_palette(wandering_forest_palette)     <span class="co"># Set colour palette</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>Ind_vars_boxplot)     <span class="co"># Add data</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and amend axes</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Percentage of households deprived in the given dimension'</span>,</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>          fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># Change title to specified font settings</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Household deprivation dimension"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>) <span class="co"># set x-axis label and font</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Percentage of households deprived (%)"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>) <span class="co"># set y-axis label and font</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a footnote with the data source and specify location on visual</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.15</span>, <span class="st">"Data Source: ONS, 2023d; ONS, 2023e; ONS, 2023f; ONS, 2023g"</span>,</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"center"</span>, transform<span class="op">=</span>plt.gca().transAxes,</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>         fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_104_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="figure-6.3.6.-deprivation-statistics-in-the-given-dimension-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.3.6.-deprivation-statistics-in-the-given-dimension-by-oa-in-bradford-lad">Figure 6.3.6. Deprivation statistics in the given dimension by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023d; ONS, 2023e; ONS, 2023f; ONS, 2023g; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get precise figures as shown in the boxplot</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>Ind_vars_boxplot.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Education
</th>
<th>
Employment
</th>
<th>
Health
</th>
<th>
Housing
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
1575.000000
</td>
<td>
1575.000000
</td>
<td>
1575.000000
</td>
<td>
1575.000000
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
24.954095
</td>
<td>
15.573143
</td>
<td>
35.444508
</td>
<td>
10.959619
</td>
</tr>
<tr>
<th>
std
</th>
<td>
10.980256
</td>
<td>
9.313979
</td>
<td>
8.980795
</td>
<td>
9.729166
</td>
</tr>
<tr>
<th>
min
</th>
<td>
2.200000
</td>
<td>
0.000000
</td>
<td>
8.800000
</td>
<td>
0.000000
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
16.900000
</td>
<td>
8.000000
</td>
<td>
29.100000
</td>
<td>
3.900000
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
23.900000
</td>
<td>
13.800000
</td>
<td>
34.800000
</td>
<td>
7.600000
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
31.600000
</td>
<td>
22.000000
</td>
<td>
41.000000
</td>
<td>
15.150000
</td>
</tr>
<tr>
<th>
max
</th>
<td>
67.800000
</td>
<td>
54.700000
</td>
<td>
66.100000
</td>
<td>
64.800000
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="distance-to-nearest-greenspace" class="level3">
<h3 class="anchored" data-anchor-id="distance-to-nearest-greenspace">6.4. Distance to nearest greenspace</h3>
<p>Figure 6.4.1. shows distances to greenspace are greater in rural areas to the north and west. These areas are more affluent, with lower levels of deprivation (figures 6.3.1.-6.3.4). More deprived OAs have lower distances.</p>
<section id="figure-6.4.1.-distance-to-nearest-greenspace-metres-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.4.1.-distance-to-nearest-greenspace-metres-by-oa-in-bradford-lad">Figure 6.4.1. Distance to nearest greenspace (metres) by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023b; OS, 2023; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_distance_choropleth(final_df):</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a copy of final_df so data and column names can be made visual-appropriate</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    OA_dist_choropleth <span class="op">=</span> final_df.copy()</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Round distance to the nearest metre</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    OA_dist_choropleth[<span class="st">'Distance'</span>] <span class="op">=</span> OA_dist_choropleth[<span class="st">'Distance'</span>].<span class="bu">round</span>().astype(<span class="bu">int</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dictionary of current distance column name with long-form for use on map</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    distance_dict <span class="op">=</span> {<span class="st">"Distance"</span>: <span class="st">"Distance to nearest greenspace (metres)"</span>}</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename the column to the long-form version</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    rename_column <span class="op">=</span> OA_dist_choropleth.rename(columns<span class="op">=</span>distance_dict, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Write long-form column name to a new variable to use in the choropleth code</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>    distance_longform <span class="op">=</span> <span class="st">'Distance to nearest greenspace (metres)'</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot choropleth</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    OA_dist_choropleth.plot(column<span class="op">=</span>distance_longform, </span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>                            ax<span class="op">=</span>ax, </span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>                            scheme<span class="op">=</span><span class="st">'NaturalBreaks'</span>, </span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>                            cmap<span class="op">=</span><span class="st">'YlGnBu'</span>, </span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>                            legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add basemap</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>    ctx.add_basemap(ax, crs<span class="op">=</span>OA_dist_choropleth.crs.to_string(), source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize plot</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add title to legend</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>    ax.get_legend().set_title(distance_longform)</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show plot</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with the DataFrame final_df</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>create_distance_choropleth(final_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_111_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Figure 6.4.2. shows outliers at larger distances, confirming the distance variable is right skewed. Meanwhile, figure 6.4.3. shows the range, from 0m to over 2,000m. OAs with 0m distance are a result of PWCs falling within greenspace boundaries. On average, greenspace is around 275m from PWCs, which is below the previous UK government target of 300m (Houlden et al, 2019).</p>
</section>
<section id="figure-6.4.2.-boxplot-of-distance-to-nearest-greenspace-metres-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.4.2.-boxplot-of-distance-to-nearest-greenspace-metres-by-oa-in-bradford-lad">Figure 6.4.2. Boxplot of distance to nearest greenspace (metres) by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023b; OS, 2023; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup figure and boxplot</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(unique_nearest_greenspace, x<span class="op">=</span><span class="st">'Distance'</span>, color<span class="op">=</span><span class="st">'#e1fdd5'</span>)     <span class="co"># Add data and change colour</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and amend axes</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distance to nearest greenspace by OA in Bradford'</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>          fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># Change title to specified font settings</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">""</span>) <span class="co"># Set ax xlabel to nothing so the variable name does not appear</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Distance to nearest greenspace (metres)"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>) <span class="co"># set x-axis label and font</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"OAs"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>) <span class="co"># set y-axis label and font</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the x-axis ticks at 250 increments</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>tick_locations <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">2251</span>, <span class="dv">250</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(tick_locations)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a footnote with the data source and specify location on visual</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.15</span>, <span class="st">"Data Source: ONS, 2023b; OS, 2023; Author's calculations"</span>,</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"center"</span>, transform<span class="op">=</span>plt.gca().transAxes,</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>         fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_114_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="figure-6.4.3.-distance-to-nearest-greenspace-metres-statistics-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.4.3.-distance-to-nearest-greenspace-metres-statistics-by-oa-in-bradford-lad">Figure 6.4.3. Distance to nearest greenspace (metres) statistics by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023b; OS, 2023; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get precise figures as shown in the boxplot</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>unique_nearest_greenspace.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Distance
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
1575.000000
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
247.661399
</td>
</tr>
<tr>
<th>
std
</th>
<td>
183.485184
</td>
</tr>
<tr>
<th>
min
</th>
<td>
0.000000
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
119.213902
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
201.468622
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
332.656088
</td>
</tr>
<tr>
<th>
max
</th>
<td>
2090.986345
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="dependent-and-independent-variables" class="level3">
<h3 class="anchored" data-anchor-id="dependent-and-independent-variables">6.5. Dependent and independent variables</h3>
<p>Figure 6.5.1. shows scatter plots and regression lines between the dependent and independent variables. There is one high distance outlier visible across all four dimensions, and all present a negative correlation with distance to nearest greenspace.</p>
<section id="figure-6.5.1.-scatterplots-of-distance-to-nearest-greenspace-metres-and-household-deprivation-dimensions-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-6.5.1.-scatterplots-of-distance-to-nearest-greenspace-metres-and-household-deprivation-dimensions-by-oa-in-bradford-lad">Figure 6.5.1. Scatterplots of distance to nearest greenspace (metres) and household deprivation dimensions, by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023b; ONS, 2023d; ONS, 2023e; ONS, 2023f; ONS, 2023g; OS, 2023; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a figure with 2 rows and 2 columns for subplots</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>), sharey<span class="op">=</span><span class="va">True</span>, sharex<span class="op">=</span><span class="va">True</span>) <span class="co"># Share axes across 4 plots for visual consistency</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title, x-axis subtitle, and y-axis labels</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distance to nearest greenspace compared to Household Deprivation Dimensions'</span>, </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>          x<span class="op">=-</span><span class="fl">0.15</span>, y<span class="op">=</span><span class="fl">2.25</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Household Deprivation Dimension'</span>, y<span class="op">=</span><span class="fl">0.05</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'Distance to nearest greenspace (metres)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'Distance to nearest greenspace (metres)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="co">### Education scatter</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].scatter(x<span class="op">=</span>final_df[<span class="st">'HHD_dep_education_PC'</span>], y<span class="op">=</span>final_df[<span class="st">'Distance'</span>], s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#09435a'</span>) <span class="co"># add data and set colour</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'Education (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># add axis label and set font</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the regression line</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>slope0, intercept0 <span class="op">=</span> np.polyfit(final_df[<span class="st">'HHD_dep_education_PC'</span>], final_df[<span class="st">'Distance'</span>], <span class="dv">1</span>)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>regression_line0 <span class="op">=</span> np.polyval([slope0, intercept0], final_df[<span class="st">'HHD_dep_education_PC'</span>])</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to the chart</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].plot(final_df[<span class="st">'HHD_dep_education_PC'</span>], regression_line0, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="co">### Employment scatter</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].scatter(x<span class="op">=</span>final_df[<span class="st">'HHD_dep_employment_PC'</span>], y<span class="op">=</span>final_df[<span class="st">'Distance'</span>], s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#4e7d8e'</span>) <span class="co"># add data and set colour</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'Employment (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># add axis label and set font</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the regression line</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>slope1, intercept1 <span class="op">=</span> np.polyfit(final_df[<span class="st">'HHD_dep_employment_PC'</span>], final_df[<span class="st">'Distance'</span>], <span class="dv">1</span>)</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>regression_line1 <span class="op">=</span> np.polyval([slope1, intercept1], final_df[<span class="st">'HHD_dep_employment_PC'</span>])</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to the chart</span></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].plot(final_df[<span class="st">'HHD_dep_employment_PC'</span>], regression_line1, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a><span class="co">### Health scatter</span></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].scatter(x<span class="op">=</span>final_df[<span class="st">'HHD_dep_health_PC'</span>], y<span class="op">=</span>final_df[<span class="st">'Distance'</span>], s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#9cc2b8'</span>) <span class="co"># add data and set colour</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'Health (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># add axis label and set font</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the regression line</span></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>slope2, intercept2 <span class="op">=</span> np.polyfit(final_df[<span class="st">'HHD_dep_health_PC'</span>], final_df[<span class="st">'Distance'</span>], <span class="dv">1</span>)</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>regression_line2 <span class="op">=</span> np.polyval([slope2, intercept2], final_df[<span class="st">'HHD_dep_health_PC'</span>])</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to the chart</span></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].plot(final_df[<span class="st">'HHD_dep_health_PC'</span>], regression_line2, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a><span class="co">### Housing scatter</span></span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].scatter(x<span class="op">=</span>final_df[<span class="st">'HHD_dep_housing_PC'</span>], y<span class="op">=</span>final_df[<span class="st">'Distance'</span>], s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#90958f'</span>) <span class="co"># add data and set colour</span></span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'Housing (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>) <span class="co"># add axis label and set font</span></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the regression line</span></span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>slope3, intercept3 <span class="op">=</span> np.polyfit(final_df[<span class="st">'HHD_dep_housing_PC'</span>], final_df[<span class="st">'Distance'</span>], <span class="dv">1</span>)</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>regression_line3 <span class="op">=</span> np.polyval([slope3, intercept3], final_df[<span class="st">'HHD_dep_housing_PC'</span>])</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to the chart</span></span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].plot(final_df[<span class="st">'HHD_dep_housing_PC'</span>], regression_line3, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a footnote with the data source and specify location on visual</span></span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="op">-</span><span class="fl">0.15</span>, <span class="op">-</span><span class="fl">0.3</span>,</span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Data Source: ONS, 2023b; ONS, 2023d; ONS, 2023e; ONS, 2023f; ONS, 2023g; OS, 2023; Author's calculations"</span>,</span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>         ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"center"</span>, transform<span class="op">=</span>plt.gca().transAxes,</span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>         fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_120_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="analysis-and-results" class="level2">
<h2 class="anchored" data-anchor-id="analysis-and-results">7. Analysis and results</h2>
<section id="ols-regression" class="level3">
<h3 class="anchored" data-anchor-id="ols-regression">7.1. OLS Regression</h3>
<p>Checks for collinearity are conducted using a correlation matrix (figure 7.1.1.). Deprivation variables have a positive correlation with one another, particularly employment and health. Figure 7.1.2. is a coefficient matrix which confirms that the employment and health dimensions have a coefficient of 0.68 which is high and could indicate collinearity. People with poorer health or disabilities are more likely to be out of work (ONS, 2023i) and so, coupled with the high coefficient, it has been determined that collinearity is present between these variables.</p>
<section id="figure-7.1.1.-correlation-matrix-of-independent-and-dependent-variables-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.1.1.-correlation-matrix-of-independent-and-dependent-variables-by-oa-in-bradford-lad">Figure 7.1.1. Correlation matrix of independent and dependent variables by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023b; ONS, 2023d; ONS, 2023e; ONS, 2023f; ONS, 2023g; OS, 2023; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial correlations to check for collinearity</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pd.plotting.scatter_matrix(final_df, alpha<span class="op">=</span><span class="fl">0.2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>), diagonal<span class="op">=</span><span class="st">'kde'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_125_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="figure-7.1.2.-coefficient-matrix-of-independent-and-dependent-variables-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.1.2.-coefficient-matrix-of-independent-and-dependent-variables-by-oa-in-bradford-lad">Figure 7.1.2. Coefficient matrix of independent and dependent variables by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023b; ONS, 2023d; ONS, 2023e; ONS, 2023f; ONS, 2023g; OS, 2023; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation coefficient matrix</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>final_df.corr(numeric_only<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Distance
</th>
<th>
HHD_dep_education_PC
</th>
<th>
HHD_dep_employment_PC
</th>
<th>
HHD_dep_health_PC
</th>
<th>
HHD_dep_housing_PC
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
Distance
</th>
<td>
1.000000
</td>
<td>
-0.182102
</td>
<td>
-0.181204
</td>
<td>
-0.160042
</td>
<td>
-0.148355
</td>
</tr>
<tr>
<th>
HHD_dep_education_PC
</th>
<td>
-0.182102
</td>
<td>
1.000000
</td>
<td>
0.620664
</td>
<td>
0.643816
</td>
<td>
0.358545
</td>
</tr>
<tr>
<th>
HHD_dep_employment_PC
</th>
<td>
-0.181204
</td>
<td>
0.620664
</td>
<td>
1.000000
</td>
<td>
0.680197
</td>
<td>
0.624160
</td>
</tr>
<tr>
<th>
HHD_dep_health_PC
</th>
<td>
-0.160042
</td>
<td>
0.643816
</td>
<td>
0.680197
</td>
<td>
1.000000
</td>
<td>
0.272581
</td>
</tr>
<tr>
<th>
HHD_dep_housing_PC
</th>
<td>
-0.148355
</td>
<td>
0.358545
</td>
<td>
0.624160
</td>
<td>
0.272581
</td>
<td>
1.000000
</td>
</tr>
</tbody>
</table>
</section>
<section id="addressing-collinearity" class="level4">
<h4 class="anchored" data-anchor-id="addressing-collinearity">Addressing collinearity</h4>
<p>Figure 7.1.3. shows the p-value for employment is highest, meaning it is the least statistically significant variable, so employment is removed to eliminate the identified collinearity.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the independent Y variable</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> final_df[<span class="st">'Distance'</span>]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dependent X variables</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> final_df[[<span class="st">'HHD_dep_education_PC'</span>,<span class="st">'HHD_dep_employment_PC'</span>,<span class="st">'HHD_dep_health_PC'</span>,<span class="st">'HHD_dep_housing_PC'</span>]]</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the constant</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> sm.add_constant(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create OLS regression model</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> sm.OLS(y, x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and save results</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> mod.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="figure-7.1.3.-results-of-ols-model-including-all-four-deprivation-dimensions" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.1.3.-results-of-ols-model-including-all-four-deprivation-dimensions">Figure 7.1.3. Results of OLS model including all four deprivation dimensions</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023b; ONS, 2023d; ONS, 2023e; ONS, 2023f; ONS, 2023g; OS, 2023; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results summary</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:               Distance   R-squared:                       0.044
Model:                            OLS   Adj. R-squared:                  0.042
Method:                 Least Squares   F-statistic:                     18.13
Date:                Mon, 13 May 2024   Prob (F-statistic):           1.43e-14
Time:                        19:16:44   Log-Likelihood:                -10408.
No. Observations:                1575   AIC:                         2.083e+04
Df Residuals:                    1570   BIC:                         2.085e+04
Df Model:                           4                                         
Covariance Type:            nonrobust                                         
=========================================================================================
                            coef    std err          t      P&gt;|t|      [0.025      0.975]
-----------------------------------------------------------------------------------------
const                   351.9268     20.166     17.452      0.000     312.373     391.481
HHD_dep_education_PC   -165.8278     57.102     -2.904      0.004    -277.831     -53.824
HHD_dep_employment_PC   -78.8281     86.937     -0.907      0.365    -249.352      91.696
HHD_dep_health_PC       -99.3122     77.368     -1.284      0.199    -251.068      52.443
HHD_dep_housing_PC     -140.5889     61.893     -2.271      0.023    -261.991     -19.187
==============================================================================
Omnibus:                      685.269   Durbin-Watson:                   1.660
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             5645.947
Skew:                           1.830   Prob(JB):                         0.00
Kurtosis:                      11.523   Cond. No.                         26.7
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</section>
<section id="ols-regression-model" class="level4">
<h4 class="anchored" data-anchor-id="ols-regression-model">OLS regression model</h4>
<p>The model includes education, health, and housing deprivation dimensions. Figure 7.1.4. shows that all three are statistically significant at the 95% confidence level. The model has an R-squared value of 0.044, meaning only 4.4% of variance is accounted for. Further analysis of the residuals is warranted.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the independent Y variable</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> final_df[<span class="st">'Distance'</span>]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dependent X variables</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> final_df[[<span class="st">'HHD_dep_education_PC'</span>,<span class="st">'HHD_dep_health_PC'</span>,<span class="st">'HHD_dep_housing_PC'</span>]]</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the constant</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> sm.add_constant(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create OLS regression model</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> sm.OLS(y, x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and save results</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> mod.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="color: #2F5496; font-size: 14px; font-weight: bold;">
<pre><code>Figure 7.1.4. Results of OLS model including education, health, and housing deprivation dimensions</code></pre>
</div>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: ONS, 2023b; ONS, 2023d; ONS, 2023f; ONS, 2023g; OS, 2023; Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results summary</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:               Distance   R-squared:                       0.044
Model:                            OLS   Adj. R-squared:                  0.042
Method:                 Least Squares   F-statistic:                     23.91
Date:                Mon, 13 May 2024   Prob (F-statistic):           3.95e-15
Time:                        19:16:44   Log-Likelihood:                -10408.
No. Observations:                1575   AIC:                         2.082e+04
Df Residuals:                    1571   BIC:                         2.085e+04
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
========================================================================================
                           coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------------
const                  359.1799     18.510     19.405      0.000     322.873     395.487
HHD_dep_education_PC  -177.5110     55.626     -3.191      0.001    -286.620     -68.402
HHD_dep_health_PC     -135.9300     65.988     -2.060      0.040    -265.364      -6.496
HHD_dep_housing_PC    -173.7491     49.930     -3.480      0.001    -271.686     -75.812
==============================================================================
Omnibus:                      689.258   Durbin-Watson:                   1.658
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             5763.638
Skew:                           1.837   Prob(JB):                         0.00
Kurtosis:                      11.621   Cond. No.                         19.1
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
<div style="color: #2F5496; font-size: 14px; font-weight: bold;">
<pre><code>Analysis of observed versus fitted values and residuals</code></pre>
</div>
<div class="sourceCode" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain residuals from results</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> results.resid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a DataFrame with 'OA21CD' and residuals</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>residuals_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'OA21CD'</span>: final_df[<span class="st">'OA21CD'</span>],</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Residuals'</span>: residuals</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Residuals to final_df</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> pd.merge(final_df, residuals_data, on<span class="op">=</span><span class="st">'OA21CD'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Figure 7.1.5. illustrates the relationship between the observed distances and fitted values from the model. There is an outlier – the largest distance in the observed values is no longer the largest in the fitted values – and fitted values have a much smaller range with the largest distance being closer to 325m.</p>
</section>
<section id="figure-7.1.5.-observed-vs-fitted-values-for-the-ols-regression-model" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.1.5.-observed-vs-fitted-values-for-the-ols-regression-model">Figure 7.1.5. Observed vs Fitted Values for the OLS regression model</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a figure</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set axis labels and title</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fitted values - Distance (metres)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Observed values - Distance (metres)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Observed vs Fitted Values for the OLS regression model'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot showing Fitted against Observed values</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>plt.scatter(x<span class="op">=</span>results.fittedvalues, y<span class="op">=</span>y, label<span class="op">=</span><span class="st">'Data'</span>, s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#09435a'</span>) <span class="co"># add data and set colour and size of circles</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the line y=x</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="bu">min</span>(results.fittedvalues), <span class="bu">max</span>(results.fittedvalues)],</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>         [<span class="bu">min</span>(results.fittedvalues), <span class="bu">max</span>(results.fittedvalues)], linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'y=x'</span>)</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the y-axis ticks at 250 increments</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>tick_locations <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">2251</span>, <span class="dv">250</span>)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(tick_locations)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_145_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Figure 7.1.6. shows the variance in the residuals. No distinct relationship is visible with positive and negative residuals ranging from around -250 to +250, across all fitted distance values. This suggests the assumption that the relationship is linear is reasonable, and the variance of the error terms are equal. However, only larger positive residuals exist, meaning the model is not working as well for largest distances in the observed values.</p>
</section>
<section id="figure-7.1.6.-residuals-vs-fitted-values-for-the-ols-regression-model" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.1.6.-residuals-vs-fitted-values-for-the-ols-regression-model">Figure 7.1.6. Residuals vs Fitted Values for the OLS regression model</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a figure</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set axis labels and title</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fitted values - Distance (metres)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Residuals'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Residuals vs Fitted Values for the OLS regression model'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot showing Fitted values against Residuals</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>plt.scatter(x<span class="op">=</span>results.fittedvalues, y<span class="op">=</span>final_df[<span class="st">'Residuals'</span>], label<span class="op">=</span><span class="st">'Data'</span>, s<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'#09435a'</span>) <span class="co"># add data and set colour/size</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add dashed horizontal line at y=0</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the x-axis ticks at 250 increments</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>tick_locations <span class="op">=</span> np.arange(<span class="op">-</span><span class="dv">250</span>, <span class="dv">2001</span>, <span class="dv">250</span>)</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(tick_locations)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_148_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>To confirm this, figure 7.1.6. shows a histogram of the residuals, highlighting a normal distribution centred around 0, with a slight right skew.</p>
</section>
<section id="figure-7.1.7.-histogram-of-residuals-for-the-ols-regression-model" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.1.7.-histogram-of-residuals-for-the-ols-regression-model">Figure 7.1.7. Histogram of residuals for the OLS regression model</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a figure</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram of residuals</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>sns.histplot(x<span class="op">=</span>residuals, bins<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>ax)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the x-axis ticks at 250 increments</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>tick_locations <span class="op">=</span> np.arange(<span class="op">-</span><span class="dv">250</span>, <span class="dv">2001</span>, <span class="dv">250</span>)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(tick_locations)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Label axes</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Residuals'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Count'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Title and show the plot</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Histogram of Residuals from OLS model'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_151_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Lastly, a Q-Q plot is used to confirm the presence of outliers. One extreme outlier was visible in the previous charts, but a Q-Q plot allows for confirmation of other outliers closer to the rest of the data points. Figure 7.1.8. confirms that there are outliers in the residuals at both the top and bottom end.</p>
</section>
<section id="figure-7.1.8.-q-q-plot" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.1.8.-q-q-plot">Figure 7.1.8. Q-Q Plot</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and axis</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Q-Q plot</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>probplot(residuals, dist<span class="op">=</span><span class="st">"norm"</span>, plot<span class="op">=</span>plt)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and label axes</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Q-Q Plot"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Theoretical Quantiles"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Ordered Values"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Change colour of circles</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>ax.lines[<span class="dv">0</span>].set_markerfacecolor(<span class="st">'#4e7d8e'</span>)</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>ax.lines[<span class="dv">0</span>].set_markeredgecolor(<span class="st">'#4e7d8e'</span>)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_154_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
</section>
<section id="morans-i" class="level3">
<h3 class="anchored" data-anchor-id="morans-i">7.2. Moran’s I</h3>
<p>Moran’s I is used to detect high and low values concentrated spatially, and the spatial relationship between neighbours is random if zero association is found (Paez and Scott, 2004). Queens weights are used, meaning any OA bordering the given OA is included.</p>
<p>The I value is 0.46 and the p-value is 0.001. These are positive and significant respectively, implying distance to nearest greenspace is spatially correlated - higher values and lower values cluster spatially. Figure 7.2.1. shows this on a scatterplot.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the queen weights based on the OA</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>w_queen <span class="op">=</span> weights.Queen.from_dataframe(final_df, ids <span class="op">=</span> <span class="st">'OA21CD'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Moran's I using queen weights</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>mi <span class="op">=</span> esda.Moran(final_df[<span class="st">'Distance'</span>], w_queen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I value</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'I value: </span><span class="sc">{</span>mi<span class="sc">.</span>I<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Significance (p value)</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'P value: </span><span class="sc">{</span>mi<span class="sc">.</span>p_sim<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">I value</th>
<th style="text-align: center;">0.45882055605281585</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">P value</td>
<td style="text-align: center;">0.001</td>
</tr>
</tbody>
</table>
<section id="figure-7.2.1.-moran-scatterplot" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.2.1.-moran-scatterplot">Figure 7.2.1. Moran Scatterplot</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">9</span>))  <span class="co"># Set figure size</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>moran_scatterplot(mi, ax<span class="op">=</span>ax)  <span class="co"># Create Moran's I scatterplot</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the color and size of points</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>scatter_plot <span class="op">=</span> ax.get_children()[<span class="dv">0</span>]</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>scatter_plot.set_facecolor(<span class="st">'#09435a'</span>)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>scatter_plot.set_edgecolor(<span class="st">'#09435a'</span>)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>scatter_plot.set_sizes([<span class="dv">10</span>])</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_161_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>To minimise outlier impact, the distance value for this OA will be reduced to the second highest value.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find maximum distance</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'Distance'</span>].<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>2090.9863451326555</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the second highest distance</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>final_df[final_df[<span class="st">'Distance'</span>] <span class="op">&lt;</span> final_df[<span class="st">'Distance'</span>].<span class="bu">max</span>()][<span class="st">'Distance'</span>].<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>1268.1070267044204</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>distance_sort <span class="op">=</span> final_df.Distance.tolist() <span class="co"># Create a list of distances</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>distance_sort.remove(<span class="bu">max</span>(distance_sort)) <span class="co"># Remove maximum value</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the new max (second highest)</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'Distance_Clean'</span>] <span class="op">=</span> final_df.Distance <span class="co">#create a new column</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>final_df.loc[final_df[<span class="st">'Distance'</span>]<span class="op">&gt;</span><span class="dv">1500</span>, <span class="st">'Distance_Clean'</span>] <span class="op">=</span> <span class="bu">max</span>(distance_sort) </span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co"># If the distance is greater than 1500 in the original variable, set it equal to the maximum value of our cleaned variable</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use 1500 as a buffer to the actual 2nd highest distance shown in the previous cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check new max is expected value</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(final_df[<span class="st">'Distance_Clean'</span>].<span class="bu">max</span>())</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(final_df[<span class="st">'Distance_Clean'</span>].<span class="bu">max</span>() <span class="op">==</span> final_df[final_df[<span class="st">'Distance'</span>] <span class="op">&lt;</span> final_df[<span class="st">'Distance'</span>].<span class="bu">max</span>()][<span class="st">'Distance'</span>].<span class="bu">max</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>1268.1070267044204</p>
<p>True</p>
<p>Moran’s I is re-calculated and the I value is now 0.47, and the p-value remains 0.001. These results are still positive and significant respectively, so distance to nearest greenspace remains spatially correlated. Figure 7.2.2. shows the outlier is removed.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate new Moran's I using queen weights and cleaned Distance variable</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>mi_adj <span class="op">=</span> esda.Moran(final_df[<span class="st">'Distance_Clean'</span>], w_queen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I value</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'I value: </span><span class="sc">{</span>mi_adj<span class="sc">.</span>I<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Significance (p value)</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'P value: </span><span class="sc">{</span>mi_adj<span class="sc">.</span>p_sim<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">I value</th>
<th style="text-align: center;">0.47144858850487537</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">P value</td>
<td style="text-align: center;">0.001</td>
</tr>
</tbody>
</table>
</section>
<section id="figure-7.2.2.-moran-scatterplot-adjusted" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.2.2.-moran-scatterplot-adjusted">Figure 7.2.2. Moran Scatterplot (Adjusted)</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">9</span>))  <span class="co"># Set figure size</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>moran_scatterplot(mi_adj, ax<span class="op">=</span>ax)  <span class="co"># Create Moran's I scatterplot</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the color and size of points</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>scatter_plot <span class="op">=</span> ax.get_children()[<span class="dv">0</span>]</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>scatter_plot.set_facecolor(<span class="st">'#09435a'</span>)</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>scatter_plot.set_edgecolor(<span class="st">'#09435a'</span>)</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>scatter_plot.set_sizes([<span class="dv">10</span>])</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_171_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
</section>
<section id="lisa-clusters" class="level3">
<h3 class="anchored" data-anchor-id="lisa-clusters">7.3. LISA Clusters</h3>
<p>Spatial association will be tested and visualised using Local Indicators of Spatial Association (LISA) clusters. This will be conducted on the dependent variable and residuals from Section 7.1.</p>
<section id="distance" class="level4">
<h4 class="anchored" data-anchor-id="distance">Distance</h4>
<p>Significance is calculated to the 95% level and a LISA cluster assigned. Figure 7.3.1. shows each LISA cluster, with clear spatial patterns emerging. To the north and south, and north of Bradford city centre, there are High-High clusters, meaning these OAs have high distances to the nearest greenspace as do their neighbouring OAs. Meanwhile, Low-Low clusters can be observed around the city of Bradford suburbs and Keighley town centre.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>lisa_Distance <span class="op">=</span> esda.Moran_Local(final_df[<span class="st">'Distance_Clean'</span>], w_queen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'Sig_Distance'</span>] <span class="op">=</span> lisa_Distance.p_sim <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="co"># Calculate a variable to show which are significant at the 95% level</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'Quad_Distance'</span>] <span class="op">=</span> lisa_Distance.q <span class="co"># Calculate a variable indicating the respective quadrant</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create categorical column for the map visual</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'LISA_Distance'</span>] <span class="op">=</span> np.select(</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Distance'</span>] <span class="op">==</span> <span class="va">False</span>),</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Distance'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_Distance'</span>] <span class="op">==</span> <span class="dv">1</span>),</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Distance'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_Distance'</span>] <span class="op">==</span> <span class="dv">2</span>),</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Distance'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_Distance'</span>] <span class="op">==</span> <span class="dv">3</span>),</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Distance'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_Distance'</span>] <span class="op">==</span> <span class="dv">4</span>)</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Not Significant'</span>,</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'High-High'</span>,</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Low-High'</span>,</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Low-Low'</span>,</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'High-Low'</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>    default<span class="op">=</span><span class="st">'ERROR'</span>  <span class="co"># Return "ERROR" string if conditions above are not met</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="figure-7.3.1.-map-of-distance-lisa-clusters-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.3.1.-map-of-distance-lisa-clusters-by-oa-in-bradford-lad">Figure 7.3.1. Map of distance LISA Clusters by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>custom_cmap <span class="op">=</span> mcolors.ListedColormap([<span class="st">'#E14D2A'</span>,<span class="st">'#FACF5A'</span>,<span class="st">'#4F9DA6'</span>,<span class="st">'#233142'</span>,<span class="st">'lightGrey'</span>])</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>final_df.plot(column<span class="op">=</span><span class="st">'LISA_Distance'</span>, </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>              ax<span class="op">=</span>ax, </span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>              categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>              legend<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>              cmap<span class="op">=</span>custom_cmap)</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add basemap</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span>final_df.crs.to_string(), source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize plot</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_179_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="residuals" class="level4">
<h4 class="anchored" data-anchor-id="residuals">Residuals</h4>
<p>Figure 7.3.2. shows similar spatial patterns for the residual LISA clusters. There is one noticeable OA to the north that is Low-High - this OA has a small residual error compared to neighbouring OAs – and fewer Low-High clusters in central areas. Despite these differences, spatial association is still present across much of the district.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>lisa_Residuals <span class="op">=</span> esda.Moran_Local(final_df[<span class="st">'Residuals'</span>], w_queen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'Sig_Residuals'</span>] <span class="op">=</span> lisa_Residuals.p_sim <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="co"># Calculate a variable to show which are significant at the 95% level</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'Quad_Residuals'</span>] <span class="op">=</span> lisa_Residuals.q <span class="co"># Calculate a variable indicating the respective quadrant</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create categorical column for the map visual</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'LISA_Residuals'</span>] <span class="op">=</span> np.select(                                           <span class="co"># Select rows meeting following rules</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Residuals'</span>] <span class="op">==</span> <span class="va">False</span>),                                     <span class="co"># Not significant</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Residuals'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_Residuals'</span>] <span class="op">==</span> <span class="dv">1</span>),  <span class="co"># Significant and Quadrant 1</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Residuals'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_Residuals'</span>] <span class="op">==</span> <span class="dv">2</span>),  <span class="co"># Significant and Quadrant 2</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Residuals'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_Residuals'</span>] <span class="op">==</span> <span class="dv">3</span>),  <span class="co"># Significant and Quadrant 3</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_Residuals'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_Residuals'</span>] <span class="op">==</span> <span class="dv">4</span>)   <span class="co"># Significant and Quadrant 4</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Not Significant'</span>,                                                        <span class="co"># Assign string based on above rules</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'High-High'</span>,</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Low-High'</span>,</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Low-Low'</span>,</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'High-Low'</span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>    default<span class="op">=</span><span class="st">'ERROR'</span>  <span class="co"># Return "ERROR" string if conditions above are not met</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="figure-7.3.2.-map-of-residual-lisa-clusters-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.3.2.-map-of-residual-lisa-clusters-by-oa-in-bradford-lad">Figure 7.3.2. Map of residual LISA Clusters by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>custom_cmap <span class="op">=</span> mcolors.ListedColormap([<span class="st">'#E14D2A'</span>,<span class="st">'#FACF5A'</span>,<span class="st">'#4F9DA6'</span>,<span class="st">'#233142'</span>,<span class="st">'lightGrey'</span>])</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot choropleth map</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>final_df.plot(column<span class="op">=</span><span class="st">'LISA_Residuals'</span>, </span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>              ax<span class="op">=</span>ax, </span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>              categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>              legend<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>              cmap<span class="op">=</span>custom_cmap)</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add basemap</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span>final_df.crs.to_string(), source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize plot</span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title to legend</span></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>ax.get_legend().set_title(<span class="st">'LISA Clusters for Residuals'</span>)</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot</span></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_185_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Results from the Moran’s I and LISA cluster analysis confirms a Geographically Weighted Regression (GWR) model is required to ensure spatial association is considered.</p>
</section>
</section>
<section id="gwr-model" class="level3">
<h3 class="anchored" data-anchor-id="gwr-model">7.4. GWR model</h3>
<p>Bandwidth is the optimal number of datapoints that will be included in each local regression model. The bandwidth calculated is 54.0 – the 54 nearest datapoints of the 1,575 OAs in the dataset will be included, hence each local model will be using roughly 3% of the available data.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the geometry into X and Y columns</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>Bradford_OA_PWC_tidy[<span class="st">'X'</span>] <span class="op">=</span> Bradford_OA_PWC_tidy[<span class="st">'geometry'</span>].x</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>Bradford_OA_PWC_tidy[<span class="st">'Y'</span>] <span class="op">=</span> Bradford_OA_PWC_tidy[<span class="st">'geometry'</span>].y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this to the final_df</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> final_df.merge(Bradford_OA_PWC_tidy, how<span class="op">=</span><span class="st">'inner'</span>, on<span class="op">=</span><span class="st">'OA21CD'</span>).drop([<span class="st">'geometry'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>g_coords <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(final_df.X, final_df.Y)) <span class="co"># Create a list of x and y coordinates</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create y variable</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>g_y <span class="op">=</span> np.asarray(final_df.Distance_Clean).reshape((<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create x variables</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>g_X <span class="op">=</span> final_df[[<span class="st">'HHD_dep_education_PC'</span>, <span class="st">'HHD_dep_health_PC'</span>, <span class="st">'HHD_dep_housing_PC'</span>]]</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>g_X <span class="op">=</span> np.asarray(g_X)</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>gwr_selector <span class="op">=</span> Sel_BW(g_coords, g_y, g_X) <span class="co">#set parameters for calculating the bandwidth</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate optimised bandwidth</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>bw <span class="op">=</span> gwr_selector.search()</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>54.0</p>
<p>The GWR model (figure 7.4.1) includes global regression results reflecting the OLS model (section 7.1), whilst GWR results give details of the local models. The R-squared value is 0.458 (45.8% of variance is accounted for) which is higher than the global regression model.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create GWR model</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>gwr <span class="op">=</span> GWR(g_coords, g_y, g_X, bw)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>gwr_results <span class="op">=</span> gwr.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="figure-7.4.1.-results-of-gwr-model" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.4.1.-results-of-gwr-model">Figure 7.4.1. Results of GWR model</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View results summary</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gwr_results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>===========================================================================
Model type                                                         Gaussian
Number of observations:                                                1575
Number of covariates:                                                     4

Global Regression Results
---------------------------------------------------------------------------
Residual sum of squares:                                       48341131.294
Log-likelihood:                                                  -10371.107
AIC:                                                              20750.214
AICc:                                                             20752.253
BIC:                                                           48329565.576
R2:                                                                   0.045
Adj. R2:                                                              0.043

Variable                              Est.         SE  t(Est/SE)    p-value
------------------------------- ---------- ---------- ---------- ----------
X0                                 356.449     18.078     19.717      0.000
X1                                -188.300     54.328     -3.466      0.001
X2                                -123.805     64.449     -1.921      0.055
X3                                -168.246     48.766     -3.450      0.001

Geographically Weighted Regression (GWR) Results
---------------------------------------------------------------------------
Spatial kernel:                                           Adaptive bisquare
Bandwidth used:                                                      54.000

Diagnostic information
---------------------------------------------------------------------------
Residual sum of squares:                                       27460005.829
Effective number of parameters (trace(S)):                          269.555
Degree of freedom (n - trace(S)):                                  1305.445
Sigma estimate:                                                     145.034
Log-likelihood:                                                   -9925.735
AIC:                                                              20392.580
AICc:                                                             20505.314
BIC:                                                              21843.301
R2:                                                                   0.458
Adjusted R2:                                                          0.346
Adj. alpha (95%):                                                     0.001
Adj. critical t value (95%):                                          3.380

Summary Statistics For GWR Parameter Estimates
---------------------------------------------------------------------------
Variable                   Mean        STD        Min     Median        Max
-------------------- ---------- ---------- ---------- ---------- ----------
X0                      292.885    208.447   -231.865    259.474   1217.183
X1                     -165.196    519.824  -1890.328   -113.466   1930.027
X2                        6.041    578.986  -2557.624    -23.072   2446.111
X3                     -291.652    856.329  -4271.564   -262.118   5015.975
===========================================================================

None</code></pre>
<p>Visualising results requires defining the t-value significance. Figure 7.4.1. shows there are 1,305 degrees of freedom which, using a standard t-table, gives a significance value of -/+1.96 at the 0.05 level. This is the parameter used to assign significance.</p>
<p>On each choropleth, only OAs with a thick outline are significant in the t-value results. This highlights where there are, or are not, significant results in the local models. The colour shows whether these relationships (coefficients) are positive or negative.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GWR coeffients to final_df for each predictor variable</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'GWR_Education_Coefficient'</span>] <span class="op">=</span> gwr_results.params[:,<span class="dv">1</span>]</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'GWR_Health_Coefficient'</span>] <span class="op">=</span> gwr_results.params[:,<span class="dv">2</span>]</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'GWR_Housing_Coefficient'</span>] <span class="op">=</span> gwr_results.params[:,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GWR t-values to final_df for each predictor variable</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'GWR_Education_tvalue'</span>] <span class="op">=</span> gwr_results.tvalues[:,<span class="dv">1</span>]</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'GWR_Health_tvalue'</span>] <span class="op">=</span> gwr_results.tvalues[:,<span class="dv">2</span>]</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'GWR_Housing_tvalue'</span>] <span class="op">=</span> gwr_results.tvalues[:,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create categorical column for the map visual based on t-value significance</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_categorical(Variable):      <span class="co"># takes variable as string</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    new_col <span class="op">=</span> Variable <span class="op">+</span> <span class="st">'_significance'</span>   <span class="co"># create new column name</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    final_df[new_col] <span class="op">=</span> np.select(                                          <span class="co"># Select rows meeting following rules</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>            (final_df[Variable] <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1.96</span>),                                   <span class="co"># t-value significance less than -1.96</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>            (final_df[Variable] <span class="op">&gt;</span> <span class="fl">1.96</span>),                                    <span class="co"># t-value significance greater than 1.96</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>            (final_df[Variable] <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">1.96</span>) <span class="op">&amp;</span> (final_df[Variable] <span class="op">&lt;=</span> <span class="fl">1.96</span>)    <span class="co"># t-value not significant</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Significant (negative t-value)'</span>,                               <span class="co"># Assign string based on above rules</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Significant (positive t-value)'</span>,</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Not significant'</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>        default<span class="op">=</span><span class="st">'ERROR'</span>  <span class="co"># Return "ERROR" string if conditions above are not met</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add columns to dataframe using the function above</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>create_categorical(<span class="st">'GWR_Education_tvalue'</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>create_categorical(<span class="st">'GWR_Health_tvalue'</span>)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>create_categorical(<span class="st">'GWR_Housing_tvalue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subsets of the data for the purposes of the map visual</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Only rows where the t-value is significant are needed to highlight the outline of the OAs on the map</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>GWR_Emp_sig <span class="op">=</span> final_df[(final_df[<span class="st">'GWR_Education_tvalue_significance'</span>] <span class="op">==</span> <span class="st">'Significant (negative t-value)'</span>) <span class="op">|</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                      (final_df[<span class="st">'GWR_Education_tvalue_significance'</span>] <span class="op">==</span> <span class="st">'Significant (positive t-value)'</span>)]</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>GWR_Health_sig <span class="op">=</span> final_df[(final_df[<span class="st">'GWR_Health_tvalue_significance'</span>] <span class="op">==</span> <span class="st">'Significant (negative t-value)'</span>) <span class="op">|</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>                      (final_df[<span class="st">'GWR_Health_tvalue_significance'</span>] <span class="op">==</span> <span class="st">'Significant (positive t-value)'</span>)]</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>GWR_Housing_sig <span class="op">=</span> final_df[(final_df[<span class="st">'GWR_Housing_tvalue_significance'</span>] <span class="op">==</span> <span class="st">'Significant (negative t-value)'</span>) <span class="op">|</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>                      (final_df[<span class="st">'GWR_Housing_tvalue_significance'</span>] <span class="op">==</span> <span class="st">'Significant (positive t-value)'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> viz_coefficients_t_value(final_df, Coeff_variable, Sig_df, Sig_variable):</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualise the coefficients</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot coefficients choropleth</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    coef_plot <span class="op">=</span> final_df.plot(column<span class="op">=</span>Coeff_variable, </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>                              ax<span class="op">=</span>ax, </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>                              cmap<span class="op">=</span><span class="st">'RdYlBu'</span>, </span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>                              scheme<span class="op">=</span><span class="st">'userdefined'</span>, </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>                              classification_kwds<span class="op">=</span><span class="bu">dict</span>(bins<span class="op">=</span>[<span class="op">-</span><span class="dv">1000</span>, <span class="op">-</span><span class="dv">500</span>, <span class="dv">0</span>, <span class="dv">500</span>, <span class="dv">1000</span>]), </span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>                              legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>                              legend_kwds<span class="op">=</span>{<span class="st">'title'</span>: <span class="st">'Coefficients'</span>},</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>                              alpha<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot significance information</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> Sig_df.iterrows():</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"Significant"</span> <span class="kw">in</span> row[Sig_variable]:</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"positive"</span> <span class="kw">in</span> row[Sig_variable]:</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>                final_df[final_df[<span class="st">'OA21CD'</span>] <span class="op">==</span> row[<span class="st">'OA21CD'</span>]].plot(ax<span class="op">=</span>ax, </span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>                                                                    color<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>                                                                    edgecolor<span class="op">=</span><span class="st">'#000026'</span>, </span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>                                                                    linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="st">"negative"</span> <span class="kw">in</span> row[Sig_variable]:</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>                final_df[final_df[<span class="st">'OA21CD'</span>] <span class="op">==</span> row[<span class="st">'OA21CD'</span>]].plot(ax<span class="op">=</span>ax, </span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>                                                                    color<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>                                                                    edgecolor<span class="op">=</span><span class="st">'#800020'</span>,  <span class="co"># Burgundy color</span></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>                                                                    linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>            final_df[final_df[<span class="st">'OA21CD'</span>] <span class="op">==</span> row[<span class="st">'OA21CD'</span>]].plot(ax<span class="op">=</span>ax, </span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>                                                                color<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>                                                                edgecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize plot</span></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add basemap</span></span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>    ctx.add_basemap(ax, crs<span class="op">=</span>final_df.crs.to_string(), source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract legend labels and handles</span></span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>        coef_legend_elements <span class="op">=</span> coef_plot.get_legend().legendHandles</span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>        coef_legend_labels <span class="op">=</span> [text.get_text() <span class="cf">for</span> text <span class="kw">in</span> coef_plot.get_legend().get_texts()]</span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">AttributeError</span>:</span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>        coef_legend_elements, coef_legend_labels <span class="op">=</span> coef_plot.get_legend_handles_labels()</span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create legend for both coefficient values and significance</span></span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>    sig_legend_elements <span class="op">=</span> [Line2D([<span class="dv">0</span>], [<span class="dv">0</span>], color<span class="op">=</span><span class="st">'#000026'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Positive Significant'</span>),</span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>                           Line2D([<span class="dv">0</span>], [<span class="dv">0</span>], color<span class="op">=</span><span class="st">'#800020'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Negative Significant'</span>)]</span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>    legend_handles <span class="op">=</span> coef_legend_elements <span class="op">+</span> sig_legend_elements</span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>    legend_labels <span class="op">=</span> coef_legend_labels <span class="op">+</span> [<span class="st">'Significant - positive t-value'</span>, <span class="st">'Significant - negative t-value'</span>]</span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a>    ax.legend(handles<span class="op">=</span>legend_handles, labels<span class="op">=</span>legend_labels, loc<span class="op">=</span><span class="st">'upper right'</span>, title<span class="op">=</span><span class="st">"Coefficients"</span>)</span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show plot</span></span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Figure 7.4.2. shows statistically significant spatial patterns for education deprivation, with clusters of negative relationships in the north, west and central areas. This means that in these areas, as education deprivation increases, the distance to the nearest greenspace decreases. By contrast, clusters of positive relationships can be seen in the northwest and southeast.</p>
</section>
<section id="figure-7.4.2.-map-of-gwr-model-results-and-significance-for-education-deprivation-by-oa-in-the-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.4.2.-map-of-gwr-model-results-and-significance-for-education-deprivation-by-oa-in-the-bradford-lad">Figure 7.4.2. Map of GWR model results and significance for education deprivation, by OA in the Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with the required parameters</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>viz_coefficients_t_value(final_df, <span class="st">'GWR_Education_Coefficient'</span>, GWR_Emp_sig, <span class="st">'GWR_Education_tvalue_significance'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_206_1.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Health deprivation (figure 7.4.3.) displays clusters of negative relationships in the north and Bradford city centre. Positive relationships exist in the northwest, south and suburbs north of Bradford city centre. This contrasts education deprivation but is not unexpected given higher levels of health deprivation shown in figure 6.3.3. across the district and that the spatial pattern of this varied compared to other deprivation dimensions.</p>
</section>
<section id="figure-7.4.3.-map-of-gwr-model-results-and-significance-for-health-deprivation-by-oa-in-the-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.4.3.-map-of-gwr-model-results-and-significance-for-health-deprivation-by-oa-in-the-bradford-lad">Figure 7.4.3. Map of GWR model results and significance for health deprivation, by OA in the Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with the required parameters</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>viz_coefficients_t_value(final_df, <span class="st">'GWR_Health_Coefficient'</span>, GWR_Emp_sig, <span class="st">'GWR_Health_tvalue_significance'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_209_1.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Figure 7.4.4. shows housing deprivation has large negative clusters in the north and south, and Bradford city centre. There are fewer statistically significant positive relationships across the district, with a small number in the north and east.</p>
</section>
<section id="figure-7.4.4.-map-of-gwr-model-results-and-significance-for-housing-deprivation-by-oa-in-the-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.4.4.-map-of-gwr-model-results-and-significance-for-housing-deprivation-by-oa-in-the-bradford-lad">Figure 7.4.4. Map of GWR model results and significance for housing deprivation, by OA in the Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with the required parameters</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>viz_coefficients_t_value(final_df, <span class="st">'GWR_Housing_Coefficient'</span>, GWR_Emp_sig, <span class="st">'GWR_Housing_tvalue_significance'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_212_1.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Lastly, mapping residuals of the GWR model demonstrate the change from the OLS regression model (figure 7.3.2.). Figure 7.4.5. shows the GWR model removed some residual autocorrelation but not all of it. This means some spatial variation has still not been captured. This is confirmed by recalculating the Moran’s I value and significance. The I value has decreased to 0.23 showing clustering has been reduced but is still present. The p-value of 0.001 shows this is statistically significant.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GWR residuals to the final_df</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'GWR_residuals'</span>] <span class="op">=</span> gwr_results.resid_response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters as before but with GWR_residuals</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>lisa_GWR_Residuals <span class="op">=</span> esda.Moran_Local(final_df[<span class="st">'GWR_residuals'</span>], w_queen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the 95% significance and quadrants as before but for the GWR_Residuals</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'Sig_GWR_Residuals'</span>] <span class="op">=</span> lisa_GWR_Residuals.p_sim <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'Quad_GWR_Residuals'</span>] <span class="op">=</span> lisa_GWR_Residuals.q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create categorical column for the map visual using if/and rules as before</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>final_df[<span class="st">'LISA_GWR_Residuals'</span>] <span class="op">=</span> np.select(</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_GWR_Residuals'</span>] <span class="op">==</span> <span class="va">False</span>),</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_GWR_Residuals'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_GWR_Residuals'</span>] <span class="op">==</span> <span class="dv">1</span>),</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_GWR_Residuals'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_GWR_Residuals'</span>] <span class="op">==</span> <span class="dv">2</span>),</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_GWR_Residuals'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_GWR_Residuals'</span>] <span class="op">==</span> <span class="dv">3</span>),</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>        (final_df[<span class="st">'Sig_GWR_Residuals'</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (final_df[<span class="st">'Quad_GWR_Residuals'</span>] <span class="op">==</span> <span class="dv">4</span>)</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Not Significant'</span>,</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'High-High'</span>,</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Low-High'</span>,</span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Low-Low'</span>,</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'High-Low'</span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>    default<span class="op">=</span><span class="st">'ERROR'</span>  <span class="co"># Return "ERROR" string if conditions above are not met</span></span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="figure-7.4.5.-map-of-gwr-residual-lisa-clusters-by-oa-in-bradford-lad" class="level4">
<h4 class="anchored" data-anchor-id="figure-7.4.5.-map-of-gwr-residual-lisa-clusters-by-oa-in-bradford-lad">Figure 7.4.5. Map of GWR residual LISA Clusters by OA in Bradford LAD</h4>
<div style="color: #808080; margin-top: 5px">
<pre><code>Data Source: Author's calculations</code></pre>
</div>
<div class="sourceCode" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom colormap</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>custom_cmap <span class="op">=</span> mcolors.ListedColormap([<span class="st">'#E14D2A'</span>,<span class="st">'#FACF5A'</span>,<span class="st">'#4F9DA6'</span>,<span class="st">'#233142'</span>,<span class="st">'lightGrey'</span>])</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot choropleth</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>final_df.plot(column<span class="op">=</span><span class="st">'LISA_GWR_Residuals'</span>, </span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>              ax<span class="op">=</span>ax, </span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>              categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>              legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>              cmap<span class="op">=</span>custom_cmap,  </span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>              edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>              linewidth<span class="op">=</span><span class="fl">0.25</span>,</span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>              legend_kwds<span class="op">=</span>{<span class="st">'loc'</span>: <span class="st">'upper right'</span>, <span class="st">'title'</span>: <span class="st">'LISA GWR Residuals'</span>})</span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add basemap</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span>final_df.crs.to_string(), source<span class="op">=</span>ctx.providers.CartoDB.Positron)</span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize plot</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Show map</span></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output-images/output_219_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Moran's I</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>mi <span class="op">=</span> esda.Moran(final_df[<span class="st">'GWR_residuals'</span>], w_queen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I value</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'I value: </span><span class="sc">{</span>mi<span class="sc">.</span>I<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Significance (p value)</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'P value: </span><span class="sc">{</span>mi<span class="sc">.</span>p_sim<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">I value</th>
<th style="text-align: center;">0.23403007956028024</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">P value</td>
<td style="text-align: center;">0.001</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">8. Discussion</h2>
<p>Results showed deprivation and distance to greenspace are negatively correlated, reflecting much of the literature, and rejects the null hypothesis posed. However, the relationship differs by dimension and spatially. Any policy or intervention needs to consider this.</p>
<p>Key differentiators of this study are using deprivation dimensions and OA geographies, attempting to consider distance at a local level appropriate to the Natural England (2023) targets. However, there are limitations and opportunities for improvement.</p>
<p>Firstly, not all greenspace is considered. Many woodlands, moorlands, river and canal paths are not included but are publicly accessible. Including this would better reflect true greenspace but would also raise consideration of type. Different greenspace serves different purposes – for example, a children’s park versus unmaintained moorland – and so understanding access to different types may further unlock insight into what is within an accessible distance and for whom.</p>
<p>Secondly, the distance calculation could be improved. Utilising address data to estimate household locations, alongside road and path networks, would allow more accurate calculation of distance to greenspace. This could be an average walk time which would align better to Natural England (2023) targets.</p>
<p>Lastly, two limitations identified in the literature remain: quality and usage. Quality can be subjective and dependent on the greenspace’s purpose. However, a survey recording facilities, amenities, and biodiversity could develop a qualitative understanding. The Natural Environment Scoring Tool (NEST) used in Ferguson et al’s (2018) study provides a starting point. Technological advancements could improve usage data, such as GPS which was used by Mears et al (2021), however data protection, scale, and availability challenges exist.</p>
<p>Despite these limitations, actions could result from the findings. Deprivation differs by dimension and policy needs to consider this, as well as communities and their needs. These needs will vary by area. This is supported by research conducted on community perceptions (McEachan et al, 2018), highlighting the importance of including communities in decision-making processes.</p>
<p>Finally, two areas of future research are identified. Firstly, including a broader set of demographic measures beyond deprivation. Age and ethnicity are key, as shown in the literature, but no research addressed in this study has considered variables such as profession which could have an impact on how and when someone accesses greenspace. Secondly, there is opportunity to reflect on the impact of new greenspace, or improvements to current greenspace, to learn and adapt plans. CBMDC (2021) have clear goals they wish to achieve, but understanding the effectiveness of interventions is needed to ensure investments add value. Deprivation can be a relatively slow to change measure. Further studies analysing more reactive variables may enable a comprehensive review of what works in different communities.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">9. Conclusion</h2>
<p>This study sought to build on previous research into the relationship between distance to greenspace and deprivation by splitting deprivation into the component dimensions. The findings mirror the literature that there is a statistically significant, negative correlation between distance to greenspace and deprivation, but the use of dimensions and understanding this spatially has shown that the results vary by area. Policy implications are that decisions should be on a local scale, and interventions may vary depending on the community and their needs.</p>
<p>However, this is not only tied to deprivation and this study has argued that a more holistic view of demographics within communities is required, and consideration for the type of greenspace and its uses. This will allow planners to develop better suited solutions to improve community health and wellbeing, with greenspace that meets the needs and wants of the communities they serve.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Barbosa, O., Tratalos. J.A., Armsworth, P.R., Davies, R.G., Fuller, R.A., Johnson, P. and Gaston, K.J. 2007. Who benefits from access to green space? A case study from Sheffield, UK. <em>Landscape and Urban Planning</em>. <strong>83</strong>(2-3), pp.&nbsp;187-195.</p>
<p>City of Bradford Metropolitan District Council (CBMDC). 2019. <em>Public Health - Joint Strategic Needs Assessment</em>. [Online]. Bradford: City of Bradford Metropolitan District Council. [Accessed 09 January 2024]. Available from: https://jsna.bradford.gov.uk/</p>
<p>City of Bradford Metropolitan District Council (CBMDC). 2021. <em>Our Council Plan: Priorities and Principles 2021-2025</em>. [Online]. Bradford: City of Bradford Metropolitan District Council. [Accessed 09 January 2024]. Available from: https://www.bradford.gov.uk/media/6508/bradfordcouncilplan.pdf</p>
<p>City of Bradford Metropolitan District Council (CBMDC). 2022. <em>2021 Census: Bradford District</em>. [Online]. [Accessed 09 January 2024]. Available from: https://ubd.bradford.gov.uk/about-us/2021-census/</p>
<p>Ferguson, M., Roberts, H.E., McEachan, R.R.C. and Dallimer, M. 2018. Contrasting distributions of urban green infrastructure across social and ethno-racial groups. <em>Landscape and Urban Planning</em>. <strong>175</strong>, pp.136-148.</p>
<p>Gidlow, C.J. and Ellis, N.J. 2011. Neighbourhood green space in deprived urban communities: issues and barriers to use. <em>The International Journal of Justice and Sustainability</em>. <strong>16</strong>(10), pp.989-1002.</p>
<p>Houlden, V., Porto de Albuquerque, J., Weich, S. and Jarvis, S. 2019. A spatial analysis of proximate greenspace and mental wellbeing in London. <em>Applied Geography</em>. <strong>109</strong>, pp.102036.</p>
<p>Jia, P., Cao, X., Yang, H., Dai, S., He, P., Huang, G., Wu, T. and Wang, Y. 2021. Green space access in the neighbourhood and childhood obesity. <em>Obesity Reviews</em>. <strong>22</strong>(51), pp.13100.</p>
<p>Jones, A., Hillsdon, M. and Coombes, E. 2009. Greenspace access, use, and physical activity: Understanding the effects of area deprivation. <em>Preventive Medicine</em>. <strong>49</strong>(6), pp.500-505.</p>
<p>Kessel, A., Green, J., Pinder, R., Wilkinson, P., Grundy, C. and Lachowycz, K. 2009. Multidisciplinary research in public health: A case study of research on access to green space. <em>Public Health</em>. <strong>123</strong>(1), pp.32-38.</p>
<p>Lachowycz, K. and Jones, A.P. 2011. Greenspace and obesity: a systematic review of the evidence. <em>Obesity Reviews</em>. <strong>12</strong>(5), pp.183-189.</p>
<p>McCormick, R. 2017. Does Access to Green Space Impact the Mental Well-being of Children: A Systematic Review. <em>Journal of Pediatric Nursing</em>. <strong>37</strong>, pp.3-7.</p>
<p>McEachan, R.R.C., Yang, T.C., Roberts, H., Pickett, K.E., Arseneau-Powell, D., Gidlow, C.J., Wright, J. and Nieuwenhuijsen, M. 2018. Availability, use of, and satisfaction with green space, and children’s mental wellbeing at age 4 years in a multicultural, deprived, urban area: results from the Born in Bradford cohort study. <em>The Lancet Planetary Health</em>. <strong>2</strong>(6), pp.244-254.</p>
<p>Mears, M., Brindley, P., Barrows, P., Richardson, M. and Maheswaran, R. 2021. Mapping urban greenspace use from mobile phone GPS data. <em>PLoS ONE</em>. <strong>16</strong>(7), pp.0248622.</p>
<p>Mears, M., Brindley, P., Maheswaran, R. and Jorgensen, A. 2019. Understanding the socioeconomic equity of publicly accessible greenspace distribution: The example of Sheffield, UK. <em>Geoforum</em>. <strong>103</strong>, pp.126-137.</p>
<p>Mueller, N., Rojas-Rueda, D., Khreis, H., Cirach, M., Milà, C., Espinosa, A., Foraster, M., McEachan, R.R.C., Kelly, B., Wright, J. and Nieuwenhuijsen, M. 2018. Socioeconomic inequalities in urban and transport planning related exposures and mortality: A health impact assessment study for Bradford, UK. <em>Environment International</em>. <strong>121</strong>(1), pp.931-941.</p>
<p>Natural England. 2023. <em>Natural England unveils new Green Infrastructure Framework</em>. [Press release]. [Accessed 09 January 2024]. Available from: https://www.gov.uk/government/news/natural-england-unveils-new-green-infrastructure-framework</p>
<p>Office for National Statistics (ONS). 2021. <em>Census 2021 geographies</em>. [Online]. [Accessed 09 January 2024]. Available from: https://www.ons.gov.uk/methodology/geography/ukgeographies/censusgeographies/census2021geographies</p>
<p>Office for National Statistics (ONS). 2023a. Output Areas (2021) Boundaries EW BFC. <em>Open Geography Portal</em>. [Online]. [Accessed 11 December 2023]. Available from: https://geoportal.statistics.gov.uk/datasets/ons::output-areas-2021-boundaries-ew-bfc/about</p>
<p>Office for National Statistics (ONS). 2023b. Output Areas (December 2021) PWC (V3). <em>Open Geography Portal</em>. [Online]. [Accessed 11 December 2023]. Available from: https://geoportal.statistics.gov.uk/datasets/ons::output-areas-december-2021-pwc-v3/about</p>
<p>Office for National Statistics (ONS). 2023c. Output Area to Lower layer Super Output Area to Middle layer Super Output Area to Local Authority District (December 2021) Lookup in England and Wales V2. <em>Open Geography Portal</em>. [Online]. [Accessed 14 December 2023]. Available from: https://geoportal.statistics.gov.uk/datasets/output-area-to-lower-layer-super-output-area-to-middle-layer-super-output-area-to-local-authority-district-december-2021-lookup-in-england-and-wales-v2-1/about</p>
<p>Office for National Statistics (ONS). 2023d. Household deprivation in the education dimension. <em>Office for National Statistics</em>. [Online]. [Accessed 14 December 2023]. Available from: https://www.ons.gov.uk/filters/d7bede85-c97b-4b85-84a8-87b5164d3add/dimensions</p>
<p>Office for National Statistics (ONS). 2023e. Household deprivation in the employment dimension. <em>Office for National Statistics</em>. [Online]. [Accessed 14 December 2023]. Available from: https://www.ons.gov.uk/filters/103a7748-96d9-4e79-97e2-e1cc42ef7024/dimensions</p>
<p>Office for National Statistics (ONS). 2023f. Household deprivation in the health dimension. <em>Office for National Statistics</em>. [Online]. [Accessed 14 December 2023]. Available from: https://www.ons.gov.uk/filters/15149637-c729-4aa5-b817-d687cad093d8/dimensions</p>
<p>Office for National Statistics (ONS). 2023g. Household deprivation in the housing dimension. <em>Office for National Statistics</em>. [Online]. [Accessed 14 December 2023]. Available from: https://www.ons.gov.uk/filters/cf7beddc-198f-411a-9b66-9c690d18e3bf/dimensions</p>
<p>Office for National Statistics (ONS). 2023h. <em>How life has changed in Bradford: Census 2021</em>. [Online]. [Accessed 09 January 2024]. Available from: https://www.ons.gov.uk/visualisations/censusareachanges/E08000032/</p>
<p>Office for National Statistics (ONS). 2023i. <em>Rising ill-health and economic inactivity because of long-term sickness, UK: 2019 to 2023.</em> [Online]. [Accessed 11 January 2024]. Available from: https://rb.gy/bsf8hg</p>
<p>Ordnance Survey (OS). 2023. OS Open Greenspace. <em>Ordnance Survey</em>. [Online]. [Accessed 6 December 2023]. Available from: https://osdatahub.os.uk/downloads/open/OpenGreenspace</p>
<p>Paez, A. and Scott, D.M. 2004. Spatial statistics for urban analysis: A review of techniques with examples. <em>GeoJournal</em>. <strong>61</strong>, pp.53-67.</p>
<p>Roe, J., Aspinall, P.A. and Thompson, C.W. 2016. Understanding Relationships between Health, Ethnicity, Place and the Role of Urban Green Space in Deprived Urban Communities. <em>International Journal of Environmental Research and Public Health</em>. <strong>13</strong>(7), pp.681.</p>
<p>Wood, E., Harsant, A., Dallimer, M., Cronin de Chavez, A., McEachan, R.R.C. and Hassall, C. 2018. Not All Green Space Is Created Equal: Biodiversity Predicts Psychological Restorative Benefits From Urban Green Space. <em>Frontiers in Psychology</em>. <strong>9</strong>, pp2320.</p>
</section>
<section id="appendix-1---wrangled-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="appendix-1---wrangled-dataframes">Appendix 1 - Wrangled dataframes</h2>
<p>This appendix contains visual checks of the top five rows of the wrangled dataframes created in section 5.</p>
<section id="bradford-oa-polygons-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="bradford-oa-polygons-dataframe">Bradford OA polygons dataframe</h4>
<div class="sourceCode" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>Bradford_OA_polygons.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
OA21CD
</th>
<th>
Polygon
</th>
<th>
City
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E00053353
</td>
<td>
POLYGON ((415817.093 440872.597, 415821.094 44…
</td>
<td>
Bradford
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E00053354
</td>
<td>
POLYGON ((415078.000 439967.001, 415058.323 43…
</td>
<td>
Bradford
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E00053355
</td>
<td>
POLYGON ((416252.367 439816.041, 416253.270 43…
</td>
<td>
Bradford
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E00053356
</td>
<td>
POLYGON ((416668.000 439392.028, 416667.653 43…
</td>
<td>
Bradford
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E00053357
</td>
<td>
POLYGON ((415143.909 439176.235, 415143.000 43…
</td>
<td>
Bradford
</td>
</tr>
</tbody>
</table>
</section>
<section id="bradford-oa-population-weighted-centroids-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="bradford-oa-population-weighted-centroids-dataframe">Bradford OA population weighted centroids dataframe</h4>
<div class="sourceCode" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>Bradford_OA_PWC.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
OA21CD
</th>
<th>
PWC
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E00053353
</td>
<td>
POINT (413638.052 439495.615)
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E00053354
</td>
<td>
POINT (414837.013 439813.246)
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E00053355
</td>
<td>
POINT (416162.559 439674.009)
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E00053356
</td>
<td>
POINT (416591.137 439417.227)
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E00053357
</td>
<td>
POINT (414671.681 439110.823)
</td>
</tr>
</tbody>
</table>
</section>
<section id="bradford-greenspace-polygons-unique-list" class="level4">
<h4 class="anchored" data-anchor-id="bradford-greenspace-polygons-unique-list">Bradford greenspace polygons (unique list)</h4>
<div class="sourceCode" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>Bradford_greenspace_site_unique.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Greenspace_ID
</th>
<th>
Type
</th>
<th>
Polygon
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0295ED18-D538-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
POLYGON Z ((414018.070 438415.690 0.000, 41399…
</td>
</tr>
<tr>
<th>
1
</th>
<td>
0295ED18-E5D4-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
POLYGON Z ((415193.700 439129.550 0.000, 41519…
</td>
</tr>
<tr>
<th>
2
</th>
<td>
0295ED18-F2F3-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
POLYGON Z ((415690.440 439919.060 0.000, 41568…
</td>
</tr>
<tr>
<th>
3
</th>
<td>
0295ECC9-0C25-5C37-E063-AAEFA00A445E
</td>
<td>
Play Space
</td>
<td>
POLYGON Z ((416739.570 439592.210 0.000, 41675…
</td>
</tr>
<tr>
<th>
4
</th>
<td>
0295ECC7-FBFC-5C37-E063-AAEFA00A445E
</td>
<td>
Play Space
</td>
<td>
POLYGON Z ((415991.960 438808.610 0.000, 41598…
</td>
</tr>
</tbody>
</table>
</section>
<section id="nearest-greenspace-to-each-oa-unique-list" class="level4">
<h4 class="anchored" data-anchor-id="nearest-greenspace-to-each-oa-unique-list">Nearest greenspace to each OA (unique list)</h4>
<div class="sourceCode" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>unique_nearest_greenspace.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
OA21CD
</th>
<th>
Greenspace_ID
</th>
<th>
Type
</th>
<th>
Distance
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E00053353
</td>
<td>
0295ED18-D538-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
1000.455806
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E00053354
</td>
<td>
0295ED18-E5D4-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
771.145845
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E00053355
</td>
<td>
0295ED18-F2F3-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
418.265674
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E00053356
</td>
<td>
0295ECC9-0C25-5C37-E063-AAEFA00A445E
</td>
<td>
Play Space
</td>
<td>
194.292561
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E00053357
</td>
<td>
0295ED18-E5D4-5C37-E063-AAEFA00A445E
</td>
<td>
Playing Field
</td>
<td>
432.352481
</td>
</tr>
</tbody>
</table>
</section>
<section id="independent-variables-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="independent-variables-dataframe">Independent variables dataframe</h4>
<div class="sourceCode" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>Ind_vars.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Output Areas Code
</th>
<th>
HHD_dep_education_PC
</th>
<th>
HHD_dep_employment_PC
</th>
<th>
HHD_dep_health_PC
</th>
<th>
HHD_dep_housing_PC
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
E00053353
</td>
<td>
28.3
</td>
<td>
11.5
</td>
<td>
33.6
</td>
<td>
7.8
</td>
</tr>
<tr>
<th>
1
</th>
<td>
E00053354
</td>
<td>
17.3
</td>
<td>
6.8
</td>
<td>
30.8
</td>
<td>
5.3
</td>
</tr>
<tr>
<th>
2
</th>
<td>
E00053355
</td>
<td>
11.2
</td>
<td>
4.9
</td>
<td>
22.0
</td>
<td>
1.6
</td>
</tr>
<tr>
<th>
3
</th>
<td>
E00053356
</td>
<td>
21.5
</td>
<td>
4.2
</td>
<td>
34.0
</td>
<td>
4.9
</td>
</tr>
<tr>
<th>
4
</th>
<td>
E00053357
</td>
<td>
14.2
</td>
<td>
3.5
</td>
<td>
21.3
</td>
<td>
0.7
</td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>